{"version":3,"sources":["../node_modules/lodash-es/isArray.js","../node_modules/lodash-es/_freeGlobal.js","../node_modules/lodash-es/_root.js","../node_modules/lodash-es/_Symbol.js","../node_modules/lodash-es/_getRawTag.js","../node_modules/lodash-es/_objectToString.js","../node_modules/lodash-es/_baseGetTag.js","../node_modules/lodash-es/isObjectLike.js","../node_modules/lodash-es/isSymbol.js","../node_modules/lodash-es/_isKey.js","../node_modules/lodash-es/isObject.js","../node_modules/lodash-es/isFunction.js","../node_modules/lodash-es/_coreJsData.js","../node_modules/lodash-es/_isMasked.js","../node_modules/lodash-es/_toSource.js","../node_modules/lodash-es/_baseIsNative.js","../node_modules/lodash-es/_getValue.js","../node_modules/lodash-es/_getNative.js","../node_modules/lodash-es/_nativeCreate.js","../node_modules/lodash-es/_hashClear.js","../node_modules/lodash-es/_hashDelete.js","../node_modules/lodash-es/_hashGet.js","../node_modules/lodash-es/_hashHas.js","../node_modules/lodash-es/_hashSet.js","../node_modules/lodash-es/_Hash.js","../node_modules/lodash-es/_listCacheClear.js","../node_modules/lodash-es/eq.js","../node_modules/lodash-es/_assocIndexOf.js","../node_modules/lodash-es/_listCacheDelete.js","../node_modules/lodash-es/_listCacheGet.js","../node_modules/lodash-es/_listCacheHas.js","../node_modules/lodash-es/_listCacheSet.js","../node_modules/lodash-es/_ListCache.js","../node_modules/lodash-es/_Map.js","../node_modules/lodash-es/_mapCacheClear.js","../node_modules/lodash-es/_isKeyable.js","../node_modules/lodash-es/_getMapData.js","../node_modules/lodash-es/_mapCacheDelete.js","../node_modules/lodash-es/_mapCacheGet.js","../node_modules/lodash-es/_mapCacheHas.js","../node_modules/lodash-es/_mapCacheSet.js","../node_modules/lodash-es/_MapCache.js","../node_modules/lodash-es/memoize.js","../node_modules/lodash-es/_memoizeCapped.js","../node_modules/lodash-es/_stringToPath.js","../node_modules/lodash-es/_arrayMap.js","../node_modules/lodash-es/_baseToString.js","../node_modules/lodash-es/toString.js","../node_modules/lodash-es/_castPath.js","../node_modules/lodash-es/_toKey.js","../node_modules/lodash-es/_baseGet.js","../node_modules/lodash-es/get.js","../node_modules/lodash-es/_overArg.js","../node_modules/lodash-es/_getPrototype.js","../node_modules/lodash-es/isPlainObject.js","../node_modules/lodash-es/last.js","../src/PointerProxy.ts","../src/index.ts","../src/Atom.ts","../src/derivations/flatMap.ts","../src/utils/Tappable.ts","../src/utils/Emitter.ts","../src/derivations/DerivationEmitter.ts","../src/derivations/DerivationValuelessEmitter.ts","../src/derivations/IDerivation.ts","../src/derivations/map.ts","../src/utils/Stack.ts","../src/derivations/prism/discoveryMechanism.ts","../src/derivations/AbstractDerivation.ts","../src/derivations/DerivationFromSource.ts","../src/pointer.ts","../src/utils/updateDeep.ts","../src/Box.ts","../src/derivations/ConstantDerivation.ts","../src/derivations/iterateAndCountTicks.ts","../src/Ticker.ts","../src/derivations/iterateOver.ts","../src/derivations/prism/prism.ts","../../../node_modules/timing-function/lib/UnitBezier.js","../../../node_modules/levenshtein-edit-distance/index.js","../../../node_modules/propose/propose.js","../../../node_modules/fast-deep-equal/index.js","../src/coreExports.ts","../src/projects/projectsSingleton.ts","../src/privateAPIs.ts","../../shared/src/utils/index.ts","../../../node_modules/lodash-es/isArray.js","../../../node_modules/lodash-es/_freeGlobal.js","../../../node_modules/lodash-es/_root.js","../../../node_modules/lodash-es/_Symbol.js","../../../node_modules/lodash-es/_getRawTag.js","../../../node_modules/lodash-es/_objectToString.js","../../../node_modules/lodash-es/_baseGetTag.js","../../../node_modules/lodash-es/isObjectLike.js","../../../node_modules/lodash-es/isSymbol.js","../../../node_modules/lodash-es/_isKey.js","../../../node_modules/lodash-es/isObject.js","../../../node_modules/lodash-es/isFunction.js","../../../node_modules/lodash-es/_coreJsData.js","../../../node_modules/lodash-es/_isMasked.js","../../../node_modules/lodash-es/_toSource.js","../../../node_modules/lodash-es/_baseIsNative.js","../../../node_modules/lodash-es/_getValue.js","../../../node_modules/lodash-es/_getNative.js","../../../node_modules/lodash-es/_nativeCreate.js","../../../node_modules/lodash-es/_hashClear.js","../../../node_modules/lodash-es/_hashDelete.js","../../../node_modules/lodash-es/_hashGet.js","../../../node_modules/lodash-es/_hashHas.js","../../../node_modules/lodash-es/_hashSet.js","../../../node_modules/lodash-es/_Hash.js","../../../node_modules/lodash-es/_listCacheClear.js","../../../node_modules/lodash-es/eq.js","../../../node_modules/lodash-es/_assocIndexOf.js","../../../node_modules/lodash-es/_listCacheDelete.js","../../../node_modules/lodash-es/_listCacheGet.js","../../../node_modules/lodash-es/_listCacheHas.js","../../../node_modules/lodash-es/_listCacheSet.js","../../../node_modules/lodash-es/_ListCache.js","../../../node_modules/lodash-es/_Map.js","../../../node_modules/lodash-es/_mapCacheClear.js","../../../node_modules/lodash-es/_isKeyable.js","../../../node_modules/lodash-es/_getMapData.js","../../../node_modules/lodash-es/_mapCacheDelete.js","../../../node_modules/lodash-es/_mapCacheGet.js","../../../node_modules/lodash-es/_mapCacheHas.js","../../../node_modules/lodash-es/_mapCacheSet.js","../../../node_modules/lodash-es/_MapCache.js","../../../node_modules/lodash-es/memoize.js","../../../node_modules/lodash-es/_memoizeCapped.js","../../../node_modules/lodash-es/_stringToPath.js","../../../node_modules/lodash-es/_arrayMap.js","../../../node_modules/lodash-es/_baseToString.js","../../../node_modules/lodash-es/toString.js","../../../node_modules/lodash-es/_castPath.js","../../../node_modules/lodash-es/_toKey.js","../../../node_modules/lodash-es/_baseGet.js","../../../node_modules/lodash-es/get.js","../../shared/src/utils/getDeep.ts","../../shared/src/utils/SimpleCache.ts","../src/sheetObjects/SheetObjectTemplate.ts","../../../node_modules/lodash-es/_defineProperty.js","../../../node_modules/lodash-es/_baseAssignValue.js","../../../node_modules/lodash-es/_assignValue.js","../../../node_modules/lodash-es/_isIndex.js","../../../node_modules/lodash-es/_baseSet.js","../../../node_modules/lodash-es/set.js","../src/sheetObjects/getPropDefaultsOfSheetObject.ts","../src/sequences/trackValueAtTime.ts","../../shared/src/logger.ts","../../shared/src/utils/deepMergeWithCache.ts","../../shared/src/utils/pointerDeep.ts","../../shared/src/utils/valToAtom.ts","../src/sheetObjects/SheetObject.ts","../src/coreTicker.ts","../src/sheetObjects/TheatreSheetObject.ts","../src/sheets/SheetTemplate.ts","../../shared/src/utils/didYouMean.ts","../../shared/src/utils/errors.ts","../src/sequences/Sequence.ts","../../../node_modules/lodash-es/_trimmedEndIndex.js","../../../node_modules/lodash-es/_baseTrim.js","../../../node_modules/lodash-es/toNumber.js","../../../node_modules/lodash-es/toFinite.js","../../../node_modules/lodash-es/toInteger.js","../../../node_modules/lodash-es/_overArg.js","../../../node_modules/lodash-es/_getPrototype.js","../../../node_modules/lodash-es/isPlainObject.js","../../../node_modules/lodash-es/_baseSlice.js","../../../node_modules/lodash-es/_castSlice.js","../../../node_modules/lodash-es/_hasUnicode.js","../../../node_modules/lodash-es/_asciiToArray.js","../../../node_modules/lodash-es/_unicodeToArray.js","../../../node_modules/lodash-es/_stringToArray.js","../../../node_modules/lodash-es/_baseProperty.js","../../../node_modules/lodash-es/_baseRepeat.js","../../../node_modules/lodash-es/_asciiSize.js","../../../node_modules/lodash-es/_unicodeSize.js","../../../node_modules/lodash-es/_stringSize.js","../../../node_modules/lodash-es/_createPadding.js","../../../node_modules/lodash-es/padStart.js","../../shared/src/utils/defer.ts","../../shared/src/utils/noop.ts","../src/sequences/playbackControllers/DefaultPlaybackController.ts","../src/sequences/playbackControllers/AudioPlaybackController.ts","../src/sequences/TheatreSequence.ts","../src/propTypes/index.ts","../../shared/src/utils/ellipsify.ts","../../shared/src/utils/userReadableTypeOfValue.ts","../src/propTypes/internals.ts","../../shared/src/utils/slashedPaths.ts","../src/sheets/TheatreSheet.ts","../../../node_modules/immer/src/immer.ts","../../../node_modules/immer/src/core/scope.ts","../src/sheets/Sheet.ts","../src/projects/Project.ts","../../shared/src/utils/delay.ts","../../../node_modules/immer/src/utils/errors.ts","../../../node_modules/immer/src/utils/common.ts","../../../node_modules/immer/src/utils/plugins.ts","../../../node_modules/immer/src/core/finalize.ts","../../../node_modules/immer/src/core/proxy.ts","../../../node_modules/immer/src/core/immerClass.ts","../../../node_modules/immer/src/core/current.ts","../../../node_modules/immer/src/utils/env.ts","../../shared/src/globals.ts","../src/projects/initialiseProjectState.ts","../../shared/src/utils/sanitizers.ts","../src/projects/TheatreProject.ts","../../shared/src/globalVariableNames.ts","../src/CoreBundle.ts","state.json","index.js"],"names":["isArray","Array","freeGlobal","global","Object","root","freeSelf","self","Function","Symbol","getRawTag","objectProto","prototype","hasOwnProperty","nativeObjectToString","toString","symToStringTag","toStringTag","undefined","value","isOwn","call","tag","unmasked","e","result","objectToString","baseGetTag","nullTag","undefinedTag","isObjectLike","isSymbol","symbolTag","isKey","reIsDeepProp","reIsPlainProp","object","type","test","isObject","isFunction","asyncTag","funcTag","genTag","proxyTag","coreJsData","isMasked","maskSrcKey","uid","exec","keys","IE_PROTO","func","toSource","funcProto","funcToString","baseIsNative","reRegExpChar","reIsHostCtor","reIsNative","RegExp","replace","getValue","key","getNative","nativeCreate","hashClear","__data__","size","hashDelete","has","hashGet","HASH_UNDEFINED","data","hashHas","hashSet","Hash","entries","index","length","clear","entry","set","get","listCacheClear","eq","other","assocIndexOf","array","listCacheDelete","arrayProto","splice","pop","listCacheGet","listCacheHas","listCacheSet","push","ListCache","Map","mapCacheClear","isKeyable","getMapData","map","mapCacheDelete","mapCacheGet","mapCacheHas","mapCacheSet","MapCache","memoize","FUNC_ERROR_TEXT","resolver","TypeError","memoized","args","arguments","apply","cache","Cache","memoizeCapped","MAX_MEMOIZE_SIZE","stringToPath","rePropName","reEscapeChar","string","charCodeAt","match","number","quote","subString","arrayMap","iteratee","baseToString","INFINITY","symbolProto","symbolToString","castPath","toKey","baseGet","path","defaultValue","overArg","transform","arg","getPrototype","getPrototypeOf","isPlainObject","objectTag","objectCtorString","proto","Ctor","constructor","last","module","exports","sheetsById","Table","staticOverrides","byObject","Box","position","x","y","stretch","Dust","opacity","scaleX","sequence","subUnitsPerUnit","tracksByObject","trackData","AQMTK8I7k5","keyframes","id","connectedRight","handles","FOzP0WOnXm","yGILQGy9bj","trackIdByPropPath","WxZaWloxoF","ieuKKuzweY","definitionVersion","revisionHistory","project","state","makeBouncingBox","i","boxContainer","document","createElement","className","getElementById","appendChild","sheet","boxObj","t","nudgeMultiplier","boxDiv","addEventListener","play","iterationCount","Infinity","onValuesChange","style","dustDiv","String"],"mappings":"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","file":"src.934bfd31.js","sourceRoot":"..\\src","sourcesContent":["/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n","import isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/;\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\nexport default isKey;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","import MapCache from './_MapCache.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `clear`, `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver != null && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result) || cache;\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Expose `MapCache`.\nmemoize.Cache = MapCache;\n\nexport default memoize;\n","import memoize from './memoize.js';\n\n/** Used as the maximum memoize cache size. */\nvar MAX_MEMOIZE_SIZE = 500;\n\n/**\n * A specialized version of `_.memoize` which clears the memoized function's\n * cache when it exceeds `MAX_MEMOIZE_SIZE`.\n *\n * @private\n * @param {Function} func The function to have its output memoized.\n * @returns {Function} Returns the new memoized function.\n */\nfunction memoizeCapped(func) {\n  var result = memoize(func, function(key) {\n    if (cache.size === MAX_MEMOIZE_SIZE) {\n      cache.clear();\n    }\n    return key;\n  });\n\n  var cache = result.cache;\n  return result;\n}\n\nexport default memoizeCapped;\n","import memoizeCapped from './_memoizeCapped.js';\n\n/** Used to match property names within property paths. */\nvar rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoizeCapped(function(string) {\n  var result = [];\n  if (string.charCodeAt(0) === 46 /* . */) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, subString) {\n    result.push(quote ? subString.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\nexport default stringToPath;\n","/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\nexport default arrayMap;\n","import Symbol from './_Symbol.js';\nimport arrayMap from './_arrayMap.js';\nimport isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isArray(value)) {\n    // Recursively convert values (susceptible to call stack limits).\n    return arrayMap(value, baseToString) + '';\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default baseToString;\n","import baseToString from './_baseToString.js';\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\nexport default toString;\n","import isArray from './isArray.js';\nimport isKey from './_isKey.js';\nimport stringToPath from './_stringToPath.js';\nimport toString from './toString.js';\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @param {Object} [object] The object to query keys on.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value, object) {\n  if (isArray(value)) {\n    return value;\n  }\n  return isKey(value, object) ? [value] : stringToPath(toString(value));\n}\n\nexport default castPath;\n","import isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default toKey;\n","import castPath from './_castPath.js';\nimport toKey from './_toKey.js';\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = castPath(path, object);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\nexport default baseGet;\n","import baseGet from './_baseGet.js';\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\nexport default get;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","import baseGetTag from './_baseGetTag.js';\nimport getPrototype from './_getPrototype.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) || baseGetTag(value) != objectTag) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor &&\n    funcToString.call(Ctor) == objectCtorString;\n}\n\nexport default isPlainObject;\n","/**\n * Gets the last element of `array`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to query.\n * @returns {*} Returns the last element of `array`.\n * @example\n *\n * _.last([1, 2, 3]);\n * // => 3\n */\nfunction last(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? array[length - 1] : undefined;\n}\n\nexport default last;\n","import type {IdentityDerivationProvider} from './Atom'\nimport type {Pointer} from './pointer'\nimport pointer from './pointer'\nimport type {IBox} from './Box'\nimport Box from './Box'\nimport type {$FixMe, $IntentionalAny} from './types'\nimport {valueDerivation} from './Atom'\n\nexport default class PointerProxy<O extends {}>\n  implements IdentityDerivationProvider\n{\n  readonly $$isIdentityDerivationProvider = true\n  private readonly _currentPointerBox: IBox<Pointer<O>>\n  readonly pointer: Pointer<O>\n\n  constructor(currentPointer: Pointer<O>) {\n    this._currentPointerBox = new Box(currentPointer)\n    this.pointer = pointer({root: this as $FixMe, path: []})\n  }\n\n  setPointer(p: Pointer<O>) {\n    this._currentPointerBox.set(p)\n  }\n\n  getIdentityDerivation(path: Array<string | number>) {\n    return this._currentPointerBox.derivation.flatMap((p) => {\n      const subPointer = path.reduce(\n        (pointerSoFar, pathItem) => (pointerSoFar as $IntentionalAny)[pathItem],\n        p,\n      )\n      return valueDerivation(subPointer)\n    })\n  }\n}\n","export type {IdentityDerivationProvider} from './Atom'\nexport {default as Atom, val, valueDerivation} from './Atom'\nexport {default as Box} from './Box'\nexport type {IBox} from './Box'\nexport {default as AbstractDerivation} from './derivations/AbstractDerivation'\nexport {default as ConstantDerivation} from './derivations/ConstantDerivation'\nexport {default as DerivationFromSource} from './derivations/DerivationFromSource'\nexport {isDerivation} from './derivations/IDerivation'\nexport type {IDerivation} from './derivations/IDerivation'\nexport {default as iterateAndCountTicks} from './derivations/iterateAndCountTicks'\nexport {default as iterateOver} from './derivations/iterateOver'\nexport {default as prism} from './derivations/prism/prism'\nexport {default as pointer, getPointerParts, isPointer} from './pointer'\nexport type {Pointer, PointerType} from './pointer'\nexport {default as Ticker} from './Ticker'\nexport {default as PointerProxy} from './PointerProxy'\n","import get from 'lodash-es/get'\nimport isPlainObject from 'lodash-es/isPlainObject'\nimport last from 'lodash-es/last'\nimport DerivationFromSource from './derivations/DerivationFromSource'\nimport type {IDerivation} from './derivations/IDerivation'\nimport {isDerivation} from './derivations/IDerivation'\nimport type {Pointer, PointerType} from './pointer'\nimport {isPointer} from './pointer'\nimport pointer, {getPointerMeta} from './pointer'\nimport type {$FixMe, $IntentionalAny} from './types'\nimport type {PathBasedReducer} from './utils/PathBasedReducer'\nimport updateDeep from './utils/updateDeep'\n\ntype Listener = (newVal: unknown) => void\n\nenum ValueTypes {\n  Dict,\n  Array,\n  Other,\n}\n\nexport interface IdentityDerivationProvider {\n  readonly $$isIdentityDerivationProvider: true\n  getIdentityDerivation(path: Array<string | number>): IDerivation<unknown>\n}\n\nconst getTypeOfValue = (v: unknown): ValueTypes => {\n  if (Array.isArray(v)) return ValueTypes.Array\n  if (isPlainObject(v)) return ValueTypes.Dict\n  return ValueTypes.Other\n}\n\nconst getKeyOfValue = (\n  v: unknown,\n  key: string | number,\n  vType: ValueTypes = getTypeOfValue(v),\n): unknown => {\n  if (vType === ValueTypes.Dict && typeof key === 'string') {\n    return (v as $IntentionalAny)[key]\n  } else if (vType === ValueTypes.Array && isValidArrayIndex(key)) {\n    return (v as $IntentionalAny)[key]\n  } else {\n    return undefined\n  }\n}\n\nconst isValidArrayIndex = (key: string | number): boolean => {\n  const inNumber = typeof key === 'number' ? key : parseInt(key, 10)\n  return (\n    !isNaN(inNumber) &&\n    inNumber >= 0 &&\n    inNumber < Infinity &&\n    (inNumber | 0) === inNumber\n  )\n}\n\nclass Scope {\n  children: Map<string | number, Scope> = new Map()\n  identityChangeListeners: Set<Listener> = new Set()\n  constructor(\n    readonly _parent: undefined | Scope,\n    readonly _path: (string | number)[],\n  ) {}\n\n  addIdentityChangeListener(cb: Listener) {\n    this.identityChangeListeners.add(cb)\n  }\n\n  removeIdentityChangeListener(cb: Listener) {\n    this.identityChangeListeners.delete(cb)\n    this._checkForGC()\n  }\n\n  removeChild(key: string | number) {\n    this.children.delete(key)\n    this._checkForGC()\n  }\n\n  getChild(key: string | number) {\n    return this.children.get(key)\n  }\n\n  getOrCreateChild(key: string | number) {\n    let child = this.children.get(key)\n    if (!child) {\n      child = child = new Scope(this, this._path.concat([key]))\n      this.children.set(key, child)\n    }\n    return child\n  }\n\n  _checkForGC() {\n    if (this.identityChangeListeners.size > 0) return\n    if (this.children.size > 0) return\n\n    if (this._parent) {\n      this._parent.removeChild(last(this._path) as string | number)\n    }\n  }\n}\n\nexport default class Atom<State extends {}>\n  implements IdentityDerivationProvider\n{\n  private _currentState: State\n  readonly $$isIdentityDerivationProvider = true\n  private readonly _rootScope: Scope\n  readonly pointer: Pointer<State>\n\n  constructor(initialState: State) {\n    this._currentState = initialState\n    this._rootScope = new Scope(undefined, [])\n    this.pointer = pointer({root: this as $FixMe, path: []})\n  }\n\n  setState(newState: State) {\n    const oldState = this._currentState\n    this._currentState = newState\n\n    this._checkUpdates(this._rootScope, oldState, newState)\n  }\n\n  getState() {\n    return this._currentState\n  }\n\n  getIn(path: (string | number)[]): unknown {\n    return path.length === 0 ? this.getState() : get(this.getState(), path)\n  }\n\n  reduceState: PathBasedReducer<State, State> = (\n    path: $IntentionalAny[],\n    reducer: $IntentionalAny,\n  ) => {\n    const newState = updateDeep(this.getState(), path, reducer)\n    this.setState(newState)\n    return newState\n  }\n\n  setIn(path: $FixMe[], val: $FixMe) {\n    return this.reduceState(path, () => val)\n  }\n\n  private _checkUpdates(scope: Scope, oldState: unknown, newState: unknown) {\n    if (oldState === newState) return\n    scope.identityChangeListeners.forEach((cb) => cb(newState))\n\n    if (scope.children.size === 0) return\n\n    // @todo we can probably skip checking value types\n    const oldValueType = getTypeOfValue(oldState)\n    const newValueType = getTypeOfValue(newState)\n\n    if (oldValueType === ValueTypes.Other && oldValueType === newValueType)\n      return\n\n    scope.children.forEach((childScope, childKey) => {\n      const oldChildVal = getKeyOfValue(oldState, childKey, oldValueType)\n      const newChildVal = getKeyOfValue(newState, childKey, newValueType)\n      this._checkUpdates(childScope, oldChildVal, newChildVal)\n    })\n  }\n\n  private _getOrCreateScopeForPath(path: (string | number)[]): Scope {\n    let curScope = this._rootScope\n    for (const pathEl of path) {\n      curScope = curScope.getOrCreateChild(pathEl)\n    }\n    return curScope\n  }\n\n  private _onPathValueChange = (\n    path: (string | number)[],\n    cb: (v: unknown) => void,\n  ) => {\n    const scope = this._getOrCreateScopeForPath(path)\n    scope.identityChangeListeners.add(cb)\n    const untap = () => {\n      scope.identityChangeListeners.delete(cb)\n    }\n    return untap\n  }\n\n  getIdentityDerivation(path: Array<string | number>): IDerivation<unknown> {\n    return new DerivationFromSource<$IntentionalAny>(\n      (listener) => this._onPathValueChange(path, listener),\n      () => this.getIn(path),\n    )\n  }\n}\n\nconst identityDerivationWeakMap = new WeakMap<{}, IDerivation<unknown>>()\n\nexport const valueDerivation = <P extends PointerType<$IntentionalAny>>(\n  pointer: P,\n): IDerivation<P extends PointerType<infer T> ? T : void> => {\n  const meta = getPointerMeta(pointer)\n\n  let derivation = identityDerivationWeakMap.get(meta)\n  if (!derivation) {\n    const root = meta.root\n    if (!isIdentityChangeProvider(root)) {\n      throw new Error(\n        `Cannot run valueDerivation() on a pointer whose root is not an IdentityChangeProvider`,\n      )\n    }\n    const {path} = meta\n    derivation = root.getIdentityDerivation(path)\n    identityDerivationWeakMap.set(meta, derivation)\n  }\n  return derivation as $IntentionalAny\n}\n\nfunction isIdentityChangeProvider(\n  val: unknown,\n): val is IdentityDerivationProvider {\n  return (\n    typeof val === 'object' &&\n    val !== null &&\n    (val as $IntentionalAny)['$$isIdentityDerivationProvider'] === true\n  )\n}\n\nexport const val = <P>(\n  pointerOrDerivationOrPlainValue: P,\n): P extends PointerType<infer T>\n  ? T\n  : P extends IDerivation<infer T>\n  ? T\n  : P extends undefined | null\n  ? P\n  : unknown => {\n  if (isPointer(pointerOrDerivationOrPlainValue)) {\n    return valueDerivation(\n      pointerOrDerivationOrPlainValue,\n    ).getValue() as $IntentionalAny\n  } else if (isDerivation(pointerOrDerivationOrPlainValue)) {\n    return pointerOrDerivationOrPlainValue.getValue() as $IntentionalAny\n  } else {\n    return pointerOrDerivationOrPlainValue as $IntentionalAny\n  }\n}\n","import type {$FixMe} from '../types'\nimport AbstractDerivation from './AbstractDerivation'\nimport type {IDerivation} from './IDerivation'\nimport {isDerivation} from './IDerivation'\n\nenum UPDATE_NEEDED_FROM {\n  none = 0,\n  dep = 1,\n  inner = 2,\n}\n\nconst makeFlatMapDerivationClass = () => {\n  class FlatMapDerivation<V, DepType> extends AbstractDerivation<V> {\n    private _innerDerivation: undefined | null | IDerivation<V>\n    private _staleDependency: UPDATE_NEEDED_FROM\n\n    static displayName = 'flatMap'\n\n    constructor(\n      readonly _depDerivation: IDerivation<DepType>,\n      readonly _fn: (v: DepType) => IDerivation<V> | V,\n    ) {\n      super()\n      this._innerDerivation = undefined\n      this._staleDependency = UPDATE_NEEDED_FROM.dep\n\n      this._addDependency(_depDerivation)\n\n      return this\n    }\n\n    _recalculateHot() {\n      const updateNeededFrom = this._staleDependency\n      this._staleDependency = UPDATE_NEEDED_FROM.none\n\n      if (updateNeededFrom === UPDATE_NEEDED_FROM.inner) {\n        // @ts-ignore\n        return this._innerDerivation.getValue()\n      }\n\n      const possibleInnerDerivation = this._fn(this._depDerivation.getValue())\n\n      if (isDerivation(possibleInnerDerivation)) {\n        this._innerDerivation = possibleInnerDerivation\n        this._addDependency(possibleInnerDerivation)\n        return possibleInnerDerivation.getValue()\n      } else {\n        return possibleInnerDerivation\n      }\n    }\n\n    protected _recalculateCold() {\n      const possibleInnerDerivation = this._fn(this._depDerivation.getValue())\n\n      if (isDerivation(possibleInnerDerivation)) {\n        return possibleInnerDerivation.getValue()\n      } else {\n        return possibleInnerDerivation\n      }\n    }\n\n    protected _recalculate() {\n      return this.isHot ? this._recalculateHot() : this._recalculateCold()\n    }\n\n    protected _reactToDependencyBecomingStale(\n      msgComingFrom: IDerivation<unknown>,\n    ) {\n      const updateNeededFrom =\n        msgComingFrom === this._depDerivation\n          ? UPDATE_NEEDED_FROM.dep\n          : UPDATE_NEEDED_FROM.inner\n\n      if (\n        updateNeededFrom === UPDATE_NEEDED_FROM.inner &&\n        msgComingFrom !== this._innerDerivation\n      ) {\n        throw Error(\n          `got a _reactToDependencyBecomingStale() from neither the dep nor the inner derivation`,\n        )\n      }\n\n      if (this._staleDependency === UPDATE_NEEDED_FROM.none) {\n        this._staleDependency = updateNeededFrom\n\n        if (updateNeededFrom === UPDATE_NEEDED_FROM.dep) {\n          this._removeInnerDerivation()\n        }\n      } else if (this._staleDependency === UPDATE_NEEDED_FROM.dep) {\n      } else {\n        if (updateNeededFrom === UPDATE_NEEDED_FROM.dep) {\n          this._staleDependency = UPDATE_NEEDED_FROM.dep\n          this._removeInnerDerivation()\n        }\n      }\n    }\n\n    private _removeInnerDerivation() {\n      if (this._innerDerivation) {\n        this._removeDependency(this._innerDerivation)\n        this._innerDerivation = undefined\n      }\n    }\n\n    protected _keepHot() {\n      this._staleDependency = UPDATE_NEEDED_FROM.dep\n      this.getValue()\n    }\n\n    protected _becomeCold() {\n      this._staleDependency = UPDATE_NEEDED_FROM.dep\n      this._removeInnerDerivation()\n    }\n  }\n  return FlatMapDerivation\n}\n\nlet cls: ReturnType<typeof makeFlatMapDerivationClass> | undefined = undefined\n\nexport default function flatMap<V, R>(\n  dep: IDerivation<V>,\n  fn: (v: V) => R,\n): IDerivation<R extends IDerivation<infer T> ? T : R> {\n  if (!cls) {\n    cls = makeFlatMapDerivationClass()\n  }\n  return new cls(dep, fn) as $FixMe\n}\n","type Untap = () => void\ntype UntapFromSource = () => void\n\ninterface IProps<V> {\n  tapToSource: (cb: (payload: V) => void) => UntapFromSource\n}\n\ntype Listener<V> = ((v: V) => void) | (() => void)\n\nexport default class Tappable<V> {\n  private _props: IProps<V>\n  private _tappers: Map<number, {bivarianceHack(v: V): void}['bivarianceHack']>\n  private _untapFromSource: null | UntapFromSource\n  private _lastTapperId: number\n  private _untapFromSourceTimeout: null | NodeJS.Timer = null\n\n  constructor(props: IProps<V>) {\n    this._lastTapperId = 0\n    this._untapFromSource = null\n    this._props = props\n    this._tappers = new Map()\n  }\n\n  private _check() {\n    if (this._untapFromSource) {\n      if (this._tappers.size === 0) {\n        this._scheduleToUntapFromSource()\n        /*\n         * this._untapFromSource()\n         * this._untapFromSource = null\n         */\n      }\n    } else {\n      if (this._tappers.size !== 0) {\n        this._untapFromSource = this._props.tapToSource(this._cb)\n      }\n    }\n  }\n\n  private _scheduleToUntapFromSource() {\n    if (this._untapFromSourceTimeout !== null) return\n    this._untapFromSourceTimeout = setTimeout(() => {\n      this._untapFromSourceTimeout = null\n      if (this._tappers.size === 0) {\n        this._untapFromSource!()\n\n        this._untapFromSource = null\n      }\n    }, 0)\n  }\n\n  private _cb: any = (arg: any): void => {\n    this._tappers.forEach((cb) => {\n      cb(arg)\n    })\n  }\n\n  tap(cb: Listener<V>): Untap {\n    const tapperId = this._lastTapperId++\n    this._tappers.set(tapperId, cb)\n    this._check()\n    return () => {\n      this._removeTapperById(tapperId)\n    }\n  }\n\n  /*\n   * tapImmediate(cb: Listener<V>): Untap {\n   *   const ret = this.tap(cb)\n   *   return ret\n   * }\n   */\n\n  private _removeTapperById(id: number) {\n    this._tappers.delete(id)\n    this._check()\n  }\n\n  // /**\n  //  * @deprecated\n  //  */\n  // map<T>(transform: {bivarianceHack(v: V): T}['bivarianceHack']): Tappable<T> {\n  //   return new Tappable({\n  //     tapToSource: (cb: (v: T) => void) => {\n  //       return this.tap((v: $IntentionalAny) => {\n  //         return cb(transform(v))\n  //       })\n  //     },\n  //   })\n  // }\n}\n","import Tappable from './Tappable'\n\ntype Tapper<V> = (v: V) => void\ntype Untap = () => void\n\nexport default class Emitter<V> {\n  private _tappers: Map<any, (v: V) => void>\n  private _lastTapperId: number\n  readonly tappable: Tappable<V>\n  private _onNumberOfTappersChangeListener: undefined | ((n: number) => void)\n\n  constructor() {\n    this._lastTapperId = 0\n    this._tappers = new Map()\n    this.tappable = new Tappable({\n      tapToSource: (cb: Tapper<V>) => {\n        return this._tap(cb)\n      },\n    })\n  }\n\n  _tap(cb: Tapper<V>): Untap {\n    const tapperId = this._lastTapperId++\n    this._tappers.set(tapperId, cb)\n    this._onNumberOfTappersChangeListener &&\n      this._onNumberOfTappersChangeListener(this._tappers.size)\n    return () => {\n      this._removeTapperById(tapperId)\n    }\n  }\n\n  _removeTapperById(id: number) {\n    const oldSize = this._tappers.size\n    this._tappers.delete(id)\n    const newSize = this._tappers.size\n    if (oldSize !== newSize) {\n      this._onNumberOfTappersChangeListener &&\n        this._onNumberOfTappersChangeListener(this._tappers.size)\n    }\n  }\n\n  emit(payload: V) {\n    this._tappers.forEach((cb) => {\n      cb(payload)\n    })\n  }\n\n  hasTappers() {\n    return this._tappers.size !== 0\n  }\n\n  onNumberOfTappersChange(cb: (n: number) => void) {\n    this._onNumberOfTappersChangeListener = cb\n  }\n}\n","import type Ticker from '../Ticker'\nimport Emitter from '../utils/Emitter'\nimport type {default as Tappable} from '../utils/Tappable'\nimport type {IDerivation} from './IDerivation'\n\nexport default class DerivationEmitter<V> {\n  private _derivation: IDerivation<V>\n  private _ticker: Ticker\n  private _emitter: Emitter<V>\n  private _lastValue: undefined | V\n  private _lastValueRecorded: boolean\n  private _hadTappers: boolean\n\n  constructor(derivation: IDerivation<V>, ticker: Ticker) {\n    this._derivation = derivation\n    this._ticker = ticker\n    this._emitter = new Emitter()\n    this._emitter.onNumberOfTappersChange(() => {\n      this._reactToNumberOfTappersChange()\n    })\n    this._hadTappers = false\n    this._lastValueRecorded = false\n    this._lastValue = undefined\n    return this\n  }\n\n  private _possiblyMarkAsStale = () => {\n    this._ticker.onThisOrNextTick(this._refresh)\n  }\n\n  private _reactToNumberOfTappersChange() {\n    const hasTappers = this._emitter.hasTappers()\n    if (hasTappers !== this._hadTappers) {\n      this._hadTappers = hasTappers\n      if (hasTappers) {\n        this._derivation.addDependent(this._possiblyMarkAsStale)\n      } else {\n        this._derivation.removeDependent(this._possiblyMarkAsStale)\n      }\n    }\n  }\n\n  tappable(): Tappable<V> {\n    return this._emitter.tappable\n  }\n\n  private _refresh = () => {\n    const newValue = this._derivation.getValue()\n    if (newValue === this._lastValue && this._lastValueRecorded === true) return\n    this._lastValue = newValue\n    this._lastValueRecorded = true\n    this._emitter.emit(newValue)\n  }\n}\n","import Emitter from '../utils/Emitter'\nimport type {default as Tappable} from '../utils/Tappable'\nimport type {IDerivation} from './IDerivation'\n\n/**\n * Just like DerivationEmitter, except it doesn't emit the value and doesn't need a ticker\n */\nexport default class DerivationValuelessEmitter<V> {\n  _derivation: IDerivation<V>\n  _emitter: Emitter<void>\n  _hadTappers: boolean\n\n  constructor(\n    derivation: IDerivation<V>,\n    readonly dontEmitValues: boolean = false,\n  ) {\n    this._derivation = derivation\n    this._emitter = new Emitter()\n    this._emitter.onNumberOfTappersChange(() => {\n      this._reactToNumberOfTappersChange()\n    })\n    this._hadTappers = false\n    return this\n  }\n\n  private _possiblyMarkAsStale = () => {\n    this._emitter.emit(undefined)\n  }\n\n  _reactToNumberOfTappersChange() {\n    const hasTappers = this._emitter.hasTappers()\n    if (hasTappers !== this._hadTappers) {\n      this._hadTappers = hasTappers\n      if (hasTappers) {\n        this._derivation.addDependent(this._possiblyMarkAsStale)\n      } else {\n        this._derivation.removeDependent(this._possiblyMarkAsStale)\n      }\n    }\n  }\n\n  tappable(): Tappable<void> {\n    return this._emitter.tappable\n  }\n}\n","import type Ticker from '../Ticker'\nimport type {$IntentionalAny, VoidFn} from '../types'\nimport type Tappable from '../utils/Tappable'\n\ntype IDependent = (msgComingFrom: IDerivation<$IntentionalAny>) => void\nexport interface IDerivation<V> {\n  isDerivation: true\n  isHot: boolean\n  changes(ticker: Ticker): Tappable<V>\n\n  changesWithoutValues(): Tappable<void>\n  keepHot(): VoidFn\n  tapImmediate(ticker: Ticker, fn: (cb: V) => void): VoidFn\n  addDependent(d: IDependent): void\n  removeDependent(d: IDependent): void\n\n  getValue(): V\n\n  map<T>(fn: (v: V) => T): IDerivation<T>\n\n  flatMap<R>(\n    fn: (v: V) => R,\n  ): IDerivation<R extends IDerivation<infer T> ? T : R>\n}\n\nexport function isDerivation(d: any): d is IDerivation<unknown> {\n  return d && d.isDerivation && d.isDerivation === true\n}\n","import AbstractDerivation from './AbstractDerivation'\nimport type {IDerivation} from './IDerivation'\n\n// Exporting from a function because of the circular dependency with AbstractDerivation\nconst makeMapDerivationClass = () =>\n  class MapDerivation<T, V> extends AbstractDerivation<V> {\n    constructor(\n      private readonly _dep: IDerivation<T>,\n      private readonly _fn: (t: T) => V,\n    ) {\n      super()\n      this._addDependency(_dep)\n    }\n\n    _recalculate() {\n      return this._fn(this._dep.getValue())\n    }\n\n    _reactToDependencyBecomingStale() {}\n  }\n\nlet cls: ReturnType<typeof makeMapDerivationClass> | undefined = undefined\n\nexport default function flatMap<V, R>(\n  dep: IDerivation<V>,\n  fn: (v: V) => R,\n): IDerivation<R> {\n  if (!cls) {\n    cls = makeMapDerivationClass()\n  }\n  return new cls(dep, fn)\n}\n","interface Node<Data> {\n  next: undefined | Node<Data>\n  data: Data\n}\n\n/**\n * Just a simple LinkedList\n */\nexport default class Stack<Data> {\n  _head: undefined | Node<Data>\n\n  constructor() {\n    this._head = undefined\n  }\n\n  peek() {\n    return this._head && this._head.data\n  }\n\n  pop() {\n    const head = this._head\n    if (!head) {\n      return undefined\n    }\n    this._head = head.next\n    return head.data\n  }\n\n  push(data: Data) {\n    const node = {next: this._head, data}\n    this._head = node\n  }\n}\n","import type {$IntentionalAny} from '../../types'\nimport Stack from '../../utils/Stack'\nimport type {IDerivation} from '../IDerivation'\n\nfunction createMechanism() {\n  const noop = () => {}\n\n  const stack = new Stack<Collector>()\n  const noopCollector: Collector = noop\n\n  type Collector = (d: IDerivation<$IntentionalAny>) => void\n\n  const pushCollector = (collector: Collector): void => {\n    stack.push(collector)\n  }\n\n  const popCollector = (collector: Collector): void => {\n    const existing = stack.peek()\n    if (existing !== collector) {\n      throw new Error(`Popped collector is not on top of the stack`)\n    }\n    stack.pop()\n  }\n\n  const startIgnoringDependencies = () => {\n    stack.push(noopCollector)\n  }\n\n  const stopIgnoringDependencies = () => {\n    if (stack.peek() !== noopCollector) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn('This should never happen')\n      }\n    } else {\n      stack.pop()\n    }\n  }\n\n  const reportResolutionStart = (d: IDerivation<$IntentionalAny>) => {\n    const possibleCollector = stack.peek()\n    if (possibleCollector) {\n      possibleCollector(d)\n    }\n\n    stack.push(noopCollector)\n  }\n\n  const reportResolutionEnd = (_d: IDerivation<$IntentionalAny>) => {\n    stack.pop()\n  }\n\n  return {\n    type: 'Dataverse_discoveryMechanism' as 'Dataverse_discoveryMechanism',\n    startIgnoringDependencies,\n    stopIgnoringDependencies,\n    reportResolutionStart,\n    reportResolutionEnd,\n    pushCollector,\n    popCollector,\n  }\n}\n\nfunction getSharedMechanism(): ReturnType<typeof createMechanism> {\n  const varName = '__dataverse_discoveryMechanism_sharedStack'\n  if (global) {\n    const existingMechanism: ReturnType<typeof createMechanism> | undefined =\n      // @ts-ignore ignore\n      global[varName]\n    if (\n      existingMechanism &&\n      typeof existingMechanism === 'object' &&\n      existingMechanism.type === 'Dataverse_discoveryMechanism'\n    ) {\n      return existingMechanism\n    } else {\n      const mechanism = createMechanism()\n      // @ts-ignore ignore\n      global[varName] = mechanism\n      return mechanism\n    }\n  } else {\n    return createMechanism()\n  }\n}\n\nexport const {\n  startIgnoringDependencies,\n  stopIgnoringDependencies,\n  reportResolutionEnd,\n  reportResolutionStart,\n  pushCollector,\n  popCollector,\n} = getSharedMechanism()\n","import type Ticker from '../Ticker'\nimport type {$IntentionalAny, VoidFn} from '../types'\nimport type Tappable from '../utils/Tappable'\nimport DerivationEmitter from './DerivationEmitter'\nimport DerivationValuelessEmitter from './DerivationValuelessEmitter'\nimport flatMap from './flatMap'\nimport type {IDerivation} from './IDerivation'\nimport map from './map'\nimport {\n  reportResolutionEnd,\n  reportResolutionStart,\n} from './prism/discoveryMechanism'\n\ntype IDependent = (msgComingFrom: IDerivation<$IntentionalAny>) => void\nexport default abstract class AbstractDerivation<V> implements IDerivation<V> {\n  readonly isDerivation: true = true\n  private _didMarkDependentsAsStale: boolean = false\n  private _isHot: boolean = false\n\n  private _isFresh: boolean = false\n  protected _lastValue: undefined | V = undefined\n\n  protected _dependents: Set<IDependent> = new Set()\n  protected _dependencies: Set<IDerivation<$IntentionalAny>> = new Set()\n\n  protected abstract _recalculate(): V\n  protected abstract _reactToDependencyBecomingStale(\n    which: IDerivation<unknown>,\n  ): void\n\n  constructor() {}\n\n  get isHot(): boolean {\n    return this._isHot\n  }\n\n  protected _addDependency(d: IDerivation<$IntentionalAny>) {\n    if (this._dependencies.has(d)) return\n    this._dependencies.add(d)\n    if (this._isHot) d.addDependent(this._internal_markAsStale)\n  }\n\n  protected _removeDependency(d: IDerivation<$IntentionalAny>) {\n    if (!this._dependencies.has(d)) return\n    this._dependencies.delete(d)\n    if (this._isHot) d.removeDependent(this._internal_markAsStale)\n  }\n\n  changes(ticker: Ticker): Tappable<V> {\n    return new DerivationEmitter(this, ticker).tappable()\n  }\n\n  changesWithoutValues(): Tappable<void> {\n    return new DerivationValuelessEmitter(this).tappable()\n  }\n\n  keepHot() {\n    return this.changesWithoutValues().tap(() => {})\n  }\n\n  tapImmediate(ticker: Ticker, fn: (cb: V) => void): VoidFn {\n    const untap = this.changes(ticker).tap(fn)\n    fn(this.getValue())\n    return untap\n  }\n\n  addDependent(d: IDependent) {\n    const hadDepsBefore = this._dependents.size > 0\n    this._dependents.add(d)\n    const hasDepsNow = this._dependents.size > 0\n    if (hadDepsBefore !== hasDepsNow) {\n      this._reactToNumberOfDependentsChange()\n    }\n  }\n\n  /**\n   * @sealed\n   */\n  removeDependent(d: IDependent) {\n    const hadDepsBefore = this._dependents.size > 0\n    this._dependents.delete(d)\n    const hasDepsNow = this._dependents.size > 0\n    if (hadDepsBefore !== hasDepsNow) {\n      this._reactToNumberOfDependentsChange()\n    }\n  }\n\n  /**\n   * This is meant to be called by subclasses\n   *\n   * @sealed\n   */\n  protected _markAsStale(which: IDerivation<$IntentionalAny>) {\n    this._internal_markAsStale(which)\n  }\n\n  private _internal_markAsStale = (which: IDerivation<$IntentionalAny>) => {\n    this._reactToDependencyBecomingStale(which)\n\n    if (this._didMarkDependentsAsStale) return\n\n    this._didMarkDependentsAsStale = true\n    this._isFresh = false\n\n    this._dependents.forEach((dependent) => {\n      dependent(this)\n    })\n  }\n\n  getValue(): V {\n    reportResolutionStart(this)\n\n    if (!this._isFresh) {\n      const newValue = this._recalculate()\n      this._lastValue = newValue\n      if (this._isHot) {\n        this._isFresh = true\n        this._didMarkDependentsAsStale = false\n      }\n    }\n\n    reportResolutionEnd(this)\n    return this._lastValue!\n  }\n\n  private _reactToNumberOfDependentsChange() {\n    const shouldBecomeHot = this._dependents.size > 0\n\n    if (shouldBecomeHot === this._isHot) return\n\n    this._isHot = shouldBecomeHot\n    this._didMarkDependentsAsStale = false\n    this._isFresh = false\n    if (shouldBecomeHot) {\n      this._dependencies.forEach((d) => {\n        d.addDependent(this._internal_markAsStale)\n      })\n      this._keepHot()\n    } else {\n      this._dependencies.forEach((d) => {\n        d.removeDependent(this._internal_markAsStale)\n      })\n      this._becomeCold()\n    }\n  }\n\n  protected _keepHot() {}\n\n  protected _becomeCold() {}\n\n  map<T>(fn: (v: V) => T): IDerivation<T> {\n    return map(this, fn)\n  }\n\n  flatMap<R>(\n    fn: (v: V) => R,\n  ): IDerivation<R extends IDerivation<infer T> ? T : R> {\n    return flatMap(this, fn)\n  }\n}\n","import type {VoidFn} from '../types'\nimport AbstractDerivation from './AbstractDerivation'\n\nconst noop = () => {}\n\nexport default class DerivationFromSource<V> extends AbstractDerivation<V> {\n  private _untapFromChanges: () => void\n  private _cachedValue: undefined | V\n  private _hasCachedValue: boolean\n\n  constructor(\n    private readonly _tapToSource: (listener: (newValue: V) => void) => VoidFn,\n    private readonly _getValueFromSource: () => V,\n  ) {\n    super()\n    this._untapFromChanges = noop\n    this._cachedValue = undefined\n    this._hasCachedValue = false\n  }\n\n  _recalculate() {\n    if (this.isHot) {\n      if (!this._hasCachedValue) {\n        this._cachedValue = this._getValueFromSource()\n        this._hasCachedValue = true\n      }\n      return this._cachedValue as V\n    } else {\n      return this._getValueFromSource()\n    }\n  }\n\n  _keepHot() {\n    this._hasCachedValue = false\n    this._cachedValue = undefined\n\n    this._untapFromChanges = this._tapToSource((newValue) => {\n      this._hasCachedValue = true\n      this._cachedValue = newValue\n      this._markAsStale(this)\n    })\n  }\n\n  _becomeCold() {\n    this._untapFromChanges()\n    this._untapFromChanges = noop\n\n    this._hasCachedValue = false\n    this._cachedValue = undefined\n  }\n\n  _reactToDependencyBecomingStale() {}\n}\n","import type {$IntentionalAny} from './types'\n\ntype PathToProp = Array<string | number>\n\ntype PointerMeta = {\n  root: {}\n  path: (string | number)[]\n}\n\nexport type UnindexableTypesForPointer =\n  | number\n  | string\n  | boolean\n  | null\n  | void\n  | undefined\n  | Function // eslint-disable-line @typescript-eslint/ban-types\n\nexport type UnindexablePointer = {\n  [K in $IntentionalAny]: Pointer<undefined>\n}\n\nconst pointerMetaWeakMap = new WeakMap<{}, PointerMeta>()\n\nexport type PointerType<O> = {\n  $$__pointer_type: O\n}\n\nexport type Pointer<O> = PointerType<O> &\n  (O extends UnindexableTypesForPointer\n    ? UnindexablePointer\n    : unknown extends O\n    ? UnindexablePointer\n    : O extends (infer T)[]\n    ? Pointer<T>[]\n    : O extends {}\n    ? {\n        [K in keyof O]-?: Pointer<O[K]>\n      } /*&\n        {[K in string | number]: Pointer<K extends keyof O ? O[K] : undefined>}*/\n    : UnindexablePointer)\n\nconst pointerMetaSymbol = Symbol('pointerMeta')\n\nconst cachedSubPointersWeakMap = new WeakMap<\n  {},\n  Record<string | number, Pointer<unknown>>\n>()\n\nconst handler = {\n  get(obj: {}, prop: string | typeof pointerMetaSymbol): $IntentionalAny {\n    if (prop === pointerMetaSymbol) return pointerMetaWeakMap.get(obj)!\n\n    let subs = cachedSubPointersWeakMap.get(obj)\n    if (!subs) {\n      subs = {}\n      cachedSubPointersWeakMap.set(obj, subs)\n    }\n\n    if (subs[prop]) return subs[prop]\n\n    const meta = pointerMetaWeakMap.get(obj)!\n\n    const subPointer = pointer({root: meta.root, path: [...meta.path, prop]})\n    subs[prop] = subPointer\n    return subPointer\n  },\n}\n\nexport const getPointerMeta = (\n  p: Pointer<$IntentionalAny> | Pointer<{}> | Pointer<unknown>,\n): PointerMeta => {\n  // @ts-ignore @todo\n  const meta: PointerMeta = p[\n    pointerMetaSymbol as unknown as $IntentionalAny\n  ] as $IntentionalAny\n  return meta\n}\n\nexport const getPointerParts = (\n  p: Pointer<$IntentionalAny> | Pointer<{}> | Pointer<unknown>,\n): {root: {}; path: PathToProp} => {\n  const {root, path} = getPointerMeta(p)\n  return {root, path}\n}\n\nfunction pointer<O>({\n  root,\n  path,\n}: {\n  root: {}\n  path: Array<string | number>\n}): Pointer<O>\nfunction pointer(args: {root: {}; path?: Array<string | number>}) {\n  const meta: PointerMeta = {\n    root: args.root as $IntentionalAny,\n    path: args.path ?? [],\n  }\n  const hiddenObj = {}\n  pointerMetaWeakMap.set(hiddenObj, meta)\n  return new Proxy(hiddenObj, handler) as Pointer<$IntentionalAny>\n}\n\nexport default pointer\n\nexport const isPointer = (p: $IntentionalAny): p is Pointer<unknown> => {\n  return p && !!getPointerMeta(p)\n}\n","import type {$FixMe, $IntentionalAny} from '../types'\n\nexport default function updateDeep<S>(\n  state: S,\n  path: (string | number | undefined)[],\n  reducer: (...args: $IntentionalAny[]) => $IntentionalAny,\n): S {\n  if (path.length === 0) return reducer(state)\n  return hoop(state, path as $IntentionalAny, reducer)\n}\n\nconst hoop = (\n  s: $FixMe,\n  path: (string | number)[],\n  reducer: $FixMe,\n): $FixMe => {\n  if (path.length === 0) {\n    return reducer(s)\n  }\n  if (Array.isArray(s)) {\n    let [index, ...restOfPath] = path\n    index = parseInt(String(index), 10)\n    if (isNaN(index)) index = 0\n    const oldVal = s[index]\n    const newVal = hoop(oldVal, restOfPath, reducer)\n    if (oldVal === newVal) return s\n    const newS = [...s]\n    newS.splice(index, 1, newVal)\n    return newS\n  } else if (typeof s === 'object' && s !== null) {\n    const [key, ...restOfPath] = path\n    const oldVal = s[key]\n    const newVal = hoop(oldVal, restOfPath, reducer)\n    if (oldVal === newVal) return s\n    const newS = {...s, [key]: newVal}\n    return newS\n  } else {\n    const [key, ...restOfPath] = path\n\n    return {[key]: hoop(undefined, restOfPath, reducer)}\n  }\n}\n","import DerivationFromSource from './derivations/DerivationFromSource'\nimport type {IDerivation} from './derivations/IDerivation'\nimport Emitter from './utils/Emitter'\nexport interface IBox<V> {\n  set(v: V): void\n  get(): V\n  derivation: IDerivation<V>\n}\n\nexport default class Box<V> implements IBox<V> {\n  private _publicDerivation: IDerivation<V>\n  private _emitter = new Emitter<V>()\n\n  constructor(protected _value: V) {\n    this._publicDerivation = new DerivationFromSource(\n      (listener) => this._emitter.tappable.tap(listener),\n      this.get.bind(this),\n    )\n  }\n\n  set(v: V) {\n    if (v === this._value) return\n    this._value = v\n    this._emitter.emit(v)\n  }\n\n  get() {\n    return this._value\n  }\n\n  get derivation() {\n    return this._publicDerivation\n  }\n}\n","import AbstractDerivation from './AbstractDerivation'\n\nexport default class ConstantDerivation<V> extends AbstractDerivation<V> {\n  _v: V\n\n  constructor(v: V) {\n    super()\n    this._v = v\n    return this\n  }\n\n  _recalculate() {\n    return this._v\n  }\n\n  _reactToDependencyBecomingStale() {}\n}\n","import {valueDerivation} from '../Atom'\nimport type {Pointer} from '../pointer'\nimport {isPointer} from '../pointer'\nimport type {IDerivation} from './IDerivation'\nimport {isDerivation} from './IDerivation'\n\nexport default function* iterateAndCountTicks<V>(\n  pointerOrDerivation: IDerivation<V> | Pointer<V>,\n): Generator<{value: V; ticks: number}, void, void> {\n  let d\n  if (isPointer(pointerOrDerivation)) {\n    d = valueDerivation(pointerOrDerivation) as IDerivation<V>\n  } else if (isDerivation(pointerOrDerivation)) {\n    d = pointerOrDerivation\n  } else {\n    throw new Error(`Only pointers and derivations are supported`)\n  }\n\n  let ticksCountedSinceLastYield = 0\n  const untap = d.changesWithoutValues().tap(() => {\n    ticksCountedSinceLastYield++\n  })\n\n  try {\n    while (true) {\n      const ticks = ticksCountedSinceLastYield\n      ticksCountedSinceLastYield = 0\n      yield {value: d.getValue(), ticks}\n    }\n  } finally {\n    untap()\n  }\n}\n","type ICallback = (t: number) => void\n\nexport default class Ticker {\n  private _scheduledForThisOrNextTick: Set<ICallback>\n  private _scheduledForNextTick: Set<ICallback>\n  private _timeAtCurrentTick: number\n  private _ticking: boolean = false\n\n  constructor() {\n    this._scheduledForThisOrNextTick = new Set()\n    this._scheduledForNextTick = new Set()\n    this._timeAtCurrentTick = 0\n  }\n\n  /**\n   * Registers for fn to be called either on this tick or the next tick.\n   *\n   * If registerSideEffect() is called while Ticker.tick() is running, the\n   * side effect _will_ be called within the running tick. If you don't want this\n   * behavior, you can use registerSideEffectForNextTick().\n   *\n   * Note that fn will be added to a Set(). Which means, if you call registerSideEffect(fn)\n   * with the same fn twice in a single tick, it'll only run once.\n   */\n  onThisOrNextTick(fn: ICallback) {\n    this._scheduledForThisOrNextTick.add(fn)\n  }\n\n  /**\n   * Registers a side effect to be called on the next tick.\n   *\n   * @see Ticker:onThisOrNextTick()\n   */\n  onNextTick(fn: ICallback) {\n    this._scheduledForNextTick.add(fn)\n  }\n\n  offThisOrNextTick(fn: ICallback) {\n    this._scheduledForThisOrNextTick.delete(fn)\n  }\n\n  offNextTick(fn: ICallback) {\n    this._scheduledForNextTick.delete(fn)\n  }\n\n  get time() {\n    if (this._ticking) {\n      return this._timeAtCurrentTick\n    } else return performance.now()\n  }\n\n  tick(t: number = performance.now()) {\n    this._ticking = true\n    this._timeAtCurrentTick = t\n    this._scheduledForNextTick.forEach((v) =>\n      this._scheduledForThisOrNextTick.add(v),\n    )\n    this._scheduledForNextTick.clear()\n    this._tick(0)\n    this._ticking = false\n  }\n\n  private _tick(iterationNumber: number): void {\n    const time = this.time\n\n    if (iterationNumber > 10) {\n      console.warn('_tick() recursing for 10 times')\n    }\n\n    if (iterationNumber > 100) {\n      throw new Error(`Maximum recursion limit for _tick()`)\n    }\n\n    const oldSet = this._scheduledForThisOrNextTick\n    this._scheduledForThisOrNextTick = new Set()\n    oldSet.forEach((fn) => {\n      fn(time)\n    })\n\n    if (this._scheduledForThisOrNextTick.size > 0) {\n      return this._tick(iterationNumber + 1)\n    }\n  }\n}\n","import {valueDerivation} from '../Atom'\nimport type {Pointer} from '../pointer'\nimport {isPointer} from '../pointer'\nimport Ticker from '../Ticker'\nimport type {IDerivation} from './IDerivation'\nimport {isDerivation} from './IDerivation'\n\nexport default function* iterateOver<V>(\n  pointerOrDerivation: IDerivation<V> | Pointer<V>,\n): Generator<V, void, void> {\n  let d\n  if (isPointer(pointerOrDerivation)) {\n    d = valueDerivation(pointerOrDerivation) as IDerivation<V>\n  } else if (isDerivation(pointerOrDerivation)) {\n    d = pointerOrDerivation\n  } else {\n    throw new Error(`Only pointers and derivations are supported`)\n  }\n\n  const ticker = new Ticker()\n\n  const untap = d.changes(ticker).tap((v) => {})\n\n  try {\n    while (true) {\n      ticker.tick()\n\n      yield d.getValue()\n    }\n  } finally {\n    untap()\n  }\n}\n","import Box from '../../Box'\nimport type {$IntentionalAny, VoidFn} from '../../types'\nimport Stack from '../../utils/Stack'\nimport AbstractDerivation from '../AbstractDerivation'\nimport type {IDerivation} from '../IDerivation'\nimport {\n  startIgnoringDependencies,\n  stopIgnoringDependencies,\n  pushCollector,\n  popCollector,\n} from './discoveryMechanism'\n\nconst voidFn = () => {}\n\nexport class PrismDerivation<V> extends AbstractDerivation<V> {\n  protected _cacheOfDendencyValues: Map<IDerivation<unknown>, unknown> =\n    new Map()\n  protected _possiblyStaleDeps = new Set<IDerivation<unknown>>()\n  private _prismScope = new PrismScope()\n\n  constructor(readonly _fn: () => V) {\n    super()\n  }\n\n  _recalculate() {\n    let value: V\n\n    if (this._possiblyStaleDeps.size > 0) {\n      let anActuallyStaleDepWasFound = false\n      startIgnoringDependencies()\n      for (const dep of this._possiblyStaleDeps) {\n        if (this._cacheOfDendencyValues.get(dep) !== dep.getValue()) {\n          anActuallyStaleDepWasFound = true\n          break\n        }\n      }\n      stopIgnoringDependencies()\n      this._possiblyStaleDeps.clear()\n      if (!anActuallyStaleDepWasFound) {\n        // console.log('ok')\n\n        return this._lastValue!\n      }\n    }\n\n    const newDeps: Set<IDerivation<unknown>> = new Set()\n    this._cacheOfDendencyValues.clear()\n\n    const collector = (observedDep: IDerivation<unknown>): void => {\n      newDeps.add(observedDep)\n      this._addDependency(observedDep)\n    }\n\n    pushCollector(collector)\n\n    hookScopeStack.push(this._prismScope)\n    try {\n      value = this._fn()\n    } catch (error) {\n      console.error(error)\n    } finally {\n      const topOfTheStack = hookScopeStack.pop()\n      if (topOfTheStack !== this._prismScope) {\n        console.warn(\n          // @todo guide the user to report the bug in an issue\n          `The Prism hook stack has slipped. This is a bug.`,\n        )\n      }\n    }\n\n    popCollector(collector)\n\n    this._dependencies.forEach((dep) => {\n      if (!newDeps.has(dep)) {\n        this._removeDependency(dep)\n      }\n    })\n\n    this._dependencies = newDeps\n\n    startIgnoringDependencies()\n    newDeps.forEach((dep) => {\n      this._cacheOfDendencyValues.set(dep, dep.getValue())\n    })\n    stopIgnoringDependencies()\n\n    return value!\n  }\n\n  _reactToDependencyBecomingStale(msgComingFrom: IDerivation<unknown>) {\n    this._possiblyStaleDeps.add(msgComingFrom)\n  }\n\n  _keepHot() {\n    this._prismScope = new PrismScope()\n    startIgnoringDependencies()\n    this.getValue()\n    stopIgnoringDependencies()\n  }\n\n  _becomeCold() {\n    cleanupScopeStack(this._prismScope)\n    this._prismScope = new PrismScope()\n  }\n}\n\nclass PrismScope {\n  isPrismScope = true\n  private _subs: Record<string, PrismScope> = {}\n\n  sub(key: string) {\n    if (!this._subs[key]) {\n      this._subs[key] = new PrismScope()\n    }\n    return this._subs[key]\n  }\n\n  get subs() {\n    return this._subs\n  }\n}\n\nfunction cleanupScopeStack(scope: PrismScope) {\n  for (const [_, sub] of Object.entries(scope.subs)) {\n    cleanupScopeStack(sub)\n  }\n  cleanupEffects(scope)\n}\n\nfunction cleanupEffects(scope: PrismScope) {\n  const effects = effectsWeakMap.get(scope)\n  if (effects) {\n    for (const k of Object.keys(effects)) {\n      const effect = effects[k]\n      safelyRun(effect.cleanup, undefined)\n    }\n  }\n  effectsWeakMap.delete(scope)\n}\n\nfunction safelyRun<T, U>(\n  fn: () => T,\n  returnValueInCaseOfError: U,\n): {success: boolean; returnValue: T | U} {\n  let returnValue: T | U = returnValueInCaseOfError\n  let success = false\n  try {\n    returnValue = fn()\n    success = true\n  } catch (error) {\n    setTimeout(() => {\n      throw error\n    })\n  }\n  return {success, returnValue}\n}\n\nconst hookScopeStack = new Stack<PrismScope>()\n\nconst refsWeakMap = new WeakMap<PrismScope, Record<string, IRef<unknown>>>()\n\ntype IRef<T> = {\n  current: T\n}\nconst effectsWeakMap = new WeakMap<PrismScope, Record<string, IEffect>>()\n\ntype IEffect = {\n  deps: undefined | unknown[]\n  cleanup: VoidFn\n}\n\nconst memosWeakMap = new WeakMap<PrismScope, Record<string, IMemo>>()\n\ntype IMemo = {\n  deps: undefined | unknown[] | ReadonlyArray<unknown>\n  cachedValue: unknown\n}\n\nfunction ref<T>(key: string, initialValue: T): IRef<T> {\n  const scope = hookScopeStack.peek()\n  if (!scope) {\n    throw new Error(`prism.ref() is called outside of a prism() call.`)\n  }\n  let refs = refsWeakMap.get(scope)\n  if (!refs) {\n    refs = {}\n    refsWeakMap.set(scope, refs)\n  }\n\n  if (refs[key]) {\n    return refs[key] as $IntentionalAny as IRef<T>\n  } else {\n    const ref: IRef<T> = {\n      current: initialValue,\n    }\n    refs[key] = ref\n    return ref\n  }\n}\n\nfunction effect(key: string, cb: () => () => void, deps?: unknown[]): void {\n  const scope = hookScopeStack.peek()\n  if (!scope) {\n    throw new Error(`prism.effect() is called outside of a prism() call.`)\n  }\n  let effects = effectsWeakMap.get(scope)\n\n  if (!effects) {\n    effects = {}\n    effectsWeakMap.set(scope, effects)\n  }\n\n  if (!effects[key]) {\n    effects[key] = {\n      cleanup: voidFn,\n      deps: [{}],\n    }\n  }\n\n  const effect = effects[key]\n  if (depsHaveChanged(effect.deps, deps)) {\n    effect.cleanup()\n\n    startIgnoringDependencies()\n    effect.cleanup = safelyRun(cb, voidFn).returnValue\n    stopIgnoringDependencies()\n    effect.deps = deps\n  }\n}\n\nfunction depsHaveChanged(\n  oldDeps: undefined | unknown[] | ReadonlyArray<unknown>,\n  newDeps: undefined | unknown[] | ReadonlyArray<unknown>,\n): boolean {\n  if (oldDeps === undefined || newDeps === undefined) {\n    return true\n  } else if (oldDeps.length !== newDeps.length) {\n    return true\n  } else {\n    return oldDeps.some((el, i) => el !== newDeps[i])\n  }\n}\n\nfunction memo<T>(\n  key: string,\n  fn: () => T,\n  deps: undefined | $IntentionalAny[] | ReadonlyArray<$IntentionalAny>,\n): T {\n  const scope = hookScopeStack.peek()\n  if (!scope) {\n    throw new Error(`prism.memo() is called outside of a prism() call.`)\n  }\n\n  let memos = memosWeakMap.get(scope)\n\n  if (!memos) {\n    memos = {}\n    memosWeakMap.set(scope, memos)\n  }\n\n  if (!memos[key]) {\n    memos[key] = {\n      cachedValue: null,\n      deps: [{}],\n    }\n  }\n\n  const memo = memos[key]\n  if (depsHaveChanged(memo.deps, deps)) {\n    startIgnoringDependencies()\n\n    memo.cachedValue = safelyRun(fn, undefined).returnValue\n    stopIgnoringDependencies()\n    memo.deps = deps\n  }\n\n  return memo.cachedValue as $IntentionalAny as T\n}\n\nfunction state<T>(key: string, initialValue: T): [T, (val: T) => void] {\n  const {b, setValue} = prism.memo(\n    'state/' + key,\n    () => {\n      const b = new Box<T>(initialValue)\n      const setValue = (val: T) => b.set(val)\n      return {b, setValue}\n    },\n    [],\n  )\n\n  return [b.derivation.getValue(), setValue]\n}\n\nfunction ensurePrism(): void {\n  const scope = hookScopeStack.peek()\n  if (!scope) {\n    throw new Error(`The parent function is called outside of a prism() call.`)\n  }\n}\n\nfunction scope<T>(key: string, fn: () => T): T {\n  const parentScope = hookScopeStack.peek()\n  if (!parentScope) {\n    throw new Error(`prism.scope() is called outside of a prism() call.`)\n  }\n  const subScope = parentScope.sub(key)\n  hookScopeStack.push(subScope)\n  const ret = safelyRun(fn, undefined).returnValue\n  hookScopeStack.pop()\n  return ret as $IntentionalAny as T\n}\n\nfunction sub<T>(\n  key: string,\n  fn: () => T,\n  deps: undefined | $IntentionalAny[],\n): T {\n  return memo(key, () => prism(fn), deps).getValue()\n}\n\nfunction inPrism(): boolean {\n  return !!hookScopeStack.peek()\n}\n\ntype IPrismFn = {\n  <T>(fn: () => T): IDerivation<T>\n  ref: typeof ref\n  effect: typeof effect\n  memo: typeof memo\n  ensurePrism: typeof ensurePrism\n  state: typeof state\n  scope: typeof scope\n  sub: typeof sub\n  inPrism: typeof inPrism\n}\n\nconst prism: IPrismFn = (fn) => {\n  return new PrismDerivation(fn)\n}\n\nprism.ref = ref\nprism.effect = effect\nprism.memo = memo\nprism.ensurePrism = ensurePrism\nprism.state = state\nprism.scope = scope\nprism.sub = sub\nprism.inPrism = inPrism\n\nexport default prism\n","// Generated by CoffeeScript 1.8.0\n\n/*\n * Source: http://stackoverflow.com/a/11697909/607997\n * http://codepen.io/onedayitwillmake/details/EHDmw\n * by Mario Gonzalez\n */\n\n/*\n * Solver for cubic bezier curve with implicit control points at (0,0) and (1.0, 1.0)\n */\nvar UnitBezier;\n\nmodule.exports = UnitBezier = (function() {\n  function UnitBezier(p1x, p1y, p2x, p2y) {\n    this.set(p1x, p1y, p2x, p2y);\n  }\n\n  UnitBezier.prototype.set = function(p1x, p1y, p2x, p2y) {\n    this._cx = 3.0 * p1x;\n    this._bx = 3.0 * (p2x - p1x) - this._cx;\n    this._ax = 1.0 - this._cx - this._bx;\n    this._cy = 3.0 * p1y;\n    this._by = 3.0 * (p2y - p1y) - this._cy;\n    this._ay = 1.0 - this._cy - this._by;\n  };\n\n  UnitBezier.epsilon = 1e-6;\n\n  UnitBezier.prototype._sampleCurveX = function(t) {\n    return ((this._ax * t + this._bx) * t + this._cx) * t;\n  };\n\n  UnitBezier.prototype._sampleCurveY = function(t) {\n    return ((this._ay * t + this._by) * t + this._cy) * t;\n  };\n\n  UnitBezier.prototype._sampleCurveDerivativeX = function(t) {\n    return (3.0 * this._ax * t + 2.0 * this._bx) * t + this._cx;\n  };\n\n  UnitBezier.prototype._solveCurveX = function(x, epsilon) {\n    var d2, i, t0, t1, t2, x2;\n    t0 = void 0;\n    t1 = void 0;\n    t2 = void 0;\n    x2 = void 0;\n    d2 = void 0;\n    i = void 0;\n    t2 = x;\n    i = 0;\n    while (i < 8) {\n      x2 = this._sampleCurveX(t2) - x;\n      if (Math.abs(x2) < epsilon) {\n        return t2;\n      }\n      d2 = this._sampleCurveDerivativeX(t2);\n      if (Math.abs(d2) < epsilon) {\n        break;\n      }\n      t2 = t2 - x2 / d2;\n      i++;\n    }\n    t0 = 0.0;\n    t1 = 1.0;\n    t2 = x;\n    if (t2 < t0) {\n      return t0;\n    }\n    if (t2 > t1) {\n      return t1;\n    }\n    while (t0 < t1) {\n      x2 = this._sampleCurveX(t2);\n      if (Math.abs(x2 - x) < epsilon) {\n        return t2;\n      }\n      if (x > x2) {\n        t0 = t2;\n      } else {\n        t1 = t2;\n      }\n      t2 = (t1 - t0) * .5 + t0;\n    }\n    return t2;\n  };\n\n  UnitBezier.prototype.solve = function(x, epsilon) {\n    return this._sampleCurveY(this._solveCurveX(x, epsilon));\n  };\n\n  UnitBezier.prototype.solveSimple = function(x) {\n    return this._sampleCurveY(this._solveCurveX(x, 1e-6));\n  };\n\n  return UnitBezier;\n\n})();\n","var cache,\n    codes;\n\ncache = [];\ncodes = [];\n\nfunction levenshtein(value, other, insensitive) {\n    var length,\n        lengthOther,\n        code,\n        result,\n        distance,\n        distanceOther,\n        index,\n        indexOther;\n\n    if (value === other) {\n        return 0;\n    }\n\n    length = value.length;\n    lengthOther = other.length;\n\n    if (length === 0) {\n        return lengthOther;\n    }\n\n    if (lengthOther === 0) {\n        return length;\n    }\n\n    if (insensitive) {\n        value = value.toLowerCase();\n        other = other.toLowerCase();\n    }\n\n    index = 0;\n\n    while (index < length) {\n        codes[index] = value.charCodeAt(index);\n        cache[index] = ++index;\n    }\n\n    indexOther = 0;\n\n    while (indexOther < lengthOther) {\n        code = other.charCodeAt(indexOther);\n\n        result = distance = indexOther++;\n\n        index = -1;\n\n        while (++index < length) {\n            distanceOther = code === codes[index] ? distance : distance + 1;\n\n            distance = cache[index];\n\n            cache[index] = result = distance > result\n                ? distanceOther > result\n                    ? result + 1\n                    : distanceOther\n                : distanceOther > distance\n                    ? distance + 1\n                    : distanceOther;\n        }\n    }\n\n    return result;\n}\n\nmodule.exports = levenshtein;\n","var levenshtein = require('levenshtein-edit-distance');\r\n\r\nfunction propose() {\r\n    var ratio;\r\n    var distance;\r\n    var proposed;\r\n    var threshold;\r\n    var ignoreCase;\r\n    var max_ratio = 0;\r\n    var word = arguments[0];\r\n    var dictionary = arguments[1];\r\n    var len = dictionary.length;\r\n    var options = arguments[2];\r\n\r\n    if (options) {\r\n        threshold = options.threshold;\r\n        ignoreCase = options.ignoreCase;\r\n    }\r\n\r\n    if (threshold === undefined)\r\n        threshold = 0;\r\n\r\n    for (var i = 0; i < len; ++i) {\r\n        if (ignoreCase)\r\n            distance = levenshtein(word, dictionary[i], true);\r\n        else\r\n            distance = levenshtein(word, dictionary[i]);\r\n\r\n        if (distance > word.length)\r\n            ratio = 1 - distance / dictionary[i].length;\r\n        else\r\n            ratio = 1 - distance / word.length;\r\n\r\n        if (ratio > max_ratio) {\r\n            max_ratio = ratio;\r\n            proposed = dictionary[i];\r\n        }\r\n    }\r\n\r\n    if (max_ratio >= threshold)\r\n        return proposed;\r\n\r\n    return null;\r\n}\r\n\r\nmodule.exports = propose;","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","import projectsSingleton from '@theatre/core/projects/projectsSingleton'\nimport type {OnDiskState} from '@theatre/core/projects/store/storeTypes'\nimport type {\n  IProject,\n  IProjectConfig,\n} from '@theatre/core/projects/TheatreProject'\nimport TheatreProject from '@theatre/core/projects/TheatreProject'\nimport globals from '@theatre/shared/globals'\nimport * as types from '@theatre/core/propTypes'\nimport {InvalidArgumentError} from '@theatre/shared/utils/errors'\nimport {validateName} from '@theatre/shared/utils/sanitizers'\nimport userReadableTypeOfValue from '@theatre/shared/utils/userReadableTypeOfValue'\nimport deepEqual from 'fast-deep-equal'\nimport type {PointerType} from '@theatre/dataverse'\nimport {isPointer} from '@theatre/dataverse'\nimport {isDerivation, valueDerivation} from '@theatre/dataverse'\nimport type {$IntentionalAny, VoidFn} from '@theatre/shared/utils/types'\nimport coreTicker from './coreTicker'\nexport {types}\n\n/**\n * Returns a project of the given id, or creates one if it doesn't already exist.\n *\n * @remarks\n * If \\@theatre/studio is also loaded, then the state of the project will be managed by the studio.\n *\n * [Learn more about exporting](https://docs.theatrejs.com/in-depth/#exporting)\n *\n * @example\n * Usage:\n * ```ts\n * import {getProject} from '@theatre/core'\n * const config = {} // the config can be empty when starting a new project\n * const project = getProject(\"a-unique-id\", config)\n * ```\n *\n * @example\n * Usage with an explicit state:\n * ```ts\n * import {getProject} from '@theatre/core'\n * import state from './saved-state.json'\n * const config = {state} // here the config contains our saved state\n * const project = getProject(\"a-unique-id\", config)\n * ```\n */\nexport function getProject(id: string, config: IProjectConfig = {}): IProject {\n  const {...restOfConfig} = config\n  const existingProject = projectsSingleton.get(id)\n  if (existingProject) {\n    if (process.env.NODE_ENV !== 'production') {\n      if (!deepEqual(config, existingProject.config)) {\n        throw new Error(\n          `You seem to have called Theatre.getProject(\"${id}\", config) twice, with different config objects. ` +\n            `This is disallowed because changing the config of a project on the fly can lead to hard-to-debug issues.\\n\\n` +\n            `You can fix this by either calling Theatre.getProject() once per projectId,` +\n            ` or calling it multiple times but with the exact same config.`,\n        )\n      }\n    }\n    return existingProject.publicApi\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    validateName(id, 'projectName in Theatre.getProject(projectName)', true)\n    validateProjectIdOrThrow(id)\n  }\n\n  if (config.state) {\n    if (process.env.NODE_ENV !== 'production') {\n      shallowValidateOnDiskState(id, config.state)\n    } else {\n      deepValidateOnDiskState(id, config.state)\n    }\n  }\n\n  return new TheatreProject(id, restOfConfig)\n}\n\n/**\n * Lightweight validator that only makes sure the state's definitionVersion is correct.\n * Does not do a thorough validation of the state.\n */\nconst shallowValidateOnDiskState = (projectId: string, s: OnDiskState) => {\n  if (\n    Array.isArray(s) ||\n    s == null ||\n    s.definitionVersion !== globals.currentProjectStateDefinitionVersion\n  ) {\n    throw new InvalidArgumentError(\n      `Error validating conf.state in Theatre.getProject(${JSON.stringify(\n        projectId,\n      )}, conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://docs.theatrejs.com`,\n    )\n  }\n}\n\nconst deepValidateOnDiskState = (projectId: string, s: OnDiskState) => {\n  shallowValidateOnDiskState(projectId, s)\n  // @TODO do a deep validation here\n}\n\nconst validateProjectIdOrThrow = (value: string) => {\n  if (typeof value !== 'string') {\n    throw new InvalidArgumentError(\n      `Argument 'projectId' in \\`Theatre.getProject(projectId, ...)\\` must be a string. Instead, it was ${userReadableTypeOfValue(\n        value,\n      )}.`,\n    )\n  }\n\n  const idTrimmed = value.trim()\n  if (idTrimmed.length !== value.length) {\n    throw new InvalidArgumentError(\n      `Argument 'projectId' in \\`Theatre.getProject(\"${value}\", ...)\\` should not have surrounding whitespace.`,\n    )\n  }\n\n  if (idTrimmed.length < 3) {\n    throw new InvalidArgumentError(\n      `Argument 'projectId' in \\`Theatre.getProject(\"${value}\", ...)\\` should be at least 3 characters long.`,\n    )\n  }\n}\n\n/**\n * Calls `callback` every time the pointed value of `pointer` changes.\n *\n * @param pointer - A Pointer (like `object.props.x`)\n * @param callback - The callback is called every time the value of pointer changes\n * @returns An unsubscribe function\n *\n * @example\n * Usage:\n * ```ts\n * import {getProject, onChange} from '@theatre/core'\n *\n * const obj = getProject(\"A project\").sheet(\"Scene\").object(\"Box\", {position: {x: 0}})\n *\n * const usubscribe = onChange(obj.props.position.x, (x) => {\n *   console.log('position.x changed to:', x)\n * })\n *\n * setTimeout(usubscribe, 10000) // stop listening to changes after 10 seconds\n * ```\n */\nexport function onChange<P extends PointerType<$IntentionalAny>>(\n  pointer: P,\n  callback: (value: P extends PointerType<infer T> ? T : unknown) => void,\n): VoidFn {\n  if (isPointer(pointer)) {\n    const derivation = valueDerivation(pointer)\n    return derivation.tapImmediate(coreTicker, callback as $IntentionalAny)\n  } else if (isDerivation(pointer)) {\n    return pointer.tapImmediate(coreTicker, callback as $IntentionalAny)\n  } else {\n    throw new Error(\n      `Called onChange(p) where p is neither a pointer nor a derivation.`,\n    )\n  }\n}\n\n/**\n * Takes a Pointer and returns the value it points to.\n *\n * @param pointer - A pointer (like `object.props.x`)\n * @returns The value the pointer points to\n *\n * @example\n *\n * Usage\n * ```ts\n * import {val, getProject} from '@theatre/core'\n *\n * const obj = getProject(\"A project\").sheet(\"Scene\").object(\"Box\", {position: {x: 0}})\n *\n * console.log(val(obj.props.position.x)) // logs the value of obj.props.x\n * ```\n */\nexport function val<T>(pointer: PointerType<T>): T {\n  if (isPointer(pointer)) {\n    return valueDerivation(pointer).getValue() as $IntentionalAny\n  } else {\n    throw new Error(`Called val(p) where p is not a pointer.`)\n  }\n}\n","import {Atom} from '@theatre/dataverse'\nimport type Project from './Project'\n\ninterface State {\n  projects: Record<string, Project>\n}\n\nclass ProjectsSingleton {\n  readonly atom = new Atom({projects: {}} as State)\n  constructor() {}\n\n  /**\n   * We're trusting here that each project id is unique\n   */\n  add(id: string, project: Project) {\n    this.atom.reduceState(['projects', id], () => project)\n  }\n\n  get(id: string): Project | undefined {\n    return this.atom.getState().projects[id]\n  }\n\n  has(id: string) {\n    return !!this.get(id)\n  }\n}\n\nconst singleton = new ProjectsSingleton()\n\nexport default singleton\n","import type {IProject} from '@theatre/core/projects/TheatreProject'\nimport type Project from '@theatre/core/projects/Project'\nimport type Sequence from '@theatre/core/sequences/Sequence'\nimport type {ISequence} from '@theatre/core/sequences/TheatreSequence'\nimport type SheetObject from '@theatre/core/sheetObjects/SheetObject'\nimport type {ISheetObject} from '@theatre/core/sheetObjects/TheatreSheetObject'\nimport type Sheet from '@theatre/core/sheets/Sheet'\nimport type {ISheet} from '@theatre/core/sheets/TheatreSheet'\nimport type {$IntentionalAny} from '@theatre/shared/utils/types'\n\nconst publicAPIToPrivateAPIMap = new WeakMap()\n\nexport function privateAPI<\n  P extends IProject | ISheet | ISheetObject<$IntentionalAny> | ISequence,\n>(\n  pub: P,\n): P extends IProject\n  ? Project\n  : P extends ISheet\n  ? Sheet\n  : P extends ISheetObject<$IntentionalAny>\n  ? SheetObject\n  : P extends ISequence\n  ? Sequence\n  : never {\n  return publicAPIToPrivateAPIMap.get(pub)\n}\n\nexport function setPrivateAPI(pub: IProject, priv: Project): void\nexport function setPrivateAPI(pub: ISheet, priv: Sheet): void\nexport function setPrivateAPI(pub: ISequence, priv: Sequence): void\nexport function setPrivateAPI(\n  pub: ISheetObject<$IntentionalAny>,\n  priv: SheetObject,\n): void\nexport function setPrivateAPI(pub: {}, priv: {}): void {\n  publicAPIToPrivateAPIMap.set(pub, priv)\n}\n","import type {VoidFn} from './types'\n\nexport const voidFn: VoidFn = () => {}\n\nexport const emptyObject = {}\nexport const emptyArray: ReadonlyArray<unknown> = []\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n","import isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/;\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\nexport default isKey;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","import MapCache from './_MapCache.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `clear`, `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver != null && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result) || cache;\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Expose `MapCache`.\nmemoize.Cache = MapCache;\n\nexport default memoize;\n","import memoize from './memoize.js';\n\n/** Used as the maximum memoize cache size. */\nvar MAX_MEMOIZE_SIZE = 500;\n\n/**\n * A specialized version of `_.memoize` which clears the memoized function's\n * cache when it exceeds `MAX_MEMOIZE_SIZE`.\n *\n * @private\n * @param {Function} func The function to have its output memoized.\n * @returns {Function} Returns the new memoized function.\n */\nfunction memoizeCapped(func) {\n  var result = memoize(func, function(key) {\n    if (cache.size === MAX_MEMOIZE_SIZE) {\n      cache.clear();\n    }\n    return key;\n  });\n\n  var cache = result.cache;\n  return result;\n}\n\nexport default memoizeCapped;\n","import memoizeCapped from './_memoizeCapped.js';\n\n/** Used to match property names within property paths. */\nvar rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoizeCapped(function(string) {\n  var result = [];\n  if (string.charCodeAt(0) === 46 /* . */) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, subString) {\n    result.push(quote ? subString.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\nexport default stringToPath;\n","/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\nexport default arrayMap;\n","import Symbol from './_Symbol.js';\nimport arrayMap from './_arrayMap.js';\nimport isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isArray(value)) {\n    // Recursively convert values (susceptible to call stack limits).\n    return arrayMap(value, baseToString) + '';\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default baseToString;\n","import baseToString from './_baseToString.js';\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\nexport default toString;\n","import isArray from './isArray.js';\nimport isKey from './_isKey.js';\nimport stringToPath from './_stringToPath.js';\nimport toString from './toString.js';\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @param {Object} [object] The object to query keys on.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value, object) {\n  if (isArray(value)) {\n    return value;\n  }\n  return isKey(value, object) ? [value] : stringToPath(toString(value));\n}\n\nexport default castPath;\n","import isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default toKey;\n","import castPath from './_castPath.js';\nimport toKey from './_toKey.js';\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = castPath(path, object);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\nexport default baseGet;\n","import baseGet from './_baseGet.js';\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\nexport default get;\n","import lodashGet from 'lodash-es/get'\nimport type {PathToProp} from './addresses'\nimport type {SerializableValue} from './types'\n\nexport default function getDeep(\n  v: SerializableValue,\n  path: PathToProp,\n): unknown {\n  if (path.length === 0) return v\n  return lodashGet(v, path)\n}\n","import type {$IntentionalAny} from './types'\n\nexport default class SimpleCache {\n  protected _values: Record<string, unknown> = {}\n  constructor() {}\n\n  get<T>(key: string, producer: () => T): T {\n    if (this.has(key)) {\n      return this._values[key] as $IntentionalAny\n    } else {\n      const cachedValue = producer()\n      this._values[key] = cachedValue\n      return cachedValue\n    }\n  }\n\n  has(key: string): boolean {\n    return this._values.hasOwnProperty(key)\n  }\n}\n","import type Project from '@theatre/core/projects/Project'\nimport type Sheet from '@theatre/core/sheets/Sheet'\nimport type SheetTemplate from '@theatre/core/sheets/SheetTemplate'\nimport type {SheetObjectConfig} from '@theatre/core/sheets/TheatreSheet'\nimport {emptyArray} from '@theatre/shared/utils'\nimport type {\n  PathToProp,\n  SheetObjectAddress,\n  WithoutSheetInstance,\n} from '@theatre/shared/utils/addresses'\nimport getDeep from '@theatre/shared/utils/getDeep'\nimport type {SequenceTrackId} from '@theatre/shared/utils/ids'\nimport SimpleCache from '@theatre/shared/utils/SimpleCache'\nimport type {\n  $FixMe,\n  $IntentionalAny,\n  SerializableMap,\n  SerializableValue,\n} from '@theatre/shared/utils/types'\nimport type {IDerivation, Pointer} from '@theatre/dataverse'\nimport {Atom, getPointerParts, prism, val} from '@theatre/dataverse'\nimport get from 'lodash-es/get'\nimport set from 'lodash-es/set'\nimport getPropDefaultsOfSheetObject from './getPropDefaultsOfSheetObject'\nimport SheetObject from './SheetObject'\nimport logger from '@theatre/shared/logger'\n\nexport type IPropPathToTrackIdTree = {\n  [key in string]?: SequenceTrackId | IPropPathToTrackIdTree\n}\n\nexport default class SheetObjectTemplate {\n  readonly address: WithoutSheetInstance<SheetObjectAddress>\n  readonly type: 'Theatre_SheetObjectTemplate' = 'Theatre_SheetObjectTemplate'\n  protected _config: Atom<SheetObjectConfig<$IntentionalAny>>\n  readonly _cache = new SimpleCache()\n  readonly project: Project\n\n  get config() {\n    return this._config.getState()\n  }\n\n  constructor(\n    readonly sheetTemplate: SheetTemplate,\n    objectKey: string,\n    nativeObject: unknown,\n    config: SheetObjectConfig<$IntentionalAny>,\n  ) {\n    this.address = {...sheetTemplate.address, objectKey}\n    this._config = new Atom(config)\n    this.project = sheetTemplate.project\n  }\n\n  createInstance(\n    sheet: Sheet,\n    nativeObject: unknown,\n    config: SheetObjectConfig<$IntentionalAny>,\n  ): SheetObject {\n    this._config.setState(config)\n    return new SheetObject(sheet, this, nativeObject)\n  }\n\n  overrideConfig(config: SheetObjectConfig<$IntentionalAny>) {\n    this._config.setState(config)\n  }\n\n  /**\n   * Returns the default values (all defaults are read from the config)\n   */\n  getDefaultValues(): IDerivation<SerializableMap> {\n    return this._cache.get('getDefaultValues()', () =>\n      prism(() => {\n        const config = val(this._config.pointer)\n        return getPropDefaultsOfSheetObject(config)\n      }),\n    )\n  }\n\n  /**\n   * Returns values that are set statically (ie, not sequenced, and not defaults)\n   */\n  getStaticValues(): IDerivation<SerializableMap> {\n    return this._cache.get('getDerivationOfStatics', () =>\n      prism(() => {\n        const pointerToSheetState =\n          this.sheetTemplate.project.pointers.historic.sheetsById[\n            this.address.sheetId\n          ]\n\n        return (\n          val(\n            pointerToSheetState.staticOverrides.byObject[\n              this.address.objectKey\n            ],\n          ) || {}\n        )\n      }),\n    )\n  }\n\n  /**\n   * Filters through the sequenced tracks those tracks who are valid\n   * according to the object's prop types.\n   *\n   * Returns an array.\n   */\n  getArrayOfValidSequenceTracks(): IDerivation<\n    Array<{pathToProp: PathToProp; trackId: SequenceTrackId}>\n  > {\n    return this._cache.get('getArrayOfValidSequenceTracks', () =>\n      prism((): Array<{pathToProp: PathToProp; trackId: SequenceTrackId}> => {\n        const defaults = val(this.getDefaultValues())\n\n        const pointerToSheetState =\n          this.project.pointers.historic.sheetsById[this.address.sheetId]\n\n        const trackIdByPropPath = val(\n          pointerToSheetState.sequence.tracksByObject[this.address.objectKey]\n            .trackIdByPropPath,\n        )\n\n        const arrayOfIds: Array<{\n          pathToProp: PathToProp\n          trackId: SequenceTrackId\n        }> = []\n\n        if (trackIdByPropPath) {\n          for (const [pathToPropInString, trackId] of Object.entries(\n            trackIdByPropPath,\n          )) {\n            let pathToProp\n            try {\n              pathToProp = JSON.parse(pathToPropInString)\n            } catch (e) {\n              logger.warn(\n                `property ${JSON.stringify(\n                  pathToPropInString,\n                )} cannot be parsed. Skipping.`,\n              )\n              continue\n            }\n            const defaultValue = get(defaults, pathToProp)\n            if (typeof defaultValue !== 'number') {\n              continue\n            }\n\n            arrayOfIds.push({pathToProp, trackId: trackId!})\n          }\n        } else {\n          return emptyArray as $IntentionalAny\n        }\n\n        if (arrayOfIds.length === 0) {\n          return emptyArray as $IntentionalAny\n        } else {\n          return arrayOfIds\n        }\n      }),\n    )\n  }\n\n  /**\n   * Filters through the sequenced tracks those tracks that are valid\n   * according to the object's prop types.\n   *\n   * Returns a map.\n   *\n   * Not available in core.\n   */\n  getMapOfValidSequenceTracks_forStudio(): IDerivation<IPropPathToTrackIdTree> {\n    return this._cache.get('getMapOfValidSequenceTracks_forStudio', () =>\n      this.getArrayOfValidSequenceTracks().map((arr) => {\n        let map = {}\n\n        for (const {pathToProp, trackId} of arr) {\n          set(map, pathToProp, trackId)\n        }\n\n        return map\n      }),\n    )\n  }\n\n  getDefaultsAtPointer(\n    pointer: Pointer<unknown>,\n  ): SerializableValue | undefined {\n    const {path} = getPointerParts(pointer)\n    const defaults = this.getDefaultValues().getValue()\n\n    const defaultsAtPath = getDeep(defaults, path)\n    return defaultsAtPath as $FixMe\n  }\n}\n","import getNative from './_getNative.js';\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nexport default defineProperty;\n","import defineProperty from './_defineProperty.js';\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nexport default baseAssignValue;\n","import baseAssignValue from './_baseAssignValue.js';\nimport eq from './eq.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nexport default assignValue;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  var type = typeof value;\n  length = length == null ? MAX_SAFE_INTEGER : length;\n\n  return !!length &&\n    (type == 'number' ||\n      (type != 'symbol' && reIsUint.test(value))) &&\n        (value > -1 && value % 1 == 0 && value < length);\n}\n\nexport default isIndex;\n","import assignValue from './_assignValue.js';\nimport castPath from './_castPath.js';\nimport isIndex from './_isIndex.js';\nimport isObject from './isObject.js';\nimport toKey from './_toKey.js';\n\n/**\n * The base implementation of `_.set`.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {Array|string} path The path of the property to set.\n * @param {*} value The value to set.\n * @param {Function} [customizer] The function to customize path creation.\n * @returns {Object} Returns `object`.\n */\nfunction baseSet(object, path, value, customizer) {\n  if (!isObject(object)) {\n    return object;\n  }\n  path = castPath(path, object);\n\n  var index = -1,\n      length = path.length,\n      lastIndex = length - 1,\n      nested = object;\n\n  while (nested != null && ++index < length) {\n    var key = toKey(path[index]),\n        newValue = value;\n\n    if (key === '__proto__' || key === 'constructor' || key === 'prototype') {\n      return object;\n    }\n\n    if (index != lastIndex) {\n      var objValue = nested[key];\n      newValue = customizer ? customizer(objValue, key, nested) : undefined;\n      if (newValue === undefined) {\n        newValue = isObject(objValue)\n          ? objValue\n          : (isIndex(path[index + 1]) ? [] : {});\n      }\n    }\n    assignValue(nested, key, newValue);\n    nested = nested[key];\n  }\n  return object;\n}\n\nexport default baseSet;\n","import baseSet from './_baseSet.js';\n\n/**\n * Sets the value at `path` of `object`. If a portion of `path` doesn't exist,\n * it's created. Arrays are created for missing index properties while objects\n * are created for all other missing properties. Use `_.setWith` to customize\n * `path` creation.\n *\n * **Note:** This method mutates `object`.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to modify.\n * @param {Array|string} path The path of the property to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns `object`.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.set(object, 'a[0].b.c', 4);\n * console.log(object.a[0].b.c);\n * // => 4\n *\n * _.set(object, ['x', '0', 'y', 'z'], 5);\n * console.log(object.x[0].y.z);\n * // => 5\n */\nfunction set(object, path, value) {\n  return object == null ? object : baseSet(object, path, value);\n}\n\nexport default set;\n","import type {SheetObjectConfig} from '@theatre/core/sheets/TheatreSheet'\nimport type {\n  $FixMe,\n  $IntentionalAny,\n  SerializableMap,\n  SerializableValue,\n} from '@theatre/shared/utils/types'\nimport type {\n  PropTypeConfig,\n  PropTypeConfig_Compound,\n  PropTypeConfig_Enum,\n} from '@theatre/core/propTypes'\n\nconst cachedDefaults = new WeakMap<PropTypeConfig, SerializableValue>()\n\n/**\n * Generates and caches a default value for the config of a SheetObject.\n */\nexport default function getPropDefaultsOfSheetObject(\n  config: SheetObjectConfig<$IntentionalAny>,\n): SerializableMap {\n  return getDefaultsOfPropTypeConfig(config) as $IntentionalAny\n}\n\nfunction getDefaultsOfPropTypeConfig(\n  config: PropTypeConfig,\n): SerializableValue {\n  if (cachedDefaults.has(config)) {\n    return cachedDefaults.get(config)!\n  }\n\n  const generated =\n    config.type === 'compound'\n      ? generateDefaultsForCompound(config)\n      : config.type === 'enum'\n      ? generateDefaultsForEnum(config)\n      : config.default\n\n  cachedDefaults.set(config, generated)\n\n  return generated\n}\n\nfunction generateDefaultsForEnum(config: PropTypeConfig_Enum) {\n  const defaults: SerializableMap = {\n    $case: config.defaultCase,\n  }\n\n  for (const [case_, caseConf] of Object.entries(config.cases)) {\n    defaults[case_] = getDefaultsOfPropTypeConfig(caseConf)\n  }\n\n  return defaults\n}\n\nfunction generateDefaultsForCompound(config: PropTypeConfig_Compound<$FixMe>) {\n  const defaults: SerializableMap = {}\n  for (const [key, propConf] of Object.entries(config.props)) {\n    defaults[key] = getDefaultsOfPropTypeConfig(propConf)\n  }\n\n  return defaults\n}\n","import type {\n  BasicKeyframedTrack,\n  Keyframe,\n  TrackData,\n} from '@theatre/core/projects/store/types/SheetState_Historic'\nimport type {IDerivation, Pointer} from '@theatre/dataverse'\nimport {ConstantDerivation, prism, val} from '@theatre/dataverse'\nimport logger from '@theatre/shared/logger'\nimport UnitBezier from 'timing-function/lib/UnitBezier'\n\nexport default function trackValueAtTime(\n  trackP: Pointer<TrackData | undefined>,\n  timeD: IDerivation<number>,\n): IDerivation<unknown> {\n  return prism(() => {\n    const track = val(trackP)\n    const driverD = prism.memo(\n      'driver',\n      () => {\n        if (!track) {\n          return new ConstantDerivation(undefined)\n        } else if (track.type === 'BasicKeyframedTrack') {\n          return trackValueAtTime_basicKeyframedTrack(track, timeD)\n        } else {\n          logger.error(`Track type not yet supported.`)\n          return new ConstantDerivation(undefined)\n        }\n      },\n      [track],\n    )\n\n    return driverD.getValue()\n  })\n}\n\ntype IStartedState = {\n  started: true\n  validFrom: number\n  validTo: number\n  der: IDerivation<unknown>\n}\ntype IState = {started: false} | IStartedState\n\nfunction trackValueAtTime_basicKeyframedTrack(\n  track: BasicKeyframedTrack,\n  timeD: IDerivation<number>,\n): IDerivation<unknown> {\n  return prism(() => {\n    let stateRef = prism.ref<IState>('state', {started: false})\n    let state = stateRef.current\n\n    const time = timeD.getValue()\n\n    if (!state.started || time < state.validFrom || state.validTo <= time) {\n      stateRef.current = state = pp(timeD, track)\n    }\n\n    return state.der.getValue()\n  })\n}\n\nconst undefinedConstD = new ConstantDerivation(undefined)\n\nconst pp = (\n  progressionD: IDerivation<number>,\n  track: BasicKeyframedTrack,\n): IStartedState => {\n  const progression = progressionD.getValue()\n  if (track.keyframes.length === 0) {\n    return {\n      started: true,\n      validFrom: -Infinity,\n      validTo: Infinity,\n      der: undefinedConstD,\n    }\n  }\n\n  let currentKeyframeIndex = 0\n\n  while (true) {\n    const currentKeyframe = track.keyframes[currentKeyframeIndex]\n\n    if (!currentKeyframe) {\n      if (process.env.NODE_ENV !== 'production') {\n        logger.error(`Bug here`)\n      }\n      return states.error\n    }\n\n    const isLastKeyframe = currentKeyframeIndex === track.keyframes.length - 1\n\n    if (progression < currentKeyframe.position) {\n      if (currentKeyframeIndex === 0) {\n        return states.beforeFirstKeyframe(currentKeyframe)\n      } else {\n        if (process.env.NODE_ENV !== 'production') {\n          logger.error(`Bug here`)\n        }\n        return states.error\n        // note: uncomment these if we support starting with currentPointIndex != 0\n        // currentPointIndex--\n        // continue\n      }\n    } else if (currentKeyframe.position === progression) {\n      if (isLastKeyframe) {\n        return states.lastKeyframe(currentKeyframe)\n      } else {\n        return states.between(\n          currentKeyframe,\n          track.keyframes[currentKeyframeIndex + 1],\n          progressionD,\n        )\n      }\n    } else {\n      // last point\n      if (currentKeyframeIndex === track.keyframes.length - 1) {\n        return states.lastKeyframe(currentKeyframe)\n      } else {\n        const nextKeyframeIndex = currentKeyframeIndex + 1\n        if (track.keyframes[nextKeyframeIndex].position <= progression) {\n          currentKeyframeIndex = nextKeyframeIndex\n          continue\n        } else {\n          return states.between(\n            currentKeyframe,\n            track.keyframes[currentKeyframeIndex + 1],\n            progressionD,\n          )\n        }\n      }\n    }\n  }\n}\n\nconst states = {\n  beforeFirstKeyframe(kf: Keyframe): IStartedState {\n    return {\n      started: true,\n      validFrom: -Infinity,\n      validTo: kf.position,\n      der: new ConstantDerivation(kf.value),\n    }\n  },\n  lastKeyframe(kf: Keyframe): IStartedState {\n    return {\n      started: true,\n      validFrom: kf.position,\n      validTo: Infinity,\n      der: new ConstantDerivation(kf.value),\n    }\n  },\n  between(\n    left: Keyframe,\n    right: Keyframe,\n    progressionD: IDerivation<number>,\n  ): IStartedState {\n    if (!left.connectedRight) {\n      return {\n        started: true,\n        validFrom: left.position,\n        validTo: right.position,\n        der: new ConstantDerivation(left.value),\n      }\n    }\n\n    const solver = new UnitBezier(\n      left.handles[2],\n      left.handles[3],\n      right.handles[0],\n      right.handles[1],\n    )\n    const globalProgressionToLocalProgression = (\n      globalProgression: number,\n    ): number => {\n      return (\n        (globalProgression - left.position) / (right.position - left.position)\n      )\n    }\n    const der = prism(() => {\n      const progression = globalProgressionToLocalProgression(\n        progressionD.getValue(),\n      )\n\n      const valueProgression = solver.solveSimple(progression)\n      return left.value + valueProgression * (right.value - left.value)\n    })\n\n    return {\n      started: true,\n      validFrom: left.position,\n      validTo: right.position,\n      der,\n    }\n  },\n  error: {\n    started: true,\n    validFrom: -Infinity,\n    validTo: Infinity,\n    der: undefinedConstD,\n  } as IStartedState,\n}\n","const logger = {\n  log: console.log,\n  warn: console.warn,\n  error: console.error,\n  trace: console.trace,\n}\n\nexport default logger\n","import type {$IntentionalAny} from '@theatre/shared/utils/types'\nimport type {DeepPartialOfSerializableValue, SerializableMap} from './types'\n\nexport default function deepMergeWithCache<T extends SerializableMap>(\n  base: T,\n  override: DeepPartialOfSerializableValue<T>,\n  cache: WeakMap<{}, unknown>,\n): T {\n  const _cache: WeakMap<SerializableMap, {override: T; merged: T}> =\n    cache as $IntentionalAny\n\n  const possibleCachedValue = _cache.get(base)\n\n  if (possibleCachedValue && possibleCachedValue.override === override) {\n    return possibleCachedValue.merged\n  }\n\n  const merged = {...base}\n  for (const key of Object.keys(override)) {\n    const valueInOverride = override[key]\n    const valueInBase = base[key]\n\n    // @ts-ignore @todo\n    merged[key] =\n      typeof valueInOverride === 'object' && typeof valueInBase === 'object'\n        ? deepMergeWithCache(valueInBase, valueInOverride, cache)\n        : typeof valueInOverride === 'undefined'\n        ? valueInBase\n        : valueInOverride\n  }\n\n  cache.set(base, {override, merged})\n  return merged\n}\n","import type {Pointer} from '@theatre/dataverse'\nimport type {PathToProp} from './addresses'\nimport type {$IntentionalAny} from './types'\n\nexport default function pointerDeep(\n  base: Pointer<$IntentionalAny>,\n  toAppend: PathToProp,\n): Pointer<unknown> {\n  let p = base\n  for (const k of toAppend) {\n    p = p[k]\n  }\n  return p\n}\n","import {Atom, prism} from '@theatre/dataverse'\n\n/**\n * A prism hook that converts `val` into an atom, and returns that atom.\n */\nexport const valToAtom = <T>(key: string, vals: T): Atom<T> => {\n  const a = prism.memo(key, () => new Atom(vals), [])\n  a.setState(vals)\n  return a\n}\n","import trackValueAtTime from '@theatre/core/sequences/trackValueAtTime'\nimport type Sheet from '@theatre/core/sheets/Sheet'\nimport type {SheetObjectAddress} from '@theatre/shared/utils/addresses'\nimport deepMergeWithCache from '@theatre/shared/utils/deepMergeWithCache'\nimport type {SequenceTrackId} from '@theatre/shared/utils/ids'\nimport pointerDeep from '@theatre/shared/utils/pointerDeep'\nimport SimpleCache from '@theatre/shared/utils/SimpleCache'\nimport type {\n  $FixMe,\n  $IntentionalAny,\n  SerializableMap,\n  SerializableValue,\n} from '@theatre/shared/utils/types'\nimport {valToAtom} from '@theatre/shared/utils/valToAtom'\nimport type {\n  IdentityDerivationProvider,\n  IDerivation,\n  Pointer,\n} from '@theatre/dataverse'\n\nimport {Atom, getPointerParts, pointer, prism, val} from '@theatre/dataverse'\nimport type SheetObjectTemplate from './SheetObjectTemplate'\nimport TheatreSheetObject from './TheatreSheetObject'\n\n// type Everything = {\n//   final: SerializableMap\n//   statics: SerializableMap\n//   defaults: SerializableMap\n//   sequenced: SerializableMap\n// }\n\nexport default class SheetObject implements IdentityDerivationProvider {\n  get type(): 'Theatre_SheetObject' {\n    return 'Theatre_SheetObject'\n  }\n  readonly $$isIdentityDerivationProvider: true = true\n  readonly address: SheetObjectAddress\n  readonly publicApi: TheatreSheetObject<$IntentionalAny>\n  private readonly _initialValue = new Atom<SerializableMap>({})\n  private readonly _cache = new SimpleCache()\n\n  constructor(\n    readonly sheet: Sheet,\n    readonly template: SheetObjectTemplate,\n    readonly nativeObject: unknown,\n  ) {\n    this.address = {\n      ...template.address,\n      sheetInstanceId: sheet.address.sheetInstanceId,\n    }\n\n    this.publicApi = new TheatreSheetObject(this)\n  }\n\n  getValues(): IDerivation<Pointer<SerializableMap>> {\n    return this._cache.get('getValues()', () =>\n      prism(() => {\n        const defaults = val(this.template.getDefaultValues())\n\n        const initial = val(this._initialValue.pointer)\n\n        const withInitialCache = prism.memo(\n          'withInitialCache',\n          () => new WeakMap(),\n          [],\n        )\n\n        const withInitial = deepMergeWithCache(\n          defaults,\n          initial,\n          withInitialCache,\n        )\n\n        const statics = val(this.template.getStaticValues())\n\n        const withStaticsCache = prism.memo(\n          'withStatics',\n          () => new WeakMap(),\n          [],\n        )\n\n        const withStatics = deepMergeWithCache(\n          withInitial,\n          statics,\n          withStaticsCache,\n        )\n\n        let final = withStatics\n        let sequenced\n\n        {\n          const pointerToSequencedValuesD = prism.memo(\n            'seq',\n            () => this.getSequencedValues(),\n            [],\n          )\n          const withSeqsCache = prism.memo(\n            'withSeqsCache',\n            () => new WeakMap(),\n            [],\n          )\n          sequenced = val(val(pointerToSequencedValuesD))\n\n          const withSeqs = deepMergeWithCache(final, sequenced, withSeqsCache)\n          final = withSeqs\n        }\n\n        const a = valToAtom<SerializableMap>('finalAtom', final)\n\n        return a.pointer\n      }),\n    )\n  }\n\n  getValueByPointer(pointer: SheetObject['propsP']): SerializableValue {\n    const allValuesP = val(this.getValues())\n    const {path} = getPointerParts(pointer)\n\n    return val(pointerDeep(allValuesP as $FixMe, path)) as SerializableMap\n  }\n\n  getIdentityDerivation(path: Array<string | number>): IDerivation<unknown> {\n    /**\n     * @remarks\n     * TODO perf: Too much indirection here.\n     */\n    return prism(() => {\n      const allValuesP = val(this.getValues())\n      return val(pointerDeep(allValuesP as $FixMe, path)) as SerializableMap\n    })\n  }\n\n  /**\n   * Returns values of props that are sequenced.\n   */\n  getSequencedValues(): IDerivation<Pointer<SerializableMap>> {\n    return prism(() => {\n      const tracksToProcessD = prism.memo(\n        'tracksToProcess',\n        () => this.template.getArrayOfValidSequenceTracks(),\n        [],\n      )\n\n      const tracksToProcess = val(tracksToProcessD)\n      const valsAtom = new Atom<SerializableMap>({})\n\n      prism.effect(\n        'processTracks',\n        () => {\n          const untaps: Array<() => void> = []\n\n          for (const {trackId, pathToProp} of tracksToProcess) {\n            const derivation = this._trackIdToDerivation(trackId)\n\n            const updateSequenceValueFromItsDerivation = () => {\n              valsAtom.setIn(pathToProp, derivation.getValue())\n            }\n            const untap = derivation\n              .changesWithoutValues()\n              .tap(updateSequenceValueFromItsDerivation)\n\n            updateSequenceValueFromItsDerivation()\n            untaps.push(untap)\n          }\n          return () => {\n            for (const untap of untaps) {\n              untap()\n            }\n          }\n        },\n        tracksToProcess,\n      )\n\n      return valsAtom.pointer\n    })\n  }\n\n  protected _trackIdToDerivation(\n    trackId: SequenceTrackId,\n  ): IDerivation<unknown> {\n    const trackP =\n      this.template.project.pointers.historic.sheetsById[this.address.sheetId]\n        .sequence.tracksByObject[this.address.objectKey].trackData[trackId]\n    const timeD = this.sheet.getSequence().positionDerivation\n\n    return trackValueAtTime(trackP, timeD)\n  }\n\n  get propsP(): Pointer<$FixMe> {\n    return this._cache.get('propsP', () =>\n      pointer<{props: {}}>({root: this, path: []}),\n    ) as $FixMe\n  }\n\n  validateValue(pointer: Pointer<$FixMe>, value: unknown) {\n    // @todo\n  }\n\n  setInitialValue(val: SerializableMap) {\n    this.validateValue(this.propsP, val)\n    this._initialValue.setState(val)\n  }\n}\n","import {Ticker} from '@theatre/dataverse'\n\nconst coreTicker = new Ticker()\n\nexport default coreTicker\n\n/**\n * @remarks\n * TODO users should also be able to define their own ticker.\n */\nconst onAnimationFrame = (t: number) => {\n  coreTicker.tick(t)\n  window.requestAnimationFrame(onAnimationFrame)\n}\nwindow.requestAnimationFrame(onAnimationFrame)\n","import {privateAPI, setPrivateAPI} from '@theatre/core/privateAPIs'\nimport type {IProject} from '@theatre/core/projects/TheatreProject'\nimport coreTicker from '@theatre/core/coreTicker'\nimport type {ISheet} from '@theatre/core/sheets/TheatreSheet'\nimport type {SheetObjectAddress} from '@theatre/shared/utils/addresses'\nimport SimpleCache from '@theatre/shared/utils/SimpleCache'\nimport type {\n  $FixMe,\n  DeepPartialOfSerializableValue,\n  VoidFn,\n} from '@theatre/shared/utils/types'\nimport type {IDerivation, Pointer} from '@theatre/dataverse'\nimport {prism, val} from '@theatre/dataverse'\nimport type SheetObject from './SheetObject'\nimport type {\n  IShorthandCompoundProps,\n  ShorthandPropToLonghandProp,\n} from '@theatre/core/propTypes/internals'\n\nexport interface ISheetObject<Props extends IShorthandCompoundProps = {}> {\n  /**\n   * All Objects will have `object.type === 'Theatre_SheetObject_PublicAPI'`\n   */\n  readonly type: 'Theatre_SheetObject_PublicAPI'\n\n  /**\n   * The current values of the props.\n   *\n   * @example\n   * Usage:\n   * ```ts\n   * const obj = sheet.object(\"obj\", {x: 0})\n   * console.log(obj.value.x) // prints 0 or the current numeric value\n   * ```\n   */\n  readonly value: ShorthandPropToLonghandProp<Props>['valueType']\n\n  /**\n   * A Pointer to the props of the object.\n   *\n   * More documentation soon.\n   */\n  readonly props: Pointer<this['value']>\n\n  /**\n   * The instance of Sheet the Object belongs to\n   */\n  readonly sheet: ISheet\n\n  /**\n   * The Project the project belongs to\n   */\n  readonly project: IProject\n\n  /**\n   * An object representing the address of the Object\n   */\n  readonly address: SheetObjectAddress\n\n  /**\n   * Calls `fn` every time the value of the props change.\n   *\n   * @returns an Unsubscribe function\n   *\n   * @example\n   * Usage:\n   * ```ts\n   * const obj = sheet.object(\"Box\", {position: {x: 0, y: 0}})\n   * const div = document.getElementById(\"box\")\n   *\n   * const unsubscribe = obj.onValuesChange((newValues) => {\n   *   div.style.left = newValues.position.x + 'px'\n   *   div.style.top = newValues.position.y + 'px'\n   * })\n   *\n   * // you can call unsubscribe() to stop listening to changes\n   * ```\n   */\n  onValuesChange(fn: (values: this['value']) => void): VoidFn\n\n  /**\n   * Sets the initial value of the object. This value overrides the default\n   * values defined in the prop types, but would itself be overridden if the user\n   * overrides it in the UI with a static or animated value.\n   *\n   * @example\n   * Usage:\n   * ```ts\n   * const obj = sheet.object(\"obj\", {position: {x: 0, y: 0}})\n   *\n   * obj.value // {position: {x: 0, y: 0}}\n   *\n   * // here, we only override position.x\n   * obj.initialValue = {position: {x: 2}}\n   *\n   * obj.value // {position: {x: 2, y: 0}}\n   * ```\n   */\n  set initialValue(value: DeepPartialOfSerializableValue<this['value']>)\n}\n\nexport default class TheatreSheetObject<\n  Props extends IShorthandCompoundProps = {},\n> implements ISheetObject<Props>\n{\n  get type(): 'Theatre_SheetObject_PublicAPI' {\n    return 'Theatre_SheetObject_PublicAPI'\n  }\n  private readonly _cache = new SimpleCache()\n\n  /**\n   * @internal\n   */\n  constructor(internals: SheetObject) {\n    setPrivateAPI(this, internals)\n  }\n\n  get props(): Pointer<this['value']> {\n    return privateAPI(this).propsP as $FixMe\n  }\n\n  get sheet(): ISheet {\n    return privateAPI(this).sheet.publicApi\n  }\n\n  get project(): IProject {\n    return privateAPI(this).sheet.project.publicApi\n  }\n\n  get address(): SheetObjectAddress {\n    return {...privateAPI(this).address}\n  }\n\n  private _valuesDerivation(): IDerivation<this['value']> {\n    return this._cache.get('onValuesChangeDerivation', () => {\n      const sheetObject = privateAPI(this)\n      const d: IDerivation<Props> = prism(() => {\n        return val(sheetObject.getValues().getValue()) as $FixMe\n      })\n      return d\n    })\n  }\n\n  onValuesChange(fn: (values: this['value']) => void): VoidFn {\n    return this._valuesDerivation().tapImmediate(coreTicker, fn)\n  }\n\n  get value(): ShorthandPropToLonghandProp<Props>['valueType'] {\n    return this._valuesDerivation().getValue()\n  }\n\n  set initialValue(val: DeepPartialOfSerializableValue<this['value']>) {\n    privateAPI(this).setInitialValue(val)\n  }\n}\n","import type Project from '@theatre/core/projects/Project'\nimport SheetObjectTemplate from '@theatre/core/sheetObjects/SheetObjectTemplate'\nimport type {\n  SheetAddress,\n  WithoutSheetInstance,\n} from '@theatre/shared/utils/addresses'\nimport type {$IntentionalAny} from '@theatre/shared/utils/types'\nimport {Atom} from '@theatre/dataverse'\nimport Sheet from './Sheet'\nimport type {SheetObjectConfig} from './TheatreSheet'\n\nexport default class SheetTemplate {\n  readonly type: 'Theatre_SheetTemplate' = 'Theatre_SheetTemplate'\n  readonly address: WithoutSheetInstance<SheetAddress>\n  private _instances = new Atom<{[instanceId: string]: Sheet}>({})\n  readonly instancesP = this._instances.pointer\n\n  private _objectTemplates = new Atom<{\n    [objectKey: string]: SheetObjectTemplate\n  }>({})\n  readonly objectTemplatesP = this._objectTemplates.pointer\n\n  constructor(readonly project: Project, sheetId: string) {\n    this.address = {...project.address, sheetId}\n  }\n\n  getInstance(instanceId: string): Sheet {\n    let inst = this._instances.getState()[instanceId]\n\n    if (!inst) {\n      inst = new Sheet(this, instanceId)\n      this._instances.setIn([instanceId], inst)\n    }\n\n    return inst\n  }\n\n  getObjectTemplate(\n    key: string,\n    nativeObject: unknown,\n    config: SheetObjectConfig<$IntentionalAny>,\n  ): SheetObjectTemplate {\n    let template = this._objectTemplates.getState()[key]\n\n    if (!template) {\n      template = new SheetObjectTemplate(this, key, nativeObject, config)\n      this._objectTemplates.setIn([key], template)\n    }\n\n    return template\n  }\n}\n","import propose from 'propose'\n\nexport default function didYouMean(\n  str: string,\n  dictionary: string[],\n  prepend: string = 'Did you mean ',\n  append: string = '?',\n): string {\n  const p = propose(str, dictionary, {\n    threshold: 0.7,\n  })\n\n  if (p) {\n    return prepend + JSON.stringify(p) + append\n  } else {\n    return ''\n  }\n}\n","export class TheatreError extends Error {}\n\nexport class InvalidArgumentError extends TheatreError {}\n","import type Project from '@theatre/core/projects/Project'\nimport coreTicker from '@theatre/core/coreTicker'\nimport type Sheet from '@theatre/core/sheets/Sheet'\nimport type {SequenceAddress} from '@theatre/shared/utils/addresses'\nimport didYouMean from '@theatre/shared/utils/didYouMean'\nimport {InvalidArgumentError} from '@theatre/shared/utils/errors'\nimport type {IBox, IDerivation, Pointer} from '@theatre/dataverse'\nimport {pointer} from '@theatre/dataverse'\nimport {Box, prism, val, valueDerivation} from '@theatre/dataverse'\nimport {padStart} from 'lodash-es'\nimport type {\n  IPlaybackController,\n  IPlaybackState,\n} from './playbackControllers/DefaultPlaybackController'\nimport DefaultPlaybackController from './playbackControllers/DefaultPlaybackController'\nimport TheatreSequence from './TheatreSequence'\nimport logger from '@theatre/shared/logger'\nimport type {ISequence} from '..'\n\nexport type IPlaybackRange = [from: number, to: number]\n\nexport type IPlaybackDirection =\n  | 'normal'\n  | 'reverse'\n  | 'alternate'\n  | 'alternateReverse'\n\nconst possibleDirections = [\n  'normal',\n  'reverse',\n  'alternate',\n  'alternateReverse',\n]\n\nexport default class Sequence {\n  public readonly address: SequenceAddress\n  publicApi: TheatreSequence\n\n  private _playbackControllerBox: IBox<IPlaybackController>\n  private _statePointerDerivation: IDerivation<Pointer<IPlaybackState>>\n  private _positionD: IDerivation<number>\n  private _positionFormatterD: IDerivation<ISequencePositionFormatter>\n  _playableRangeD: undefined | IDerivation<{start: number; end: number}>\n\n  readonly pointer: ISequence['pointer'] = pointer({root: this, path: []})\n  readonly $$isIdentityDerivationProvider = true\n\n  constructor(\n    readonly _project: Project,\n    readonly _sheet: Sheet,\n    readonly _lengthD: IDerivation<number>,\n    readonly _subUnitsPerUnitD: IDerivation<number>,\n    playbackController?: IPlaybackController,\n  ) {\n    this.address = {...this._sheet.address, sequenceName: 'default'}\n\n    this.publicApi = new TheatreSequence(this)\n\n    this._playbackControllerBox = new Box(\n      playbackController ?? new DefaultPlaybackController(coreTicker),\n    )\n\n    this._statePointerDerivation = this._playbackControllerBox.derivation.map(\n      (playbackController) => playbackController.statePointer,\n    )\n\n    this._positionD = this._statePointerDerivation.flatMap((statePointer) =>\n      valueDerivation(statePointer.position),\n    )\n\n    this._positionFormatterD = this._subUnitsPerUnitD.map(\n      (subUnitsPerUnit) => new TimeBasedPositionFormatter(subUnitsPerUnit),\n    )\n  }\n\n  getIdentityDerivation(path: Array<string | number>): IDerivation<unknown> {\n    if (path.length === 0) {\n      return prism((): ISequence['pointer']['$$__pointer_type'] => ({\n        length: val(this.pointer.length),\n        playing: val(this.pointer.playing),\n        position: val(this.pointer.position),\n      }))\n    }\n    if (path.length > 1) {\n      return prism(() => undefined)\n    }\n    const [prop] = path\n    if (prop === 'length') {\n      return this._lengthD\n    } else if (prop === 'position') {\n      return this._positionD\n    } else if (prop === 'playing') {\n      return prism(() => {\n        return val(this._statePointerDerivation.getValue().playing)\n      })\n    } else {\n      return prism(() => undefined)\n    }\n  }\n\n  get positionFormatter(): ISequencePositionFormatter {\n    return this._positionFormatterD.getValue()\n  }\n\n  get derivationToStatePointer() {\n    return this._statePointerDerivation\n  }\n\n  get length() {\n    return this._lengthD.getValue()\n  }\n\n  get positionDerivation() {\n    return this._positionD\n  }\n\n  get position() {\n    return this._playbackControllerBox.get().getCurrentPosition()\n  }\n\n  get subUnitsPerUnit(): number {\n    return this._subUnitsPerUnitD.getValue()\n  }\n\n  get positionSnappedToGrid(): number {\n    return this.closestGridPosition(this.position)\n  }\n\n  closestGridPosition = (posInUnitSpace: number): number => {\n    const subUnitsPerUnit = this.subUnitsPerUnit\n    const gridLength = 1 / subUnitsPerUnit\n\n    return parseFloat(\n      (Math.round(posInUnitSpace / gridLength) * gridLength).toFixed(3),\n    )\n  }\n\n  set position(requestedPosition: number) {\n    let position = requestedPosition\n    this.pause()\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof position !== 'number') {\n        logger.error(\n          `value t in sequence.position = t must be a number. ${typeof position} given`,\n        )\n        position = 0\n      }\n      if (position < 0) {\n        logger.error(\n          `sequence.position must be a positive number. ${position} given`,\n        )\n        position = 0\n      }\n    }\n    if (position > this.length) {\n      position = this.length\n    }\n    const dur = this.length\n    this._playbackControllerBox\n      .get()\n      .gotoPosition(position > dur ? dur : position)\n  }\n\n  getDurationCold() {\n    return this._lengthD.getValue()\n  }\n\n  get playing() {\n    return val(this._playbackControllerBox.get().statePointer.playing)\n  }\n\n  _makeRangeFromSequenceTemplate(): IDerivation<IPlaybackRange> {\n    return prism(() => {\n      return [0, val(this._lengthD)]\n    })\n  }\n\n  async play(\n    conf?: Partial<{\n      iterationCount: number\n      range: IPlaybackRange\n      rate: number\n      direction: IPlaybackDirection\n    }>,\n  ): Promise<boolean> {\n    const sequenceDuration = this.length\n    const range: IPlaybackRange =\n      conf && conf.range ? conf.range : [0, sequenceDuration]\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof range[0] !== 'number' || range[0] < 0) {\n        throw new InvalidArgumentError(\n          `Argument conf.range[0] in sequence.play(conf) must be a positive number. ${JSON.stringify(\n            range[0],\n          )} given.`,\n        )\n      }\n      if (range[0] >= sequenceDuration) {\n        throw new InvalidArgumentError(\n          `Argument conf.range[0] in sequence.play(conf) cannot be longer than the duration of the sequence, which is ${sequenceDuration}s. ${JSON.stringify(\n            range[0],\n          )} given.`,\n        )\n      }\n      if (typeof range[1] !== 'number' || range[1] <= 0) {\n        throw new InvalidArgumentError(\n          `Argument conf.range[1] in sequence.play(conf) must be a number larger than zero. ${JSON.stringify(\n            range[1],\n          )} given.`,\n        )\n      }\n\n      if (range[1] > sequenceDuration) {\n        logger.warn(\n          `Argument conf.range[1] in sequence.play(conf) cannot be longer than the duration of the sequence, which is ${sequenceDuration}s. ${JSON.stringify(\n            range[1],\n          )} given.`,\n        )\n        range[1] = sequenceDuration\n      }\n\n      if (range[1] <= range[0]) {\n        throw new InvalidArgumentError(\n          `Argument conf.range[1] in sequence.play(conf) must be larger than conf.range[0]. ${JSON.stringify(\n            range,\n          )} given.`,\n        )\n      }\n    }\n\n    const iterationCount =\n      conf && typeof conf.iterationCount === 'number' ? conf.iterationCount : 1\n    if (process.env.NODE_ENV !== 'production') {\n      if (\n        !(Number.isInteger(iterationCount) && iterationCount > 0) &&\n        iterationCount !== Infinity\n      ) {\n        throw new InvalidArgumentError(\n          `Argument conf.iterationCount in sequence.play(conf) must be an integer larger than 0. ${JSON.stringify(\n            iterationCount,\n          )} given.`,\n        )\n      }\n    }\n\n    const rate = conf && typeof conf.rate !== 'undefined' ? conf.rate : 1\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof rate !== 'number' || rate === 0) {\n        throw new InvalidArgumentError(\n          `Argument conf.rate in sequence.play(conf) must be a number larger than 0. ${JSON.stringify(\n            rate,\n          )} given.`,\n        )\n      }\n\n      if (rate < 0) {\n        throw new InvalidArgumentError(\n          `Argument conf.rate in sequence.play(conf) must be a number larger than 0. ${JSON.stringify(\n            rate,\n          )} given. If you want the animation to play backwards, try setting conf.direction to 'reverse' or 'alternateReverse'.`,\n        )\n      }\n    }\n\n    const direction = conf && conf.direction ? conf.direction : 'normal'\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (possibleDirections.indexOf(direction) === -1) {\n        throw new InvalidArgumentError(\n          `Argument conf.direction in sequence.play(conf) must be one of ${JSON.stringify(\n            possibleDirections,\n          )}. ${JSON.stringify(direction)} given. ${didYouMean(\n            direction,\n            possibleDirections,\n          )}`,\n        )\n      }\n    }\n\n    return await this._play(\n      iterationCount,\n      [range[0], range[1]],\n      rate,\n      direction,\n    )\n  }\n\n  protected _play(\n    iterationCount: number,\n    range: IPlaybackRange,\n    rate: number,\n    direction: IPlaybackDirection,\n  ): Promise<boolean> {\n    return this._playbackControllerBox\n      .get()\n      .play(iterationCount, range, rate, direction)\n  }\n\n  pause() {\n    this._playbackControllerBox.get().pause()\n  }\n\n  replacePlaybackController(playbackController: IPlaybackController) {\n    this.pause()\n    const oldController = this._playbackControllerBox.get()\n    this._playbackControllerBox.set(playbackController)\n\n    const time = oldController.getCurrentPosition()\n    oldController.destroy()\n    playbackController.gotoPosition(time)\n  }\n}\n\nexport interface ISequencePositionFormatter {\n  formatSubUnitForGrid(posInUnitSpace: number): string\n  formatFullUnitForGrid(posInUnitSpace: number): string\n  formatForPlayhead(posInUnitSpace: number): string\n  formatBasic(posInUnitSpace: number): string\n}\n\nclass TimeBasedPositionFormatter implements ISequencePositionFormatter {\n  constructor(private readonly _fps: number) {}\n  formatSubUnitForGrid(posInUnitSpace: number): string {\n    const subSecondPos = posInUnitSpace % 1\n    const frame = 1 / this._fps\n\n    const frames = Math.round(subSecondPos / frame)\n    return frames + 'f'\n  }\n\n  formatFullUnitForGrid(posInUnitSpace: number): string {\n    let p = posInUnitSpace\n\n    let s = ''\n\n    if (p >= hour) {\n      const hours = Math.floor(p / hour)\n      s += hours + 'h'\n      p = p % hour\n    }\n\n    if (p >= minute) {\n      const minutes = Math.floor(p / minute)\n      s += minutes + 'm'\n      p = p % minute\n    }\n\n    if (p >= second) {\n      const seconds = Math.floor(p / second)\n      s += seconds + 's'\n      p = p % second\n    }\n\n    const frame = 1 / this._fps\n\n    if (p >= frame) {\n      const frames = Math.floor(p / frame)\n      s += frames + 'f'\n      p = p % frame\n    }\n\n    return s.length === 0 ? '0s' : s\n  }\n\n  formatForPlayhead(posInUnitSpace: number): string {\n    let p = posInUnitSpace\n\n    let s = ''\n\n    if (p >= hour) {\n      const hours = Math.floor(p / hour)\n      s += padStart(hours.toString(), 2, '0') + 'h'\n      p = p % hour\n    }\n\n    if (p >= minute) {\n      const minutes = Math.floor(p / minute)\n      s += padStart(minutes.toString(), 2, '0') + 'm'\n      p = p % minute\n    } else if (s.length > 0) {\n      s += '00m'\n    }\n\n    if (p >= second) {\n      const seconds = Math.floor(p / second)\n      s += padStart(seconds.toString(), 2, '0') + 's'\n      p = p % second\n    } else {\n      s += '00s'\n    }\n\n    const frameLength = 1 / this._fps\n\n    if (p >= frameLength) {\n      const frames = Math.round(p / frameLength)\n      s += padStart(frames.toString(), 2, '0') + 'f'\n      p = p % frameLength\n    } else if (p / frameLength > 0.98) {\n      const frames = 1\n      s += padStart(frames.toString(), 2, '0') + 'f'\n      p = p % frameLength\n    } else {\n      s += '00f'\n    }\n\n    return s.length === 0 ? '00s00f' : s\n  }\n\n  formatBasic(posInUnitSpace: number): string {\n    return posInUnitSpace.toFixed(2) + 's'\n  }\n}\n\nconst second = 1\nconst minute = second * 60\nconst hour = minute * 60\n","/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nexport default trimmedEndIndex;\n","import trimmedEndIndex from './_trimmedEndIndex.js';\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nexport default baseTrim;\n","import baseTrim from './_baseTrim.js';\nimport isObject from './isObject.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nexport default toNumber;\n","import toNumber from './toNumber.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0,\n    MAX_INTEGER = 1.7976931348623157e+308;\n\n/**\n * Converts `value` to a finite number.\n *\n * @static\n * @memberOf _\n * @since 4.12.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {number} Returns the converted number.\n * @example\n *\n * _.toFinite(3.2);\n * // => 3.2\n *\n * _.toFinite(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toFinite(Infinity);\n * // => 1.7976931348623157e+308\n *\n * _.toFinite('3.2');\n * // => 3.2\n */\nfunction toFinite(value) {\n  if (!value) {\n    return value === 0 ? value : 0;\n  }\n  value = toNumber(value);\n  if (value === INFINITY || value === -INFINITY) {\n    var sign = (value < 0 ? -1 : 1);\n    return sign * MAX_INTEGER;\n  }\n  return value === value ? value : 0;\n}\n\nexport default toFinite;\n","import toFinite from './toFinite.js';\n\n/**\n * Converts `value` to an integer.\n *\n * **Note:** This method is loosely based on\n * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {number} Returns the converted integer.\n * @example\n *\n * _.toInteger(3.2);\n * // => 3\n *\n * _.toInteger(Number.MIN_VALUE);\n * // => 0\n *\n * _.toInteger(Infinity);\n * // => 1.7976931348623157e+308\n *\n * _.toInteger('3.2');\n * // => 3\n */\nfunction toInteger(value) {\n  var result = toFinite(value),\n      remainder = result % 1;\n\n  return result === result ? (remainder ? result - remainder : result) : 0;\n}\n\nexport default toInteger;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","import baseGetTag from './_baseGetTag.js';\nimport getPrototype from './_getPrototype.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) || baseGetTag(value) != objectTag) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor &&\n    funcToString.call(Ctor) == objectCtorString;\n}\n\nexport default isPlainObject;\n","/**\n * The base implementation of `_.slice` without an iteratee call guard.\n *\n * @private\n * @param {Array} array The array to slice.\n * @param {number} [start=0] The start position.\n * @param {number} [end=array.length] The end position.\n * @returns {Array} Returns the slice of `array`.\n */\nfunction baseSlice(array, start, end) {\n  var index = -1,\n      length = array.length;\n\n  if (start < 0) {\n    start = -start > length ? 0 : (length + start);\n  }\n  end = end > length ? length : end;\n  if (end < 0) {\n    end += length;\n  }\n  length = start > end ? 0 : ((end - start) >>> 0);\n  start >>>= 0;\n\n  var result = Array(length);\n  while (++index < length) {\n    result[index] = array[index + start];\n  }\n  return result;\n}\n\nexport default baseSlice;\n","import baseSlice from './_baseSlice.js';\n\n/**\n * Casts `array` to a slice if it's needed.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {number} start The start position.\n * @param {number} [end=array.length] The end position.\n * @returns {Array} Returns the cast slice.\n */\nfunction castSlice(array, start, end) {\n  var length = array.length;\n  end = end === undefined ? length : end;\n  return (!start && end >= length) ? array : baseSlice(array, start, end);\n}\n\nexport default castSlice;\n","/** Used to compose unicode character classes. */\nvar rsAstralRange = '\\\\ud800-\\\\udfff',\n    rsComboMarksRange = '\\\\u0300-\\\\u036f',\n    reComboHalfMarksRange = '\\\\ufe20-\\\\ufe2f',\n    rsComboSymbolsRange = '\\\\u20d0-\\\\u20ff',\n    rsComboRange = rsComboMarksRange + reComboHalfMarksRange + rsComboSymbolsRange,\n    rsVarRange = '\\\\ufe0e\\\\ufe0f';\n\n/** Used to compose unicode capture groups. */\nvar rsZWJ = '\\\\u200d';\n\n/** Used to detect strings with [zero-width joiners or code points from the astral planes](http://eev.ee/blog/2015/09/12/dark-corners-of-unicode/). */\nvar reHasUnicode = RegExp('[' + rsZWJ + rsAstralRange  + rsComboRange + rsVarRange + ']');\n\n/**\n * Checks if `string` contains Unicode symbols.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {boolean} Returns `true` if a symbol is found, else `false`.\n */\nfunction hasUnicode(string) {\n  return reHasUnicode.test(string);\n}\n\nexport default hasUnicode;\n","/**\n * Converts an ASCII `string` to an array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the converted array.\n */\nfunction asciiToArray(string) {\n  return string.split('');\n}\n\nexport default asciiToArray;\n","/** Used to compose unicode character classes. */\nvar rsAstralRange = '\\\\ud800-\\\\udfff',\n    rsComboMarksRange = '\\\\u0300-\\\\u036f',\n    reComboHalfMarksRange = '\\\\ufe20-\\\\ufe2f',\n    rsComboSymbolsRange = '\\\\u20d0-\\\\u20ff',\n    rsComboRange = rsComboMarksRange + reComboHalfMarksRange + rsComboSymbolsRange,\n    rsVarRange = '\\\\ufe0e\\\\ufe0f';\n\n/** Used to compose unicode capture groups. */\nvar rsAstral = '[' + rsAstralRange + ']',\n    rsCombo = '[' + rsComboRange + ']',\n    rsFitz = '\\\\ud83c[\\\\udffb-\\\\udfff]',\n    rsModifier = '(?:' + rsCombo + '|' + rsFitz + ')',\n    rsNonAstral = '[^' + rsAstralRange + ']',\n    rsRegional = '(?:\\\\ud83c[\\\\udde6-\\\\uddff]){2}',\n    rsSurrPair = '[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]',\n    rsZWJ = '\\\\u200d';\n\n/** Used to compose unicode regexes. */\nvar reOptMod = rsModifier + '?',\n    rsOptVar = '[' + rsVarRange + ']?',\n    rsOptJoin = '(?:' + rsZWJ + '(?:' + [rsNonAstral, rsRegional, rsSurrPair].join('|') + ')' + rsOptVar + reOptMod + ')*',\n    rsSeq = rsOptVar + reOptMod + rsOptJoin,\n    rsSymbol = '(?:' + [rsNonAstral + rsCombo + '?', rsCombo, rsRegional, rsSurrPair, rsAstral].join('|') + ')';\n\n/** Used to match [string symbols](https://mathiasbynens.be/notes/javascript-unicode). */\nvar reUnicode = RegExp(rsFitz + '(?=' + rsFitz + ')|' + rsSymbol + rsSeq, 'g');\n\n/**\n * Converts a Unicode `string` to an array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the converted array.\n */\nfunction unicodeToArray(string) {\n  return string.match(reUnicode) || [];\n}\n\nexport default unicodeToArray;\n","import asciiToArray from './_asciiToArray.js';\nimport hasUnicode from './_hasUnicode.js';\nimport unicodeToArray from './_unicodeToArray.js';\n\n/**\n * Converts `string` to an array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the converted array.\n */\nfunction stringToArray(string) {\n  return hasUnicode(string)\n    ? unicodeToArray(string)\n    : asciiToArray(string);\n}\n\nexport default stringToArray;\n","/**\n * The base implementation of `_.property` without support for deep paths.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction baseProperty(key) {\n  return function(object) {\n    return object == null ? undefined : object[key];\n  };\n}\n\nexport default baseProperty;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeFloor = Math.floor;\n\n/**\n * The base implementation of `_.repeat` which doesn't coerce arguments.\n *\n * @private\n * @param {string} string The string to repeat.\n * @param {number} n The number of times to repeat the string.\n * @returns {string} Returns the repeated string.\n */\nfunction baseRepeat(string, n) {\n  var result = '';\n  if (!string || n < 1 || n > MAX_SAFE_INTEGER) {\n    return result;\n  }\n  // Leverage the exponentiation by squaring algorithm for a faster repeat.\n  // See https://en.wikipedia.org/wiki/Exponentiation_by_squaring for more details.\n  do {\n    if (n % 2) {\n      result += string;\n    }\n    n = nativeFloor(n / 2);\n    if (n) {\n      string += string;\n    }\n  } while (n);\n\n  return result;\n}\n\nexport default baseRepeat;\n","import baseProperty from './_baseProperty.js';\n\n/**\n * Gets the size of an ASCII `string`.\n *\n * @private\n * @param {string} string The string inspect.\n * @returns {number} Returns the string size.\n */\nvar asciiSize = baseProperty('length');\n\nexport default asciiSize;\n","/** Used to compose unicode character classes. */\nvar rsAstralRange = '\\\\ud800-\\\\udfff',\n    rsComboMarksRange = '\\\\u0300-\\\\u036f',\n    reComboHalfMarksRange = '\\\\ufe20-\\\\ufe2f',\n    rsComboSymbolsRange = '\\\\u20d0-\\\\u20ff',\n    rsComboRange = rsComboMarksRange + reComboHalfMarksRange + rsComboSymbolsRange,\n    rsVarRange = '\\\\ufe0e\\\\ufe0f';\n\n/** Used to compose unicode capture groups. */\nvar rsAstral = '[' + rsAstralRange + ']',\n    rsCombo = '[' + rsComboRange + ']',\n    rsFitz = '\\\\ud83c[\\\\udffb-\\\\udfff]',\n    rsModifier = '(?:' + rsCombo + '|' + rsFitz + ')',\n    rsNonAstral = '[^' + rsAstralRange + ']',\n    rsRegional = '(?:\\\\ud83c[\\\\udde6-\\\\uddff]){2}',\n    rsSurrPair = '[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]',\n    rsZWJ = '\\\\u200d';\n\n/** Used to compose unicode regexes. */\nvar reOptMod = rsModifier + '?',\n    rsOptVar = '[' + rsVarRange + ']?',\n    rsOptJoin = '(?:' + rsZWJ + '(?:' + [rsNonAstral, rsRegional, rsSurrPair].join('|') + ')' + rsOptVar + reOptMod + ')*',\n    rsSeq = rsOptVar + reOptMod + rsOptJoin,\n    rsSymbol = '(?:' + [rsNonAstral + rsCombo + '?', rsCombo, rsRegional, rsSurrPair, rsAstral].join('|') + ')';\n\n/** Used to match [string symbols](https://mathiasbynens.be/notes/javascript-unicode). */\nvar reUnicode = RegExp(rsFitz + '(?=' + rsFitz + ')|' + rsSymbol + rsSeq, 'g');\n\n/**\n * Gets the size of a Unicode `string`.\n *\n * @private\n * @param {string} string The string inspect.\n * @returns {number} Returns the string size.\n */\nfunction unicodeSize(string) {\n  var result = reUnicode.lastIndex = 0;\n  while (reUnicode.test(string)) {\n    ++result;\n  }\n  return result;\n}\n\nexport default unicodeSize;\n","import asciiSize from './_asciiSize.js';\nimport hasUnicode from './_hasUnicode.js';\nimport unicodeSize from './_unicodeSize.js';\n\n/**\n * Gets the number of symbols in `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the string size.\n */\nfunction stringSize(string) {\n  return hasUnicode(string)\n    ? unicodeSize(string)\n    : asciiSize(string);\n}\n\nexport default stringSize;\n","import baseRepeat from './_baseRepeat.js';\nimport baseToString from './_baseToString.js';\nimport castSlice from './_castSlice.js';\nimport hasUnicode from './_hasUnicode.js';\nimport stringSize from './_stringSize.js';\nimport stringToArray from './_stringToArray.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeCeil = Math.ceil;\n\n/**\n * Creates the padding for `string` based on `length`. The `chars` string\n * is truncated if the number of characters exceeds `length`.\n *\n * @private\n * @param {number} length The padding length.\n * @param {string} [chars=' '] The string used as padding.\n * @returns {string} Returns the padding for `string`.\n */\nfunction createPadding(length, chars) {\n  chars = chars === undefined ? ' ' : baseToString(chars);\n\n  var charsLength = chars.length;\n  if (charsLength < 2) {\n    return charsLength ? baseRepeat(chars, length) : chars;\n  }\n  var result = baseRepeat(chars, nativeCeil(length / stringSize(chars)));\n  return hasUnicode(chars)\n    ? castSlice(stringToArray(result), 0, length).join('')\n    : result.slice(0, length);\n}\n\nexport default createPadding;\n","import createPadding from './_createPadding.js';\nimport stringSize from './_stringSize.js';\nimport toInteger from './toInteger.js';\nimport toString from './toString.js';\n\n/**\n * Pads `string` on the left side if it's shorter than `length`. Padding\n * characters are truncated if they exceed `length`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category String\n * @param {string} [string=''] The string to pad.\n * @param {number} [length=0] The padding length.\n * @param {string} [chars=' '] The string used as padding.\n * @returns {string} Returns the padded string.\n * @example\n *\n * _.padStart('abc', 6);\n * // => '   abc'\n *\n * _.padStart('abc', 6, '_-');\n * // => '_-_abc'\n *\n * _.padStart('abc', 3);\n * // => 'abc'\n */\nfunction padStart(string, length, chars) {\n  string = toString(string);\n  length = toInteger(length);\n\n  var strLength = length ? stringSize(string) : 0;\n  return (length && strLength < length)\n    ? (createPadding(length - strLength, chars) + string)\n    : string;\n}\n\nexport default padStart;\n","export interface Deferred<PromiseType> {\n  resolve: (d: PromiseType) => void\n  reject: (d: unknown) => void\n  promise: Promise<PromiseType>\n  status: 'pending' | 'resolved' | 'rejected'\n}\n\nexport function defer<PromiseType>(): Deferred<PromiseType> {\n  let resolve: (d: PromiseType) => void\n  let reject: (d: unknown) => void\n  const promise = new Promise<PromiseType>((rs, rj) => {\n    resolve = (v) => {\n      rs(v)\n      deferred.status = 'resolved'\n    }\n    reject = (v) => {\n      rj(v)\n      deferred.status = 'rejected'\n    }\n  })\n\n  const deferred: Deferred<PromiseType> = {\n    resolve: resolve!,\n    reject: reject!,\n    promise,\n    status: 'pending',\n  }\n  return deferred\n}\n","const noop = () => {}\n\nexport default noop\n","import type {\n  IPlaybackDirection,\n  IPlaybackRange,\n} from '@theatre/core/sequences/Sequence'\nimport {defer} from '@theatre/shared/utils/defer'\nimport noop from '@theatre/shared/utils/noop'\nimport type {Pointer, Ticker} from '@theatre/dataverse'\nimport {Atom} from '@theatre/dataverse'\n\nexport interface IPlaybackState {\n  position: number\n  playing: boolean\n}\n\nexport interface IPlaybackController {\n  getCurrentPosition(): number\n  gotoPosition(position: number): void\n  readonly statePointer: Pointer<IPlaybackState>\n  destroy(): void\n\n  play(\n    iterationCount: number,\n    range: IPlaybackRange,\n    rate: number,\n    direction: IPlaybackDirection,\n  ): Promise<boolean>\n\n  pause(): void\n}\n\nexport default class DefaultPlaybackController implements IPlaybackController {\n  _stopPlayCallback: () => void = noop\n  private _state: Atom<IPlaybackState> = new Atom<IPlaybackState>({\n    position: 0,\n    playing: false,\n  })\n  readonly statePointer: Pointer<IPlaybackState>\n\n  constructor(private readonly _ticker: Ticker) {\n    this.statePointer = this._state.pointer\n  }\n\n  destroy() {}\n\n  pause() {\n    this._stopPlayCallback()\n    this.playing = false\n    this._stopPlayCallback = noop\n  }\n\n  gotoPosition(time: number) {\n    this._updatePositionInState(time)\n  }\n\n  private _updatePositionInState(time: number) {\n    this._state.reduceState(['position'], () => time)\n  }\n\n  getCurrentPosition() {\n    return this._state.getState().position\n  }\n\n  get playing() {\n    return this._state.getState().playing\n  }\n\n  set playing(playing: boolean) {\n    this._state.setIn(['playing'], playing)\n  }\n\n  play(\n    iterationCount: number,\n    range: IPlaybackRange,\n    rate: number,\n    direction: IPlaybackDirection,\n  ): Promise<boolean> {\n    if (this.playing) {\n      this.pause()\n    }\n\n    this.playing = true\n\n    const ticker = this._ticker\n    const iterationLength = range[1] - range[0]\n\n    {\n      const startPos = this.getCurrentPosition()\n\n      if (startPos < range[0] || startPos > range[1]) {\n        if (direction === 'normal' || direction === 'alternate') {\n          this._updatePositionInState(range[0])\n        } else if (\n          direction === 'reverse' ||\n          direction === 'alternateReverse'\n        ) {\n          this._updatePositionInState(range[1])\n        }\n      } else if (direction === 'normal' || direction === 'alternate') {\n        if (startPos === range[1]) {\n          this._updatePositionInState(range[0])\n        }\n      } else {\n        if (startPos === range[0]) {\n          this._updatePositionInState(range[1])\n        }\n      }\n    }\n\n    const deferred = defer<boolean>()\n    const initialTickerTime = ticker.time\n    const totalPlaybackLength = iterationLength * iterationCount\n\n    let initialElapsedPos = this.getCurrentPosition() - range[0]\n\n    if (direction === 'reverse' || direction === 'alternateReverse') {\n      initialElapsedPos = range[1] - this.getCurrentPosition()\n    }\n\n    const tick = (currentTickerTime: number) => {\n      const elapsedTickerTime = Math.max(\n        currentTickerTime - initialTickerTime,\n        0,\n      )\n      const elapsedTickerTimeInSeconds = elapsedTickerTime / 1000\n\n      const elapsedPos = Math.min(\n        elapsedTickerTimeInSeconds * rate + initialElapsedPos,\n        totalPlaybackLength,\n      )\n\n      if (elapsedPos !== totalPlaybackLength) {\n        const iterationNumber = Math.floor(elapsedPos / iterationLength)\n\n        let currentIterationPos =\n          ((elapsedPos / iterationLength) % 1) * iterationLength\n\n        if (direction !== 'normal') {\n          if (direction === 'reverse') {\n            currentIterationPos = iterationLength - currentIterationPos\n          } else {\n            const isCurrentIterationNumberEven = iterationNumber % 2 === 0\n            if (direction === 'alternate') {\n              if (!isCurrentIterationNumberEven) {\n                currentIterationPos = iterationLength - currentIterationPos\n              }\n            } else {\n              if (isCurrentIterationNumberEven) {\n                currentIterationPos = iterationLength - currentIterationPos\n              }\n            }\n          }\n        }\n\n        this._updatePositionInState(currentIterationPos + range[0])\n        requestNextTick()\n      } else {\n        if (direction === 'normal') {\n          this._updatePositionInState(range[1])\n        } else if (direction === 'reverse') {\n          this._updatePositionInState(range[0])\n        } else {\n          const isLastIterationEven = (iterationCount - 1) % 2 === 0\n          if (direction === 'alternate') {\n            if (isLastIterationEven) {\n              this._updatePositionInState(range[1])\n            } else {\n              this._updatePositionInState(range[0])\n            }\n          } else {\n            if (isLastIterationEven) {\n              this._updatePositionInState(range[0])\n            } else {\n              this._updatePositionInState(range[1])\n            }\n          }\n        }\n        this.playing = false\n        deferred.resolve(true)\n      }\n    }\n\n    this._stopPlayCallback = () => {\n      ticker.offThisOrNextTick(tick)\n      ticker.offNextTick(tick)\n\n      if (this.playing) deferred.resolve(false)\n    }\n    const requestNextTick = () => ticker.onNextTick(tick)\n    ticker.onThisOrNextTick(tick)\n    return deferred.promise\n  }\n}\n","import type {\n  IPlaybackDirection,\n  IPlaybackRange,\n} from '@theatre/core/sequences/Sequence'\nimport {defer} from '@theatre/shared/utils/defer'\nimport {InvalidArgumentError} from '@theatre/shared/utils/errors'\nimport noop from '@theatre/shared/utils/noop'\nimport type {Pointer, Ticker} from '@theatre/dataverse'\nimport {Atom} from '@theatre/dataverse'\nimport type {\n  IPlaybackController,\n  IPlaybackState,\n} from './DefaultPlaybackController'\n\nexport default class AudioPlaybackController implements IPlaybackController {\n  _mainGain: GainNode\n  private _state: Atom<IPlaybackState> = new Atom<IPlaybackState>({\n    position: 0,\n    playing: false,\n  })\n  readonly statePointer: Pointer<IPlaybackState>\n  _stopPlayCallback: () => void = noop\n\n  constructor(\n    private readonly _ticker: Ticker,\n    private readonly _decodedBuffer: AudioBuffer,\n    private readonly _audioContext: AudioContext,\n    private readonly _nodeDestination: AudioNode,\n  ) {\n    this.statePointer = this._state.pointer\n\n    this._mainGain = this._audioContext.createGain()\n    this._mainGain.connect(this._nodeDestination)\n  }\n\n  private get _playing() {\n    return this._state.getState().playing\n  }\n\n  private set _playing(playing: boolean) {\n    this._state.setIn(['playing'], playing)\n  }\n\n  destroy() {}\n\n  pause() {\n    this._stopPlayCallback()\n    this._playing = false\n    this._stopPlayCallback = noop\n  }\n\n  gotoPosition(time: number) {\n    this._updatePositionInState(time)\n  }\n\n  private _updatePositionInState(time: number) {\n    this._state.reduceState(['position'], () => time)\n  }\n\n  getCurrentPosition() {\n    return this._state.getState().position\n  }\n\n  play(\n    iterationCount: number,\n    range: IPlaybackRange,\n    rate: number,\n    direction: IPlaybackDirection,\n  ): Promise<boolean> {\n    if (this._playing) {\n      this.pause()\n    }\n\n    this._playing = true\n\n    const ticker = this._ticker\n    let startPos = this.getCurrentPosition()\n    const iterationLength = range[1] - range[0]\n\n    if (direction !== 'normal') {\n      throw new InvalidArgumentError(\n        `Audio-controlled sequences can only be played in the \"normal\" direction. ` +\n          `'${direction}' given.`,\n      )\n    }\n\n    if (startPos < range[0] || startPos > range[1]) {\n      // if we're currently out of the range\n      this._updatePositionInState(range[0])\n    } else if (startPos === range[1]) {\n      // if we're currently at the very end of the range\n      this._updatePositionInState(range[0])\n    }\n    startPos = this.getCurrentPosition()\n\n    const deferred = defer<boolean>()\n\n    const currentSource = this._audioContext.createBufferSource()\n    currentSource.buffer = this._decodedBuffer\n    currentSource.connect(this._mainGain)\n    currentSource.playbackRate.value = rate\n\n    if (iterationCount > 1000) {\n      console.warn(\n        `Audio-controlled sequences cannot have an iterationCount larger than 1000. It has been clamped to 1000.`,\n      )\n      iterationCount = 1000\n    }\n\n    if (iterationCount > 1) {\n      currentSource.loop = true\n      currentSource.loopStart = range[0]\n      currentSource.loopEnd = range[1]\n    }\n\n    const initialTickerTime = ticker.time\n    let initialElapsedPos = startPos - range[0]\n    const totalPlaybackLength = iterationLength * iterationCount\n\n    currentSource.start(0, startPos, totalPlaybackLength - initialElapsedPos)\n\n    const tick = (currentTickerTime: number) => {\n      const elapsedTickerTime = Math.max(\n        currentTickerTime - initialTickerTime,\n        0,\n      )\n      const elapsedTickerTimeInSeconds = elapsedTickerTime / 1000\n\n      const elapsedPos = Math.min(\n        elapsedTickerTimeInSeconds * rate + initialElapsedPos,\n        totalPlaybackLength,\n      )\n\n      if (elapsedPos !== totalPlaybackLength) {\n        let currentIterationPos =\n          ((elapsedPos / iterationLength) % 1) * iterationLength\n\n        this._updatePositionInState(currentIterationPos + range[0])\n        requestNextTick()\n      } else {\n        this._updatePositionInState(range[1])\n        this._playing = false\n        cleanup()\n        deferred.resolve(true)\n      }\n    }\n\n    const cleanup = () => {\n      currentSource.stop()\n      currentSource.disconnect()\n    }\n\n    this._stopPlayCallback = () => {\n      cleanup()\n      ticker.offThisOrNextTick(tick)\n      ticker.offNextTick(tick)\n\n      if (this._playing) deferred.resolve(false)\n    }\n    const requestNextTick = () => ticker.onNextTick(tick)\n    ticker.onThisOrNextTick(tick)\n    return deferred.promise\n  }\n}\n","import logger from '@theatre/shared/logger'\nimport {privateAPI, setPrivateAPI} from '@theatre/core/privateAPIs'\nimport {defer} from '@theatre/shared/utils/defer'\nimport type Sequence from './Sequence'\nimport type {IPlaybackDirection, IPlaybackRange} from './Sequence'\nimport AudioPlaybackController from './playbackControllers/AudioPlaybackController'\nimport coreTicker from '@theatre/core/coreTicker'\nimport type {Pointer} from '@theatre/dataverse'\n\ninterface IAttachAudioArgs {\n  /**\n   * Either a URL to the audio file (eg \"https://localhost/audio.mp3\") or an instance of AudioBuffer\n   */\n  source: string | AudioBuffer\n  /**\n   * An optional AudioContext. If not provided, one will be created.\n   */\n  audioContext?: AudioContext\n  /**\n   * An AudioNode to feed the audio into. Will use audioContext.destination if not provided.\n   */\n  destinationNode?: AudioNode\n}\n\nexport interface ISequence {\n  readonly type: 'Theatre_Sequence_PublicAPI'\n\n  /**\n   * Starts playback of a sequence.\n   * Returns a promise that either resolves to true when the playback completes,\n   * or resolves to false if playback gets interrupted (for example by calling sequence.pause())\n   *\n   * @returns A promise that resolves when the playback is finished, or rejects if interruped\n   *\n   * @example\n   * Usage:\n   * ```ts\n   * // plays the sequence from the current position to sequence.length\n   * sheet.sequence.play()\n   *\n   * // plays the sequence at 2.4x speed\n   * sheet.sequence.play({rate: 2.4})\n   *\n   * // plays the sequence from second 1 to 4\n   * sheet.sequence.play({range: [1, 4]})\n   *\n   * // plays the sequence 4 times\n   * sheet.sequence.play({iterationCount: 4})\n   *\n   * // plays the sequence in reverse\n   * sheet.sequence.play({direction: 'reverse'})\n   *\n   * // plays the sequence back and forth forever (until interrupted)\n   * sheet.sequence.play({iterationCount: Infinity, direction: 'alternateReverse})\n   *\n   * // plays the sequence and logs \"done\" once playback is finished\n   * sheet.sequence.play().then(() => console.log('done'))\n   * ```\n   */\n  play(conf?: {\n    /**\n     * The number of times the animation must run. Must be an integer larger\n     * than 0. Defaults to 1. Pick Infinity to run forever\n     */\n    iterationCount?: number\n    /**\n     * Limits the range to be played. Default is [0, sequence.length]\n     */\n    range?: IPlaybackRange\n    /**\n     * The playback rate. Defaults to 1. Choosing 2 would play the animation\n     * at twice the speed.\n     */\n    rate?: number\n    /**\n     * The direction of the playback. Similar to CSS's animation-direction\n     */\n    direction?: IPlaybackDirection\n  }): Promise<boolean>\n\n  /**\n   * Pauses the currently playing animation\n   */\n  pause(): void\n\n  /**\n   * The current position of the playhead.\n   * In a time-based sequence, this represents the current time in seconds.\n   */\n  position: number\n\n  /**\n   * A Pointer to the sequence's inner state.\n   *\n   * @remarks\n   * As with any Pointer, you can use this with {@link onChange | onChange()} to listen to its value changes\n   * or with {@link val | val()} to read its current value.\n   *\n   * @example Usage\n   * ```ts\n   * import {onChange, val} from '@theatre/core'\n   *\n   * // let's assume `sheet` is a sheet\n   * const sequence = sheet.sequence\n   *\n   * onChange(sequence.pointer.length, (len) => {\n   *   console.log(\"Length of the sequence changed to:\", len)\n   * })\n   *\n   * onChange(sequence.pointer.position, (position) => {\n   *   console.log(\"Position of the sequence changed to:\", position)\n   * })\n   *\n   * onChange(sequence.pointer.playing, (playing) => {\n   *   console.log(playing ? 'playing' : 'paused')\n   * })\n   *\n   * // we can also read the current value of the pointer\n   * console.log('current length is', val(sequence.pointer.length))\n   * ```\n   */\n  pointer: Pointer<{\n    playing: boolean\n    length: number\n    position: number\n  }>\n\n  /**\n   * Attaches an audio source to the sequence. Playing the sequence automatically\n   * plays the audio source and their times are kept in sync.\n   *\n   * @returns A promise that resolves once the audio source is loaded and decoded\n   *\n   * Learn more [here](https://docs.theatrejs.com/in-depth/#sequence-attachaudio).\n   *\n   * @example\n   * Usage:\n   * ```ts\n   * // Loads and decodes audio from the URL and then attaches it to the sequence\n   * await sheet.sequence.attachAudio({source: \"https://localhost/audio.ogg\"})\n   * sheet.sequence.play()\n   *\n   * // Providing your own AudioAPI Context, destination, etc\n   * const audioContext: AudioContext = {...} // create an AudioContext using the Audio API\n   * const audioBuffer: AudioBuffer = {...} // create an AudioBuffer\n   * const destinationNode = audioContext.destination\n   *\n   * await sheet.sequence.attachAudio({source: audioBuffer, audioContext, destinationNode})\n   * ```\n   *\n   * Note: It's better to provide the `audioContext` rather than allow Theatre to create it.\n   * That's because some browsers [suspend the audioContext](https://developer.chrome.com/blog/autoplay/#webaudio)\n   * unless it's initiated by a user gesture, like a click. If that happens, Theatre will\n   * wait for a user gesture to resume the audioContext. But that's probably not an\n   * optimal user experience. It is better to provide a button or some other UI element\n   * to communicate to the user that they have to initiate the animation.\n   *\n   * @example\n   * Example:\n   * ```ts\n   * // html: <button id=\"#start\">start</button>\n   * const button = document.getElementById('start')\n   *\n   * button.addEventListener('click', async () => {\n   *   const audioContext = ...\n   *   await sheet.sequence.attachAudio({audioContext, source: '...'})\n   *   sheet.sequence.play()\n   * })\n   * ```\n   */\n  attachAudio(args: IAttachAudioArgs): Promise<{\n    /**\n     * An {@link https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer | AudioBuffer}.\n     * If `args.source` is a URL, then `decodedBuffer` would be the result\n     * of {@link https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext/decodeAudioData | audioContext.decodeAudioData()}\n     * on the audio file at that URL.\n     *\n     * If `args.source` is an `AudioBuffer`, then `decodedBuffer` would be equal to `args.source`\n     */\n    decodedBuffer: AudioBuffer\n    /**\n     * The `AudioContext`. It is either equal to `source.audioContext` if it is provided, or\n     * one that's created on the fly.\n     */\n    audioContext: AudioContext\n    /**\n     * Equals to either `args.destinationNode`, or if none is provided, it equals `audioContext.destinationNode`.\n     *\n     * See `gainNode` for more info.\n     */\n    destinationNode: AudioNode\n\n    /**\n     * This is an intermediate GainNode that Theatre feeds its audio to. It is by default\n     * connected to destinationNode, but you can disconnect the gainNode and feed it to your own graph.\n     *\n     * @example\n     * For example:\n     * ```ts\n     * const {gainNode, audioContext} = await sequence.attachAudio({source: '/audio.mp3'})\n     * // disconnect the gainNode (at this point, the sequence's audio track won't be audible)\n     * gainNode.disconnect()\n     * // create our own gain node\n     * const lowerGain = audioContext.createGain()\n     * // lower its volume to 10%\n     * lowerGain.gain.setValueAtTime(0.1, audioContext.currentTime)\n     * // feed the sequence's audio to our lowered gainNode\n     * gainNode.connect(lowerGain)\n     * // feed the lowered gainNode to the audioContext's destination\n     * lowerGain.connect(audioContext.destination)\n     * // now audio will be audible, with 10% the volume\n     * ```\n     */\n    gainNode: GainNode\n  }>\n}\n\nexport default class TheatreSequence implements ISequence {\n  get type(): 'Theatre_Sequence_PublicAPI' {\n    return 'Theatre_Sequence_PublicAPI'\n  }\n\n  /**\n   * @internal\n   */\n  constructor(sheet: Sequence) {\n    setPrivateAPI(this, sheet)\n  }\n\n  play(\n    conf?: Partial<{\n      iterationCount: number\n      range: IPlaybackRange\n      rate: number\n      direction: IPlaybackDirection\n    }>,\n  ): Promise<boolean> {\n    if (privateAPI(this)._project.isReady()) {\n      return privateAPI(this).play(conf)\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        logger.warn(\n          `You seem to have called sequence.play() before the project has finished loading.\\n` +\n            `This would **not** a problem in production when using '@theatre/core', since Theatre loads instantly in core mode. ` +\n            `However, when using '@theatre/studio', it takes a few milliseconds for it to load your project's state, ` +\n            `before which your sequences cannot start playing.\\n` +\n            `\\n` +\n            `To fix this, simply defer calling sequence.play() until after the project is loaded, like this:\\n` +\n            `project.ready.then(() => {\\n` +\n            `  sequence.play()\\n` +\n            `})`,\n        )\n      }\n      const d = defer<boolean>()\n      d.resolve(true)\n      return d.promise\n    }\n  }\n\n  pause() {\n    privateAPI(this).pause()\n  }\n\n  get position() {\n    return privateAPI(this).position\n  }\n\n  set position(position: number) {\n    privateAPI(this).position = position\n  }\n\n  async attachAudio(args: IAttachAudioArgs): Promise<{\n    decodedBuffer: AudioBuffer\n    audioContext: AudioContext\n    destinationNode: AudioNode\n    gainNode: GainNode\n  }> {\n    const {audioContext, destinationNode, decodedBuffer, gainNode} =\n      await resolveAudioBuffer(args)\n\n    const playbackController = new AudioPlaybackController(\n      coreTicker,\n      decodedBuffer,\n      audioContext,\n      gainNode,\n    )\n\n    privateAPI(this).replacePlaybackController(playbackController)\n\n    return {audioContext, destinationNode, decodedBuffer, gainNode}\n  }\n\n  get pointer(): ISequence['pointer'] {\n    return privateAPI(this).pointer\n  }\n}\n\nasync function resolveAudioBuffer(args: IAttachAudioArgs): Promise<{\n  decodedBuffer: AudioBuffer\n  audioContext: AudioContext\n  destinationNode: AudioNode\n  gainNode: GainNode\n}> {\n  function getAudioContext(): Promise<AudioContext> {\n    if (args.audioContext) return Promise.resolve(args.audioContext)\n    const ctx = new AudioContext()\n    if (ctx.state === 'running') return Promise.resolve(ctx)\n\n    // AudioContext is suspended, probably because the browser\n    // has blocked it since it is not initiated by a user gesture\n    return new Promise<AudioContext>((resolve) => {\n      const listener = () => {\n        ctx.resume()\n      }\n\n      const eventsToHookInto: Array<keyof WindowEventMap> = [\n        'mousedown',\n        'keydown',\n        'touchstart',\n      ]\n\n      const eventListenerOpts = {capture: true, passive: false}\n      eventsToHookInto.forEach((eventName) => {\n        window.addEventListener(eventName, listener, eventListenerOpts)\n      })\n\n      ctx.addEventListener('statechange', () => {\n        if (ctx.state === 'running') {\n          eventsToHookInto.forEach((eventName) => {\n            window.removeEventListener(eventName, listener, eventListenerOpts)\n          })\n          resolve(ctx)\n        }\n      })\n    })\n  }\n\n  async function getAudioBuffer(): Promise<AudioBuffer> {\n    if (args.source instanceof AudioBuffer) {\n      return args.source\n    }\n\n    const decodedBufferDeferred = defer<AudioBuffer>()\n    if (typeof args.source !== 'string') {\n      throw new Error(\n        `Error validating arguments to sequence.attachAudio(). ` +\n          `args.source must either be a string or an instance of AudioBuffer.`,\n      )\n    }\n\n    let fetchResponse\n    try {\n      fetchResponse = await fetch(args.source)\n    } catch (e) {\n      console.error(e)\n      throw new Error(\n        `Could not fetch '${args.source}'. Network error logged above.`,\n      )\n    }\n\n    let arrayBuffer\n    try {\n      arrayBuffer = await fetchResponse.arrayBuffer()\n    } catch (e) {\n      console.error(e)\n      throw new Error(`Could not read '${args.source}' as an arrayBuffer.`)\n    }\n\n    const audioContext = await audioContextPromise\n\n    audioContext.decodeAudioData(\n      arrayBuffer,\n      decodedBufferDeferred.resolve,\n      decodedBufferDeferred.reject,\n    )\n\n    let decodedBuffer\n    try {\n      decodedBuffer = await decodedBufferDeferred.promise\n    } catch (e) {\n      console.error(e)\n      throw new Error(`Could not decode ${args.source} as an audio file.`)\n    }\n\n    return decodedBuffer\n  }\n\n  const audioContextPromise = getAudioContext()\n  const audioBufferPromise = getAudioBuffer()\n\n  const [audioContext, decodedBuffer] = await Promise.all([\n    audioContextPromise,\n    audioBufferPromise,\n  ])\n\n  const destinationNode = args.destinationNode || audioContext.destination\n  const gainNode = audioContext.createGain()\n  gainNode.connect(destinationNode)\n\n  return {\n    audioContext,\n    decodedBuffer,\n    gainNode,\n    destinationNode,\n  }\n}\n","import type {$IntentionalAny} from '@theatre/shared/utils/types'\nimport userReadableTypeOfValue from '@theatre/shared/utils/userReadableTypeOfValue'\nimport type {\n  IShorthandCompoundProps,\n  IValidCompoundProps,\n  ShorthandCompoundPropsToLonghandCompoundProps,\n} from './internals'\nimport {sanitizeCompoundProps} from './internals'\nimport {propTypeSymbol} from './internals'\n\nconst validateCommonOpts = (\n  fnCallSignature: string,\n  opts?: PropTypeConfigOpts,\n) => {\n  if (process.env.NODE_ENV !== 'production') {\n    if (opts === undefined) return\n    if (typeof opts !== 'object' || opts === null) {\n      throw new Error(\n        `opts in ${fnCallSignature} must either be undefined or an object.`,\n      )\n    }\n    if (Object.prototype.hasOwnProperty.call(opts, 'label')) {\n      const {label} = opts\n      if (typeof label !== 'string') {\n        throw new Error(\n          `opts.label in ${fnCallSignature} should be a string. ${userReadableTypeOfValue(\n            label,\n          )} given.`,\n        )\n      }\n      if (label.trim().length !== label.length) {\n        throw new Error(\n          `opts.label in ${fnCallSignature} should not start/end with whitespace. \"${label}\" given.`,\n        )\n      }\n      if (label.length === 0) {\n        throw new Error(\n          `opts.label in ${fnCallSignature} should not be an empty string. If you wish to have no label, remove opts.label from opts.`,\n        )\n      }\n    }\n  }\n}\n\n/**\n * A compound prop type (basically a JS object).\n *\n * @example\n * Usage:\n * ```ts\n * // shorthand\n * const position = {\n *   x: 0,\n *   y: 0\n * }\n * assert(sheet.object('some object', position).value.x === 0)\n *\n * // nesting\n * const foo = {bar: {baz: {quo: 0}}}\n * assert(sheet.object('some object', foo).bar.baz.quo === 0)\n *\n * // With additional options:\n * const position = t.compound(\n *   {x: 0, y: 0},\n *   // a custom label for the prop:\n *   {label: \"Position\"}\n * )\n * ```\n *\n */\nexport const compound = <Props extends IShorthandCompoundProps>(\n  props: Props,\n  opts?: PropTypeConfigOpts,\n): PropTypeConfig_Compound<\n  ShorthandCompoundPropsToLonghandCompoundProps<Props>\n> => {\n  validateCommonOpts('t.compound(props, opts)', opts)\n  return {\n    type: 'compound',\n    props: sanitizeCompoundProps(props),\n    valueType: null as $IntentionalAny,\n    [propTypeSymbol]: 'TheatrePropType',\n    label: opts?.label,\n  }\n}\n\n/**\n * A number prop type.\n *\n * @example\n * Usage\n * ```ts\n * // shorthand:\n * const obj = sheet.object('key', {x: 0})\n *\n * // With options (equal to above)\n * const obj = sheet.object('key', {\n *   x: t.number(0)\n * })\n *\n * // With a range (note that opts.range is just a visual guide, not a validation rule)\n * const x = t.number(0, {range: [0, 10]}) // limited to 0 and 10\n *\n * // With custom nudging\n * const x = t.number(0, {nudgeMultiplier: 0.1}) // nudging will happen in 0.1 increments\n *\n * // With custom nudging function\n * const x = t.number({\n *   nudgeFn: (\n *     // the mouse movement (in pixels)\n *     deltaX: number,\n *     // the movement as a fraction of the width of the number editor's input\n *     deltaFraction: number,\n *     // A multiplier that's usually 1, but might be another number if user wants to nudge slower/faster\n *     magnitude: number,\n *     // the configuration of the number\n *     config: {nudgeMultiplier?: number; range?: [number, number]},\n *   ): number => {\n *     return deltaX * magnitude\n *   },\n * })\n * ```\n *\n * @param defaultValue - The default value (Must be a finite number)\n * @param opts - The options (See usage examples)\n * @returns A number prop config\n */\nexport const number = (\n  defaultValue: number,\n  opts?: {\n    nudgeFn?: PropTypeConfig_Number['nudgeFn']\n    range?: PropTypeConfig_Number['range']\n    nudgeMultiplier?: number\n  } & PropTypeConfigOpts,\n): PropTypeConfig_Number => {\n  if (process.env.NODE_ENV !== 'production') {\n    validateCommonOpts('t.number(defaultValue, opts)', opts)\n    if (typeof defaultValue !== 'number' || !isFinite(defaultValue)) {\n      throw new Error(\n        `Argument defaultValue in t.number(defaultValue) must be a number. ${userReadableTypeOfValue(\n          defaultValue,\n        )} given.`,\n      )\n    }\n    if (typeof opts === 'object' && opts !== null) {\n      if (Object.prototype.hasOwnProperty.call(opts, 'range')) {\n        if (!Array.isArray(opts.range)) {\n          throw new Error(\n            `opts.range in t.number(defaultValue, opts) must be a tuple of two numbers. ${userReadableTypeOfValue(\n              opts.range,\n            )} given.`,\n          )\n        }\n        if (opts.range.length !== 2) {\n          throw new Error(\n            `opts.range in t.number(defaultValue, opts) must have two elements. ${opts.range.length} given.`,\n          )\n        }\n        if (!opts.range.every((n) => typeof n === 'number' && !isNaN(n))) {\n          throw new Error(\n            `opts.range in t.number(defaultValue, opts) must be a tuple of two numbers.`,\n          )\n        }\n        if (opts.range[0] >= opts.range[1]) {\n          throw new Error(\n            `opts.range[0] in t.number(defaultValue, opts) must be smaller than opts.range[1]. Given: ${JSON.stringify(\n              opts.range,\n            )}`,\n          )\n        }\n      }\n      if (Object.prototype.hasOwnProperty.call(opts, 'nudgeMultiplier')) {\n        if (\n          typeof opts!.nudgeMultiplier !== 'number' ||\n          !isFinite(opts!.nudgeMultiplier)\n        ) {\n          throw new Error(\n            `opts.nudgeMultiplier in t.number(defaultValue, opts) must be a finite number. ${userReadableTypeOfValue(\n              opts!.nudgeMultiplier,\n            )} given.`,\n          )\n        }\n      }\n      if (Object.prototype.hasOwnProperty.call(opts, 'nudgeFn')) {\n        if (typeof opts?.nudgeFn !== 'function') {\n          throw new Error(\n            `opts.nudgeFn in t.number(defaultValue, opts) must be a function. ${userReadableTypeOfValue(\n              opts!.nudgeFn,\n            )} given.`,\n          )\n        }\n      }\n    }\n  }\n  return {\n    type: 'number',\n    valueType: 0,\n    default: defaultValue,\n    [propTypeSymbol]: 'TheatrePropType',\n    ...(opts ? opts : {}),\n    label: opts?.label,\n    nudgeFn: opts?.nudgeFn ?? defaultNumberNudgeFn,\n    nudgeMultiplier:\n      typeof opts?.nudgeMultiplier === 'number' ? opts.nudgeMultiplier : 1,\n  }\n}\n\n/**\n * A boolean prop type\n *\n * @example\n * Usage:\n * ```ts\n * // shorthand:\n * const obj = sheet.object('key', {isOn: true})\n *\n * // with a label:\n * const obj = sheet.object('key', {\n *   isOn: t.boolean(true, {\n *     label: 'Enabled'\n *   })\n * })\n * ```\n *\n * @param defaultValue - The default value (must be a boolean)\n * @param opts - Options (See usage examples)\n */\nexport const boolean = (\n  defaultValue: boolean,\n  opts?: PropTypeConfigOpts,\n): PropTypeConfig_Boolean => {\n  if (process.env.NODE_ENV !== 'production') {\n    validateCommonOpts('t.boolean(defaultValue, opts)', opts)\n    if (typeof defaultValue !== 'boolean') {\n      throw new Error(\n        `defaultValue in t.boolean(defaultValue) must be a boolean. ${userReadableTypeOfValue(\n          defaultValue,\n        )} given.`,\n      )\n    }\n  }\n  return {\n    type: 'boolean',\n    default: defaultValue,\n    valueType: null as $IntentionalAny,\n    [propTypeSymbol]: 'TheatrePropType',\n    label: opts?.label,\n  }\n}\n\n/**\n * A string prop type\n *\n * @example\n * Usage:\n * ```ts\n * // shorthand:\n * const obj = sheet.object('key', {message: \"Animation loading\"})\n *\n * // with a label:\n * const obj = sheet.object('key', {\n *   message: t.string(\"Animation Loading\", {\n *     label: 'The Message'\n *   })\n * })\n * ```\n *\n * @param defaultValue - The default value (must be a string)\n * @param opts - The options (See usage examples)\n * @returns A string prop type\n */\nexport const string = (\n  defaultValue: string,\n  opts?: PropTypeConfigOpts,\n): PropTypeConfig_String => {\n  if (process.env.NODE_ENV !== 'production') {\n    validateCommonOpts('t.string(defaultValue, opts)', opts)\n    if (typeof defaultValue !== 'string') {\n      throw new Error(\n        `defaultValue in t.string(defaultValue) must be a string. ${userReadableTypeOfValue(\n          defaultValue,\n        )} given.`,\n      )\n    }\n  }\n  return {\n    type: 'string',\n    default: defaultValue,\n    valueType: null as $IntentionalAny,\n    [propTypeSymbol]: 'TheatrePropType',\n    label: opts?.label,\n  }\n}\n\n/**\n * A stringLiteral prop type, useful for building menus or radio buttons.\n *\n * @example\n * Usage:\n * ```ts\n * // Basic usage\n * const obj = sheet.object('key', {\n *   light: t.stringLiteral(\"r\", {r: \"Red\", \"g\": \"Green\"})\n * })\n *\n * // Shown as a radio switch with a custom label\n * const obj = sheet.object('key', {\n *   light: t.stringLiteral(\"r\", {r: \"Red\", \"g\": \"Green\"})\n * }, {as: \"switch\", label: \"Street Light\"})\n * ```\n *\n * @returns A stringLiteral prop type\n *\n */\nexport function stringLiteral<Opts extends {[key in string]: string}>(\n  /**\n   * Default value (a string that equals one of the options)\n   */\n  defaultValue: Extract<keyof Opts, string>,\n  /**\n   * The options. Use the `\"value\": \"Label\"` format.\n   *\n   * An object like `{[value]: Label}`. Example: `{r: \"Red\", \"g\": \"Green\"}`\n   */\n  options: Opts,\n  /**\n   * opts.as Determines if editor is shown as a menu or a switch. Either 'menu' or 'switch'.  Default: 'menu'\n   */\n  opts?: {as?: 'menu' | 'switch'} & PropTypeConfigOpts,\n): PropTypeConfig_StringLiteral<Extract<keyof Opts, string>> {\n  return {\n    type: 'stringLiteral',\n    default: defaultValue,\n    options: {...options},\n    [propTypeSymbol]: 'TheatrePropType',\n    valueType: null as $IntentionalAny,\n    as: opts?.as ?? 'menu',\n    label: opts?.label,\n  }\n}\n\ninterface IBasePropType<ValueType> {\n  valueType: ValueType\n  [propTypeSymbol]: 'TheatrePropType'\n  label: string | undefined\n}\n\nexport interface PropTypeConfig_Number extends IBasePropType<number> {\n  type: 'number'\n  default: number\n  range?: [min: number, max: number]\n  nudgeFn: NumberNudgeFn\n  nudgeMultiplier: number\n}\n\nexport type NumberNudgeFn = (p: {\n  deltaX: number\n  deltaFraction: number\n  magnitude: number\n  config: PropTypeConfig_Number\n}) => number\n\nconst defaultNumberNudgeFn: NumberNudgeFn = ({\n  config,\n  deltaX,\n  deltaFraction,\n  magnitude,\n}) => {\n  const {range} = config\n  if (range) {\n    return (\n      deltaFraction * (range[1] - range[0]) * magnitude * config.nudgeMultiplier\n    )\n  }\n\n  return deltaX * magnitude * config.nudgeMultiplier\n}\n\nexport interface PropTypeConfig_Boolean extends IBasePropType<boolean> {\n  type: 'boolean'\n  default: boolean\n}\n\nexport interface PropTypeConfigOpts {\n  label?: string\n}\nexport interface PropTypeConfig_String extends IBasePropType<string> {\n  type: 'string'\n  default: string\n}\n\nexport interface PropTypeConfig_StringLiteral<T extends string>\n  extends IBasePropType<T> {\n  type: 'stringLiteral'\n  default: T\n  options: Record<T, string>\n  as: 'menu' | 'switch'\n}\n\n/**\n *\n */\nexport interface PropTypeConfig_Compound<Props extends IValidCompoundProps>\n  extends IBasePropType<{[K in keyof Props]: Props[K]['valueType']}> {\n  type: 'compound'\n  props: Record<string, PropTypeConfig>\n}\n\nexport interface PropTypeConfig_Enum extends IBasePropType<{}> {\n  type: 'enum'\n  cases: Record<string, PropTypeConfig>\n  defaultCase: string\n}\n\nexport type PropTypeConfig_AllPrimitives =\n  | PropTypeConfig_Number\n  | PropTypeConfig_Boolean\n  | PropTypeConfig_String\n  | PropTypeConfig_StringLiteral<$IntentionalAny>\n\nexport type PropTypeConfig =\n  | PropTypeConfig_AllPrimitives\n  | PropTypeConfig_Compound<$IntentionalAny>\n  | PropTypeConfig_Enum\n","export default function ellipsify(str: string, maxLength: number) {\n  if (str.length <= maxLength) return str\n  return str.substr(0, maxLength - 3) + '...'\n}\n","import ellipsify from './ellipsify'\n\nconst userReadableTypeOfValue = (v: unknown): string => {\n  if (typeof v === 'string') {\n    return `string(\"${ellipsify(v, 10)}\")`\n  } else if (typeof v === 'number') {\n    return `number(${ellipsify(String(v), 10)})`\n  } else if (v === null) {\n    return 'null'\n  } else if (v === undefined) {\n    return 'undefined'\n  } else if (typeof v === 'boolean') {\n    return String(v)\n  } else if (Array.isArray(v)) {\n    return 'array'\n  } else if (typeof v === 'object') {\n    return 'object'\n  } else {\n    return 'unknown'\n  }\n}\n\nexport default userReadableTypeOfValue\n","import {InvalidArgumentError} from '@theatre/shared/utils/errors'\nimport type {$IntentionalAny} from '@theatre/shared/utils/types'\nimport userReadableTypeOfValue from '@theatre/shared/utils/userReadableTypeOfValue'\nimport {isPlainObject} from 'lodash-es'\nimport type {\n  PropTypeConfig,\n  PropTypeConfig_Boolean,\n  PropTypeConfig_Compound,\n  PropTypeConfig_Number,\n  PropTypeConfig_String,\n} from './index'\nimport * as t from './index'\n\nexport const propTypeSymbol = Symbol('TheatrePropType_Basic')\n\nexport type IValidCompoundProps = {\n  [K in string]: PropTypeConfig\n}\n\ntype IShorthandProp =\n  | string\n  | number\n  | boolean\n  | PropTypeConfig\n  | IShorthandCompoundProps\n\nexport type IShorthandCompoundProps = {\n  [K in string]: IShorthandProp\n}\n\nexport type ShorthandPropToLonghandProp<P extends IShorthandProp> =\n  P extends string\n    ? PropTypeConfig_String\n    : P extends number\n    ? PropTypeConfig_Number\n    : P extends boolean\n    ? PropTypeConfig_Boolean\n    : P extends PropTypeConfig\n    ? P\n    : P extends IShorthandCompoundProps\n    ? PropTypeConfig_Compound<ShorthandCompoundPropsToLonghandCompoundProps<P>>\n    : never\n\nexport type ShorthandCompoundPropsToLonghandCompoundProps<\n  P extends IShorthandCompoundProps,\n> = {\n  [K in keyof P]: ShorthandPropToLonghandProp<P[K]>\n}\n\nexport function isLonghandPropType(t: unknown): t is PropTypeConfig {\n  return (\n    typeof t === 'object' &&\n    !!t &&\n    (t as $IntentionalAny)[propTypeSymbol] === 'TheatrePropType'\n  )\n}\n\nexport function toLonghandProp(p: unknown): PropTypeConfig {\n  if (typeof p === 'number') {\n    return t.number(p)\n  } else if (typeof p === 'boolean') {\n    return t.boolean(p)\n  } else if (typeof p === 'string') {\n    return t.string(p)\n  } else if (typeof p === 'object' && !!p) {\n    if (isLonghandPropType(p)) return p\n    if (isPlainObject(p)) {\n      return t.compound(p as $IntentionalAny)\n    } else {\n      throw new InvalidArgumentError(\n        `This value is not a valid prop type: ${userReadableTypeOfValue(p)}`,\n      )\n    }\n  } else {\n    throw new InvalidArgumentError(\n      `This value is not a valid prop type: ${userReadableTypeOfValue(p)}`,\n    )\n  }\n}\n\nexport function sanitizeCompoundProps(\n  props: IShorthandCompoundProps,\n): IValidCompoundProps {\n  const sanitizedProps: IValidCompoundProps = {}\n  if (process.env.NODE_ENV !== 'production') {\n    if (typeof props !== 'object' || !props) {\n      throw new InvalidArgumentError(\n        `t.compound() expects an object, like: {x: 10}. ${userReadableTypeOfValue(\n          props,\n        )} given.`,\n      )\n    }\n  }\n  for (const key of Object.keys(props)) {\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof key !== 'string') {\n        throw new InvalidArgumentError(\n          `t.compound()'s keys must be all strings. ${userReadableTypeOfValue(\n            key,\n          )} given.`,\n        )\n      } else if (key.length === 0 || !key.match(/^\\w+$/)) {\n        throw new InvalidArgumentError(\n          `compound key ${userReadableTypeOfValue(\n            key,\n          )} is invalid. The keys must be alphanumeric and start with a letter.`,\n        )\n      } else if (key.length > 64) {\n        throw new InvalidArgumentError(\n          `compound key ${userReadableTypeOfValue(key)} is too long.`,\n        )\n      }\n    }\n\n    const val = props[key]\n    if (isLonghandPropType(val)) {\n      sanitizedProps[key] = val as $IntentionalAny\n    } else {\n      sanitizedProps[key] = toLonghandProp(val) as $IntentionalAny\n    }\n  }\n  return sanitizedProps\n}\n","import logger from '@theatre/shared/logger'\nimport {InvalidArgumentError} from './errors'\n\nconst sanifySlashedPath = (p: string): string =>\n  p\n    .replace(/^[\\s\\/]*/, '')\n    .replace(/[\\s\\/]*$/, '')\n    .replace(/\\s*\\/\\s*/, ' / ')\n\nconst getValidationErrorsOfSlashedPath = (p: string): void | string => {\n  if (typeof p !== 'string') return `it is not a string. (it is a ${typeof p})`\n\n  const components = p.split(/\\//)\n  if (components.length === 0) return `it is empty.`\n\n  for (let i = 0; i < components.length; i++) {\n    const component = components[i].trim()\n    if (component.length === 0) return `the component #${i + 1} is empty.`\n    if (component.length > 32)\n      return `the component '${component}' must have 32 characters or less.`\n  }\n}\n\nexport function validateAndSanitiseSlashedPathOrThrow(\n  unsanitisedPath: string,\n  fnName: string,\n) {\n  const sanitisedPath = sanifySlashedPath(unsanitisedPath)\n  if (process.env.NODE_ENV !== 'development') {\n    return sanitisedPath\n  }\n  const validation = getValidationErrorsOfSlashedPath(sanitisedPath)\n  if (validation) {\n    throw new InvalidArgumentError(\n      `The path in ${fnName}(${\n        typeof unsanitisedPath === 'string' ? `\"${unsanitisedPath}\"` : ''\n      }) is invalid because ${validation}`,\n    )\n  }\n  if (unsanitisedPath !== sanitisedPath) {\n    logger.warn(\n      // @todo better error message needed. What's the call to action?\n      `The path in ${fnName}(\"${unsanitisedPath}\") was sanitised to \"${sanitisedPath}\".`,\n    )\n  }\n  return sanitisedPath\n}\n","import {privateAPI, setPrivateAPI} from '@theatre/core/privateAPIs'\nimport type {IProject} from '@theatre/core/projects/TheatreProject'\nimport type TheatreSequence from '@theatre/core/sequences/TheatreSequence'\nimport type {ISequence} from '@theatre/core/sequences/TheatreSequence'\nimport type {PropTypeConfig_Compound} from '@theatre/core/propTypes'\nimport {compound} from '@theatre/core/propTypes'\nimport type {ISheetObject} from '@theatre/core/sheetObjects/TheatreSheetObject'\nimport type Sheet from '@theatre/core/sheets/Sheet'\nimport type {SheetAddress} from '@theatre/shared/utils/addresses'\nimport {InvalidArgumentError} from '@theatre/shared/utils/errors'\nimport {validateAndSanitiseSlashedPathOrThrow} from '@theatre/shared/utils/slashedPaths'\nimport type {$IntentionalAny} from '@theatre/shared/utils/types'\nimport userReadableTypeOfValue from '@theatre/shared/utils/userReadableTypeOfValue'\nimport deepEqual from 'fast-deep-equal'\nimport type {IShorthandCompoundProps} from '@theatre/core/propTypes/internals'\nimport type SheetObject from '@theatre/core/sheetObjects/SheetObject'\n\nexport type SheetObjectConfig<\n  Props extends PropTypeConfig_Compound<$IntentionalAny>,\n> = Props\n\nexport interface ISheet {\n  /**\n   * All sheets have `sheet.type === 'Theatre_Sheet_PublicAPI'`\n   */\n  readonly type: 'Theatre_Sheet_PublicAPI'\n\n  /**\n   * The Project this Sheet belongs to\n   */\n  readonly project: IProject\n\n  /**\n   * The address of the Sheet\n   */\n  readonly address: SheetAddress\n\n  /**\n   * Creates a child object for the sheet\n   *\n   * **Docs: https://docs.theatrejs.com/in-depth/#objects**\n   *\n   * @param key - Each object is identified by a key, which is a non-empty string\n   * @param props - The props of the object. See examples\n   *\n   * @returns An Object\n   *\n   * @example\n   * Usage:\n   * ```ts\n   * // Create an object named \"a unique key\" with no props\n   * const obj = sheet.object(\"a unique key\", {})\n   * obj.address.objectKey // \"a unique key\"\n   *\n   *\n   * // Create an object with {x: 0}\n   * const obj = sheet.object(\"obj\", {x: 0})\n   * obj.value.x // returns 0 or the current number that the user has set\n   *\n   * // Create an object with nested props\n   * const obj = sheet.object(\"obj\", {position: {x: 0, y: 0}})\n   * obj.value.position // {x: 0, y: 0}\n   * ```\n   */\n  object<Props extends IShorthandCompoundProps>(\n    key: string,\n    props: Props,\n  ): ISheetObject<Props>\n\n  /**\n   * The Sequence of this Sheet\n   */\n  readonly sequence: ISequence\n}\n\nconst weakMapOfUnsanitizedProps = new WeakMap<\n  SheetObject,\n  IShorthandCompoundProps\n>()\n\nexport default class TheatreSheet implements ISheet {\n  get type(): 'Theatre_Sheet_PublicAPI' {\n    return 'Theatre_Sheet_PublicAPI'\n  }\n  /**\n   * @internal\n   */\n  constructor(sheet: Sheet) {\n    setPrivateAPI(this, sheet)\n  }\n\n  object<Props extends IShorthandCompoundProps>(\n    key: string,\n    config: Props,\n  ): ISheetObject<Props> {\n    const internal = privateAPI(this)\n    const sanitizedPath = validateAndSanitiseSlashedPathOrThrow(\n      key,\n      `sheet.object(\"${key}\", ...)`,\n    )\n\n    const existingObject = internal.getObject(sanitizedPath)\n\n    const nativeObject = null\n\n    if (existingObject) {\n      if (process.env.NODE_ENV !== 'production') {\n        const prevConfig = weakMapOfUnsanitizedProps.get(existingObject)\n        if (prevConfig) {\n          if (!deepEqual(config, prevConfig)) {\n            throw new Error(\n              `You seem to have called sheet.object(\"${key}\", config) twice, with different values for \\`config\\`. ` +\n                `This is disallowed because changing the config of an object on the fly would make it difficult to reason about.\\n\\n` +\n                `You can fix this by either re-using the existing object, or calling sheet.object(\"${key}\", config) with the same config.`,\n            )\n          }\n        }\n      }\n\n      return existingObject.publicApi as $IntentionalAny\n    } else {\n      const sanitizedConfig = compound(config)\n      const object = internal.createObject(\n        sanitizedPath,\n        nativeObject,\n        sanitizedConfig,\n      )\n      if (process.env.NODE_ENV !== 'production') {\n        weakMapOfUnsanitizedProps.set(object, config)\n      }\n      return object.publicApi as $IntentionalAny\n    }\n  }\n\n  get sequence(): TheatreSequence {\n    return privateAPI(this).getSequence().publicApi\n  }\n\n  get project(): IProject {\n    return privateAPI(this).project.publicApi\n  }\n\n  get address(): SheetAddress {\n    return {...privateAPI(this).address}\n  }\n}\n\nconst validateSequenceNameOrThrow = (value: string) => {\n  if (typeof value !== 'string') {\n    throw new InvalidArgumentError(\n      `Argument 'name' in \\`sheet.getSequence(name)\\` must be a string. Instead, it was ${userReadableTypeOfValue(\n        value,\n      )}.`,\n    )\n  }\n\n  const idTrimmed = value.trim()\n  if (idTrimmed.length !== value.length) {\n    throw new InvalidArgumentError(\n      `Argument 'name' in \\`sheet.getSequence(\"${value}\")\\` should not have surrounding whitespace.`,\n    )\n  }\n\n  if (idTrimmed.length < 3) {\n    throw new InvalidArgumentError(\n      `Argument 'name' in \\`sheet.getSequence(\"${value}\")\\` should be at least 3 characters long.`,\n    )\n  }\n}\n","import {\n\tIProduce,\n\tIProduceWithPatches,\n\tImmer,\n\tDraft,\n\tImmutable\n} from \"./internal\"\n\nexport {\n\tDraft,\n\tImmutable,\n\tPatch,\n\tPatchListener,\n\toriginal,\n\tcurrent,\n\tisDraft,\n\tisDraftable,\n\tNOTHING as nothing,\n\tDRAFTABLE as immerable,\n\tfreeze\n} from \"./internal\"\n\nconst immer = new Immer()\n\n/**\n * The `produce` function takes a value and a \"recipe function\" (whose\n * return value often depends on the base state). The recipe function is\n * free to mutate its first argument however it wants. All mutations are\n * only ever applied to a __copy__ of the base state.\n *\n * Pass only a function to create a \"curried producer\" which relieves you\n * from passing the recipe function every time.\n *\n * Only plain objects and arrays are made mutable. All other objects are\n * considered uncopyable.\n *\n * Note: This function is __bound__ to its `Immer` instance.\n *\n * @param {any} base - the initial state\n * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n * @param {Function} patchListener - optional function that will be called with all the patches produced here\n * @returns {any} a new state, or the initial state if nothing was modified\n */\nexport const produce: IProduce = immer.produce\nexport default produce\n\n/**\n * Like `produce`, but `produceWithPatches` always returns a tuple\n * [nextState, patches, inversePatches] (instead of just the next state)\n */\nexport const produceWithPatches: IProduceWithPatches = immer.produceWithPatches.bind(\n\timmer\n)\n\n/**\n * Pass true to automatically freeze all copies created by Immer.\n *\n * Always freeze by default, even in production mode\n */\nexport const setAutoFreeze = immer.setAutoFreeze.bind(immer)\n\n/**\n * Pass true to use the ES2015 `Proxy` class when creating drafts, which is\n * always faster than using ES5 proxies.\n *\n * By default, feature detection is used, so calling this is rarely necessary.\n */\nexport const setUseProxies = immer.setUseProxies.bind(immer)\n\n/**\n * Apply an array of Immer patches to the first argument.\n *\n * This function is a producer, which means copy-on-write is in effect.\n */\nexport const applyPatches = immer.applyPatches.bind(immer)\n\n/**\n * Create an Immer draft from the given base state, which may be a draft itself.\n * The draft can be modified until you finalize it with the `finishDraft` function.\n */\nexport const createDraft = immer.createDraft.bind(immer)\n\n/**\n * Finalize an Immer draft from a `createDraft` call, returning the base state\n * (if no changes were made) or a modified copy. The draft must *not* be\n * mutated afterwards.\n *\n * Pass a function as the 2nd argument to generate Immer patches based on the\n * changes that were made.\n */\nexport const finishDraft = immer.finishDraft.bind(immer)\n\n/**\n * This function is actually a no-op, but can be used to cast an immutable type\n * to an draft type and make TypeScript happy\n *\n * @param value\n */\nexport function castDraft<T>(value: T): Draft<T> {\n\treturn value as any\n}\n\n/**\n * This function is actually a no-op, but can be used to cast a mutable type\n * to an immutable type and make TypeScript happy\n * @param value\n */\nexport function castImmutable<T>(value: T): Immutable<T> {\n\treturn value as any\n}\n\nexport {Immer}\n\nexport {enableES5} from \"./plugins/es5\"\nexport {enablePatches} from \"./plugins/patches\"\nexport {enableMapSet} from \"./plugins/mapset\"\nexport {enableAllPlugins} from \"./plugins/all\"\n","import {\n\tPatch,\n\tPatchListener,\n\tDrafted,\n\tImmer,\n\tDRAFT_STATE,\n\tImmerState,\n\tProxyType,\n\tgetPlugin\n} from \"../internal\"\nimport {die} from \"../utils/errors\"\n\n/** Each scope represents a `produce` call. */\n\nexport interface ImmerScope {\n\tpatches_?: Patch[]\n\tinversePatches_?: Patch[]\n\tcanAutoFreeze_: boolean\n\tdrafts_: any[]\n\tparent_?: ImmerScope\n\tpatchListener_?: PatchListener\n\timmer_: Immer\n\tunfinalizedDrafts_: number\n}\n\nlet currentScope: ImmerScope | undefined\n\nexport function getCurrentScope() {\n\tif (__DEV__ && !currentScope) die(0)\n\treturn currentScope!\n}\n\nfunction createScope(\n\tparent_: ImmerScope | undefined,\n\timmer_: Immer\n): ImmerScope {\n\treturn {\n\t\tdrafts_: [],\n\t\tparent_,\n\t\timmer_,\n\t\t// Whenever the modified draft contains a draft from another scope, we\n\t\t// need to prevent auto-freezing so the unowned draft can be finalized.\n\t\tcanAutoFreeze_: true,\n\t\tunfinalizedDrafts_: 0\n\t}\n}\n\nexport function usePatchesInScope(\n\tscope: ImmerScope,\n\tpatchListener?: PatchListener\n) {\n\tif (patchListener) {\n\t\tgetPlugin(\"Patches\") // assert we have the plugin\n\t\tscope.patches_ = []\n\t\tscope.inversePatches_ = []\n\t\tscope.patchListener_ = patchListener\n\t}\n}\n\nexport function revokeScope(scope: ImmerScope) {\n\tleaveScope(scope)\n\tscope.drafts_.forEach(revokeDraft)\n\t// @ts-ignore\n\tscope.drafts_ = null\n}\n\nexport function leaveScope(scope: ImmerScope) {\n\tif (scope === currentScope) {\n\t\tcurrentScope = scope.parent_\n\t}\n}\n\nexport function enterScope(immer: Immer) {\n\treturn (currentScope = createScope(currentScope, immer))\n}\n\nfunction revokeDraft(draft: Drafted) {\n\tconst state: ImmerState = draft[DRAFT_STATE]\n\tif (\n\t\tstate.type_ === ProxyType.ProxyObject ||\n\t\tstate.type_ === ProxyType.ProxyArray\n\t)\n\t\tstate.revoke_()\n\telse state.revoked_ = true\n}\n","import type Project from '@theatre/core/projects/Project'\nimport Sequence from '@theatre/core/sequences/Sequence'\nimport type SheetObject from '@theatre/core/sheetObjects/SheetObject'\nimport type {SheetObjectConfig} from '@theatre/core/sheets/TheatreSheet'\nimport TheatreSheet from '@theatre/core/sheets/TheatreSheet'\nimport type {SheetAddress} from '@theatre/shared/utils/addresses'\nimport type {$IntentionalAny} from '@theatre/shared/utils/types'\nimport {Atom, valueDerivation} from '@theatre/dataverse'\nimport type SheetTemplate from './SheetTemplate'\n\ntype IObjects = {[key: string]: SheetObject}\n\nexport default class Sheet {\n  private readonly _objects: Atom<IObjects> = new Atom<IObjects>({})\n  private _sequence: undefined | Sequence\n  readonly address: SheetAddress\n  readonly publicApi: TheatreSheet\n  readonly project: Project\n  readonly objectsP = this._objects.pointer\n  type: 'Theatre_Sheet' = 'Theatre_Sheet'\n\n  constructor(\n    readonly template: SheetTemplate,\n    public readonly instanceId: string,\n  ) {\n    this.project = template.project\n    this.address = {\n      ...template.address,\n      sheetInstanceId: this.instanceId,\n    }\n\n    this.publicApi = new TheatreSheet(this)\n  }\n\n  /**\n   * @remarks At some point, we have to reconcile the concept of \"an object\"\n   * with that of \"an element.\"\n   */\n  createObject(\n    key: string,\n    nativeObject: unknown,\n    config: SheetObjectConfig<$IntentionalAny>,\n  ): SheetObject {\n    const objTemplate = this.template.getObjectTemplate(\n      key,\n      nativeObject,\n      config,\n    )\n\n    const object = objTemplate.createInstance(this, nativeObject, config)\n\n    this._objects.setIn([key], object)\n\n    return object\n  }\n\n  getObject(key: string): SheetObject | undefined {\n    return this._objects.getState()[key]\n  }\n\n  getSequence(): Sequence {\n    if (!this._sequence) {\n      const lengthD = valueDerivation(\n        this.project.pointers.historic.sheetsById[this.address.sheetId].sequence\n          .length,\n      ).map((s) => (typeof s === 'number' ? s : 10))\n\n      const subUnitsPerUnitD = valueDerivation(\n        this.project.pointers.historic.sheetsById[this.address.sheetId].sequence\n          .subUnitsPerUnit,\n      ).map((s) => (typeof s === 'number' ? s : 30))\n\n      this._sequence = new Sequence(\n        this.template.project,\n        this,\n        lengthD,\n        subUnitsPerUnitD,\n      )\n    }\n    return this._sequence\n  }\n}\n","import type {OnDiskState} from '@theatre/core/projects/store/storeTypes'\nimport type TheatreProject from '@theatre/core/projects/TheatreProject'\nimport type Sheet from '@theatre/core/sheets/Sheet'\nimport SheetTemplate from '@theatre/core/sheets/SheetTemplate'\nimport type {Studio} from '@theatre/studio/Studio'\nimport type {ProjectAddress} from '@theatre/shared/utils/addresses'\nimport type {Pointer} from '@theatre/dataverse'\nimport {PointerProxy} from '@theatre/dataverse'\nimport {Atom} from '@theatre/dataverse'\nimport initialiseProjectState from './initialiseProjectState'\nimport projectsSingleton from './projectsSingleton'\nimport type {ProjectState} from './store/storeTypes'\nimport type {Deferred} from '@theatre/shared/utils/defer'\nimport {defer} from '@theatre/shared/utils/defer'\nimport globals from '@theatre/shared/globals'\n\nexport type Conf = Partial<{\n  state: OnDiskState\n}>\n\nexport default class Project {\n  readonly pointers: {\n    historic: Pointer<ProjectState['historic']>\n    ahistoric: Pointer<ProjectState['ahistoric']>\n    ephemeral: Pointer<ProjectState['ephemeral']>\n  }\n\n  private readonly _pointerProxies: {\n    historic: PointerProxy<ProjectState['historic']>\n    ahistoric: PointerProxy<ProjectState['ahistoric']>\n    ephemeral: PointerProxy<ProjectState['ephemeral']>\n  }\n\n  readonly address: ProjectAddress\n\n  private readonly _readyDeferred: Deferred<undefined>\n\n  private _sheetTemplates = new Atom<{\n    [sheetId: string]: SheetTemplate | undefined\n  }>({})\n  sheetTemplatesP = this._sheetTemplates.pointer\n  private _studio: Studio | undefined\n\n  type: 'Theatre_Project' = 'Theatre_Project'\n\n  constructor(\n    id: string,\n    readonly config: Conf = {},\n    readonly publicApi: TheatreProject,\n  ) {\n    this.address = {projectId: id}\n\n    const onDiskStateAtom = new Atom<ProjectState>({\n      ahistoric: {\n        ahistoricStuff: '',\n      },\n      historic: config.state ?? {\n        sheetsById: {},\n        definitionVersion: globals.currentProjectStateDefinitionVersion,\n        revisionHistory: [],\n      },\n      ephemeral: {\n        loadingState: {\n          type: 'loaded',\n        },\n        lastExportedObject: null,\n      },\n    })\n\n    this._pointerProxies = {\n      historic: new PointerProxy(onDiskStateAtom.pointer.historic),\n      ahistoric: new PointerProxy(onDiskStateAtom.pointer.ahistoric),\n      ephemeral: new PointerProxy(onDiskStateAtom.pointer.ephemeral),\n    }\n\n    this.pointers = {\n      historic: this._pointerProxies.historic.pointer,\n      ahistoric: this._pointerProxies.ahistoric.pointer,\n      ephemeral: this._pointerProxies.ephemeral.pointer,\n    }\n\n    projectsSingleton.add(id, this)\n\n    this._readyDeferred = defer()\n\n    if (config.state) {\n      setTimeout(() => {\n        // The user has provided config.state but in case @theatre/studio is loaded,\n        // let's give it one tick to attach itself\n        if (!this._studio) {\n          this._readyDeferred.resolve(undefined)\n        }\n      }, 0)\n    } else {\n      setTimeout(() => {\n        if (!this._studio) {\n          throw new Error(\n            `Argument config.state in Theatre.getProject(\"${id}\", config) is empty. This is fine ` +\n              `while you are using @theatre/core along with @theatre/sutdio. But since @theatre/studio ` +\n              `is not loaded, the state of project \"${id}\" will be empty.\\n\\n` +\n              `To fix this, you need to add @theatre/studio into the bundle and export ` +\n              `the projet's state. Learn how to do that at https://docs.theatrejs.com/in-depth/#exporting`,\n          )\n        }\n      }, 1000)\n    }\n  }\n\n  attachToStudio(studio: Studio) {\n    if (this._studio) {\n      if (this._studio !== studio) {\n        throw new Error(\n          `Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`,\n        )\n      } else {\n        console.warn(\n          `Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`,\n        )\n        return\n      }\n    }\n    this._studio = studio\n\n    studio.initialized.then(async () => {\n      await initialiseProjectState(studio, this, this.config.state)\n\n      this._pointerProxies.historic.setPointer(\n        studio.atomP.historic.coreByProject[this.address.projectId],\n      )\n      this._pointerProxies.ahistoric.setPointer(\n        studio.atomP.ahistoric.coreByProject[this.address.projectId],\n      )\n      this._pointerProxies.ephemeral.setPointer(\n        studio.atomP.ephemeral.coreByProject[this.address.projectId],\n      )\n\n      this._readyDeferred.resolve(undefined)\n    })\n  }\n\n  get isAttachedToStudio() {\n    return !!this._studio\n  }\n\n  get ready() {\n    return this._readyDeferred.promise\n  }\n\n  isReady() {\n    return this._readyDeferred.status === 'resolved'\n  }\n\n  getOrCreateSheet(sheetId: string, instanceId: string = 'default'): Sheet {\n    let template = this._sheetTemplates.getState()[sheetId]\n\n    if (!template) {\n      template = new SheetTemplate(this, sheetId)\n      this._sheetTemplates.setIn([sheetId], template)\n    }\n\n    return template.getInstance(instanceId)\n  }\n}\n","const delay = (dur: number) =>\n  new Promise((resolve) => setTimeout(resolve, dur))\n\nexport default delay\n","const errors = {\n\t0: \"Illegal state\",\n\t1: \"Immer drafts cannot have computed properties\",\n\t2: \"This object has been frozen and should not be mutated\",\n\t3(data: any) {\n\t\treturn (\n\t\t\t\"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" +\n\t\t\tdata\n\t\t)\n\t},\n\t4: \"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",\n\t5: \"Immer forbids circular references\",\n\t6: \"The first or second argument to `produce` must be a function\",\n\t7: \"The third argument to `produce` must be a function or undefined\",\n\t8: \"First argument to `createDraft` must be a plain object, an array, or an immerable object\",\n\t9: \"First argument to `finishDraft` must be a draft returned by `createDraft`\",\n\t10: \"The given draft is already finalized\",\n\t11: \"Object.defineProperty() cannot be used on an Immer draft\",\n\t12: \"Object.setPrototypeOf() cannot be used on an Immer draft\",\n\t13: \"Immer only supports deleting array indices\",\n\t14: \"Immer only supports setting array indices and the 'length' property\",\n\t15(path: string) {\n\t\treturn \"Cannot apply patch, path doesn't resolve: \" + path\n\t},\n\t16: 'Sets cannot have \"replace\" patches.',\n\t17(op: string) {\n\t\treturn \"Unsupported patch operation: \" + op\n\t},\n\t18(plugin: string) {\n\t\treturn `The plugin for '${plugin}' has not been loaded into Immer. To enable the plugin, import and call \\`enable${plugin}()\\` when initializing your application.`\n\t},\n\t20: \"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available\",\n\t21(thing: string) {\n\t\treturn `produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${thing}'`\n\t},\n\t22(thing: string) {\n\t\treturn `'current' expects a draft, got: ${thing}`\n\t},\n\t23(thing: string) {\n\t\treturn `'original' expects a draft, got: ${thing}`\n\t},\n\t24: \"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n} as const\n\nexport function die(error: keyof typeof errors, ...args: any[]): never {\n\tif (__DEV__) {\n\t\tconst e = errors[error]\n\t\tconst msg = !e\n\t\t\t? \"unknown error nr: \" + error\n\t\t\t: typeof e === \"function\"\n\t\t\t? e.apply(null, args as any)\n\t\t\t: e\n\t\tthrow new Error(`[Immer] ${msg}`)\n\t}\n\tthrow new Error(\n\t\t`[Immer] minified error nr: ${error}${\n\t\t\targs.length ? \" \" + args.map(s => `'${s}'`).join(\",\") : \"\"\n\t\t}. Find the full error at: https://bit.ly/3cXEKWf`\n\t)\n}\n","import {\n\tDRAFT_STATE,\n\tDRAFTABLE,\n\thasSet,\n\tObjectish,\n\tDrafted,\n\tAnyObject,\n\tAnyMap,\n\tAnySet,\n\tImmerState,\n\thasMap,\n\tArchtype,\n\tdie\n} from \"../internal\"\n\n/** Returns true if the given value is an Immer draft */\n/*#__PURE__*/\nexport function isDraft(value: any): boolean {\n\treturn !!value && !!value[DRAFT_STATE]\n}\n\n/** Returns true if the given value can be drafted by Immer */\n/*#__PURE__*/\nexport function isDraftable(value: any): boolean {\n\tif (!value) return false\n\treturn (\n\t\tisPlainObject(value) ||\n\t\tArray.isArray(value) ||\n\t\t!!value[DRAFTABLE] ||\n\t\t!!value.constructor[DRAFTABLE] ||\n\t\tisMap(value) ||\n\t\tisSet(value)\n\t)\n}\n\nconst objectCtorString = Object.prototype.constructor.toString()\n/*#__PURE__*/\nexport function isPlainObject(value: any): boolean {\n\tif (!value || typeof value !== \"object\") return false\n\tconst proto = Object.getPrototypeOf(value)\n\tif (proto === null) {\n\t\treturn true\n\t}\n\tconst Ctor =\n\t\tObject.hasOwnProperty.call(proto, \"constructor\") && proto.constructor\n\n\tif (Ctor === Object) return true\n\n\treturn (\n\t\ttypeof Ctor == \"function\" &&\n\t\tFunction.toString.call(Ctor) === objectCtorString\n\t)\n}\n\n/** Get the underlying object that is represented by the given draft */\n/*#__PURE__*/\nexport function original<T>(value: T): T | undefined\nexport function original(value: Drafted<any>): any {\n\tif (!isDraft(value)) die(23, value)\n\treturn value[DRAFT_STATE].base_\n}\n\n/*#__PURE__*/\nexport const ownKeys: (target: AnyObject) => PropertyKey[] =\n\ttypeof Reflect !== \"undefined\" && Reflect.ownKeys\n\t\t? Reflect.ownKeys\n\t\t: typeof Object.getOwnPropertySymbols !== \"undefined\"\n\t\t? obj =>\n\t\t\t\tObject.getOwnPropertyNames(obj).concat(\n\t\t\t\t\tObject.getOwnPropertySymbols(obj) as any\n\t\t\t\t)\n\t\t: /* istanbul ignore next */ Object.getOwnPropertyNames\n\nexport const getOwnPropertyDescriptors =\n\tObject.getOwnPropertyDescriptors ||\n\tfunction getOwnPropertyDescriptors(target: any) {\n\t\t// Polyfill needed for Hermes and IE, see https://github.com/facebook/hermes/issues/274\n\t\tconst res: any = {}\n\t\townKeys(target).forEach(key => {\n\t\t\tres[key] = Object.getOwnPropertyDescriptor(target, key)\n\t\t})\n\t\treturn res\n\t}\n\nexport function each<T extends Objectish>(\n\tobj: T,\n\titer: (key: string | number, value: any, source: T) => void,\n\tenumerableOnly?: boolean\n): void\nexport function each(obj: any, iter: any, enumerableOnly = false) {\n\tif (getArchtype(obj) === Archtype.Object) {\n\t\t;(enumerableOnly ? Object.keys : ownKeys)(obj).forEach(key => {\n\t\t\tif (!enumerableOnly || typeof key !== \"symbol\") iter(key, obj[key], obj)\n\t\t})\n\t} else {\n\t\tobj.forEach((entry: any, index: any) => iter(index, entry, obj))\n\t}\n}\n\n/*#__PURE__*/\nexport function getArchtype(thing: any): Archtype {\n\t/* istanbul ignore next */\n\tconst state: undefined | ImmerState = thing[DRAFT_STATE]\n\treturn state\n\t\t? state.type_ > 3\n\t\t\t? state.type_ - 4 // cause Object and Array map back from 4 and 5\n\t\t\t: (state.type_ as any) // others are the same\n\t\t: Array.isArray(thing)\n\t\t? Archtype.Array\n\t\t: isMap(thing)\n\t\t? Archtype.Map\n\t\t: isSet(thing)\n\t\t? Archtype.Set\n\t\t: Archtype.Object\n}\n\n/*#__PURE__*/\nexport function has(thing: any, prop: PropertyKey): boolean {\n\treturn getArchtype(thing) === Archtype.Map\n\t\t? thing.has(prop)\n\t\t: Object.prototype.hasOwnProperty.call(thing, prop)\n}\n\n/*#__PURE__*/\nexport function get(thing: AnyMap | AnyObject, prop: PropertyKey): any {\n\t// @ts-ignore\n\treturn getArchtype(thing) === Archtype.Map ? thing.get(prop) : thing[prop]\n}\n\n/*#__PURE__*/\nexport function set(thing: any, propOrOldValue: PropertyKey, value: any) {\n\tconst t = getArchtype(thing)\n\tif (t === Archtype.Map) thing.set(propOrOldValue, value)\n\telse if (t === Archtype.Set) {\n\t\tthing.delete(propOrOldValue)\n\t\tthing.add(value)\n\t} else thing[propOrOldValue] = value\n}\n\n/*#__PURE__*/\nexport function is(x: any, y: any): boolean {\n\t// From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n\tif (x === y) {\n\t\treturn x !== 0 || 1 / x === 1 / y\n\t} else {\n\t\treturn x !== x && y !== y\n\t}\n}\n\n/*#__PURE__*/\nexport function isMap(target: any): target is AnyMap {\n\treturn hasMap && target instanceof Map\n}\n\n/*#__PURE__*/\nexport function isSet(target: any): target is AnySet {\n\treturn hasSet && target instanceof Set\n}\n/*#__PURE__*/\nexport function latest(state: ImmerState): any {\n\treturn state.copy_ || state.base_\n}\n\n/*#__PURE__*/\nexport function shallowCopy(base: any) {\n\tif (Array.isArray(base)) return Array.prototype.slice.call(base)\n\tconst descriptors = getOwnPropertyDescriptors(base)\n\tdelete descriptors[DRAFT_STATE as any]\n\tlet keys = ownKeys(descriptors)\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tconst key: any = keys[i]\n\t\tconst desc = descriptors[key]\n\t\tif (desc.writable === false) {\n\t\t\tdesc.writable = true\n\t\t\tdesc.configurable = true\n\t\t}\n\t\t// like object.assign, we will read any _own_, get/set accessors. This helps in dealing\n\t\t// with libraries that trap values, like mobx or vue\n\t\t// unlike object.assign, non-enumerables will be copied as well\n\t\tif (desc.get || desc.set)\n\t\t\tdescriptors[key] = {\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true, // could live with !!desc.set as well here...\n\t\t\t\tenumerable: desc.enumerable,\n\t\t\t\tvalue: base[key]\n\t\t\t}\n\t}\n\treturn Object.create(Object.getPrototypeOf(base), descriptors)\n}\n\n/**\n * Freezes draftable objects. Returns the original object.\n * By default freezes shallowly, but if the second argument is `true` it will freeze recursively.\n *\n * @param obj\n * @param deep\n */\nexport function freeze<T>(obj: T, deep?: boolean): T\nexport function freeze<T>(obj: any, deep: boolean = false): T {\n\tif (isFrozen(obj) || isDraft(obj) || !isDraftable(obj)) return obj\n\tif (getArchtype(obj) > 1 /* Map or Set */) {\n\t\tobj.set = obj.add = obj.clear = obj.delete = dontMutateFrozenCollections as any\n\t}\n\tObject.freeze(obj)\n\tif (deep) each(obj, (key, value) => freeze(value, true), true)\n\treturn obj\n}\n\nfunction dontMutateFrozenCollections() {\n\tdie(2)\n}\n\nexport function isFrozen(obj: any): boolean {\n\tif (obj == null || typeof obj !== \"object\") return true\n\t// See #600, IE dies on non-objects in Object.isFrozen\n\treturn Object.isFrozen(obj)\n}\n","import {\n\tImmerState,\n\tPatch,\n\tImmerScope,\n\tDrafted,\n\tAnyObject,\n\tImmerBaseState,\n\tAnyMap,\n\tAnySet,\n\tProxyType,\n\tdie\n} from \"../internal\"\n\n/** Plugin utilities */\nconst plugins: {\n\tPatches?: {\n\t\tgeneratePatches_(\n\t\t\tstate: ImmerState,\n\t\t\tbasePath: PatchPath,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tgenerateReplacementPatches_(\n\t\t\trootState: ImmerState,\n\t\t\treplacement: any,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tapplyPatches_<T>(draft: T, patches: Patch[]): T\n\t}\n\tES5?: {\n\t\twillFinalizeES5_(scope: ImmerScope, result: any, isReplaced: boolean): void\n\t\tcreateES5Proxy_<T>(\n\t\t\tbase: T,\n\t\t\tparent?: ImmerState\n\t\t): Drafted<T, ES5ObjectState | ES5ArrayState>\n\t\thasChanges_(state: ES5ArrayState | ES5ObjectState): boolean\n\t}\n\tMapSet?: {\n\t\tproxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T\n\t\tproxySet_<T extends AnySet>(target: T, parent?: ImmerState): T\n\t}\n} = {}\n\ntype Plugins = typeof plugins\n\nexport function getPlugin<K extends keyof Plugins>(\n\tpluginKey: K\n): Exclude<Plugins[K], undefined> {\n\tconst plugin = plugins[pluginKey]\n\tif (!plugin) {\n\t\tdie(18, pluginKey)\n\t}\n\t// @ts-ignore\n\treturn plugin\n}\n\nexport function loadPlugin<K extends keyof Plugins>(\n\tpluginKey: K,\n\timplementation: Plugins[K]\n): void {\n\tif (!plugins[pluginKey]) plugins[pluginKey] = implementation\n}\n\n/** ES5 Plugin */\n\ninterface ES5BaseState extends ImmerBaseState {\n\tassigned_: {[key: string]: any}\n\tparent_?: ImmerState\n\trevoked_: boolean\n}\n\nexport interface ES5ObjectState extends ES5BaseState {\n\ttype_: ProxyType.ES5Object\n\tdraft_: Drafted<AnyObject, ES5ObjectState>\n\tbase_: AnyObject\n\tcopy_: AnyObject | null\n}\n\nexport interface ES5ArrayState extends ES5BaseState {\n\ttype_: ProxyType.ES5Array\n\tdraft_: Drafted<AnyObject, ES5ArrayState>\n\tbase_: any\n\tcopy_: any\n}\n\n/** Map / Set plugin */\n\nexport interface MapState extends ImmerBaseState {\n\ttype_: ProxyType.Map\n\tcopy_: AnyMap | undefined\n\tassigned_: Map<any, boolean> | undefined\n\tbase_: AnyMap\n\trevoked_: boolean\n\tdraft_: Drafted<AnyMap, MapState>\n}\n\nexport interface SetState extends ImmerBaseState {\n\ttype_: ProxyType.Set\n\tcopy_: AnySet | undefined\n\tbase_: AnySet\n\tdrafts_: Map<any, Drafted> // maps the original value to the draft value in the new set\n\trevoked_: boolean\n\tdraft_: Drafted<AnySet, SetState>\n}\n\n/** Patches plugin */\n\nexport type PatchPath = (string | number)[]\n","import {\n\tImmerScope,\n\tDRAFT_STATE,\n\tisDraftable,\n\tNOTHING,\n\tPatchPath,\n\teach,\n\thas,\n\tfreeze,\n\tImmerState,\n\tisDraft,\n\tSetState,\n\tset,\n\tProxyType,\n\tgetPlugin,\n\tdie,\n\trevokeScope,\n\tisFrozen,\n\tshallowCopy\n} from \"../internal\"\n\nexport function processResult(result: any, scope: ImmerScope) {\n\tscope.unfinalizedDrafts_ = scope.drafts_.length\n\tconst baseDraft = scope.drafts_![0]\n\tconst isReplaced = result !== undefined && result !== baseDraft\n\tif (!scope.immer_.useProxies_)\n\t\tgetPlugin(\"ES5\").willFinalizeES5_(scope, result, isReplaced)\n\tif (isReplaced) {\n\t\tif (baseDraft[DRAFT_STATE].modified_) {\n\t\t\trevokeScope(scope)\n\t\t\tdie(4)\n\t\t}\n\t\tif (isDraftable(result)) {\n\t\t\t// Finalize the result in case it contains (or is) a subset of the draft.\n\t\t\tresult = finalize(scope, result)\n\t\t\tif (!scope.parent_) maybeFreeze(scope, result)\n\t\t}\n\t\tif (scope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(\n\t\t\t\tbaseDraft[DRAFT_STATE],\n\t\t\t\tresult,\n\t\t\t\tscope.patches_,\n\t\t\t\tscope.inversePatches_!\n\t\t\t)\n\t\t}\n\t} else {\n\t\t// Finalize the base draft.\n\t\tresult = finalize(scope, baseDraft, [])\n\t}\n\trevokeScope(scope)\n\tif (scope.patches_) {\n\t\tscope.patchListener_!(scope.patches_, scope.inversePatches_!)\n\t}\n\treturn result !== NOTHING ? result : undefined\n}\n\nfunction finalize(rootScope: ImmerScope, value: any, path?: PatchPath) {\n\t// Don't recurse in tho recursive data structures\n\tif (isFrozen(value)) return value\n\n\tconst state: ImmerState = value[DRAFT_STATE]\n\t// A plain object, might need freezing, might contain drafts\n\tif (!state) {\n\t\teach(\n\t\t\tvalue,\n\t\t\t(key, childValue) =>\n\t\t\t\tfinalizeProperty(rootScope, state, value, key, childValue, path),\n\t\t\ttrue // See #590, don't recurse into non-enumarable of non drafted objects\n\t\t)\n\t\treturn value\n\t}\n\t// Never finalize drafts owned by another scope.\n\tif (state.scope_ !== rootScope) return value\n\t// Unmodified draft, return the (frozen) original\n\tif (!state.modified_) {\n\t\tmaybeFreeze(rootScope, state.base_, true)\n\t\treturn state.base_\n\t}\n\t// Not finalized yet, let's do that now\n\tif (!state.finalized_) {\n\t\tstate.finalized_ = true\n\t\tstate.scope_.unfinalizedDrafts_--\n\t\tconst result =\n\t\t\t// For ES5, create a good copy from the draft first, with added keys and without deleted keys.\n\t\t\tstate.type_ === ProxyType.ES5Object || state.type_ === ProxyType.ES5Array\n\t\t\t\t? (state.copy_ = shallowCopy(state.draft_))\n\t\t\t\t: state.copy_\n\t\t// Finalize all children of the copy\n\t\t// For sets we clone before iterating, otherwise we can get in endless loop due to modifying during iteration, see #628\n\t\t// Although the original test case doesn't seem valid anyway, so if this in the way we can turn the next line\n\t\t// back to each(result, ....)\n\t\teach(\n\t\t\tstate.type_ === ProxyType.Set ? new Set(result) : result,\n\t\t\t(key, childValue) =>\n\t\t\t\tfinalizeProperty(rootScope, state, result, key, childValue, path)\n\t\t)\n\t\t// everything inside is frozen, we can freeze here\n\t\tmaybeFreeze(rootScope, result, false)\n\t\t// first time finalizing, let's create those patches\n\t\tif (path && rootScope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generatePatches_(\n\t\t\t\tstate,\n\t\t\t\tpath,\n\t\t\t\trootScope.patches_,\n\t\t\t\trootScope.inversePatches_!\n\t\t\t)\n\t\t}\n\t}\n\treturn state.copy_\n}\n\nfunction finalizeProperty(\n\trootScope: ImmerScope,\n\tparentState: undefined | ImmerState,\n\ttargetObject: any,\n\tprop: string | number,\n\tchildValue: any,\n\trootPath?: PatchPath\n) {\n\tif (__DEV__ && childValue === targetObject) die(5)\n\tif (isDraft(childValue)) {\n\t\tconst path =\n\t\t\trootPath &&\n\t\t\tparentState &&\n\t\t\tparentState!.type_ !== ProxyType.Set && // Set objects are atomic since they have no keys.\n\t\t\t!has((parentState as Exclude<ImmerState, SetState>).assigned_!, prop) // Skip deep patches for assigned keys.\n\t\t\t\t? rootPath!.concat(prop)\n\t\t\t\t: undefined\n\t\t// Drafts owned by `scope` are finalized here.\n\t\tconst res = finalize(rootScope, childValue, path)\n\t\tset(targetObject, prop, res)\n\t\t// Drafts from another scope must prevented to be frozen\n\t\t// if we got a draft back from finalize, we're in a nested produce and shouldn't freeze\n\t\tif (isDraft(res)) {\n\t\t\trootScope.canAutoFreeze_ = false\n\t\t} else return\n\t}\n\t// Search new objects for unfinalized drafts. Frozen objects should never contain drafts.\n\tif (isDraftable(childValue) && !isFrozen(childValue)) {\n\t\tif (!rootScope.immer_.autoFreeze_ && rootScope.unfinalizedDrafts_ < 1) {\n\t\t\t// optimization: if an object is not a draft, and we don't have to\n\t\t\t// deepfreeze everything, and we are sure that no drafts are left in the remaining object\n\t\t\t// cause we saw and finalized all drafts already; we can stop visiting the rest of the tree.\n\t\t\t// This benefits especially adding large data tree's without further processing.\n\t\t\t// See add-data.js perf test\n\t\t\treturn\n\t\t}\n\t\tfinalize(rootScope, childValue)\n\t\t// immer deep freezes plain objects, so if there is no parent state, we freeze as well\n\t\tif (!parentState || !parentState.scope_.parent_)\n\t\t\tmaybeFreeze(rootScope, childValue)\n\t}\n}\n\nfunction maybeFreeze(scope: ImmerScope, value: any, deep = false) {\n\tif (scope.immer_.autoFreeze_ && scope.canAutoFreeze_) {\n\t\tfreeze(value, deep)\n\t}\n}\n","import {\n\teach,\n\thas,\n\tis,\n\tisDraftable,\n\tshallowCopy,\n\tlatest,\n\tImmerBaseState,\n\tImmerState,\n\tDrafted,\n\tAnyObject,\n\tAnyArray,\n\tObjectish,\n\tgetCurrentScope,\n\tDRAFT_STATE,\n\tdie,\n\tcreateProxy,\n\tProxyType\n} from \"../internal\"\n\ninterface ProxyBaseState extends ImmerBaseState {\n\tassigned_: {\n\t\t[property: string]: boolean\n\t}\n\tparent_?: ImmerState\n\trevoke_(): void\n}\n\nexport interface ProxyObjectState extends ProxyBaseState {\n\ttype_: ProxyType.ProxyObject\n\tbase_: any\n\tcopy_: any\n\tdraft_: Drafted<AnyObject, ProxyObjectState>\n}\n\nexport interface ProxyArrayState extends ProxyBaseState {\n\ttype_: ProxyType.ProxyArray\n\tbase_: AnyArray\n\tcopy_: AnyArray | null\n\tdraft_: Drafted<AnyArray, ProxyArrayState>\n}\n\ntype ProxyState = ProxyObjectState | ProxyArrayState\n\n/**\n * Returns a new draft of the `base` object.\n *\n * The second argument is the parent draft-state (used internally).\n */\nexport function createProxyProxy<T extends Objectish>(\n\tbase: T,\n\tparent?: ImmerState\n): Drafted<T, ProxyState> {\n\tconst isArray = Array.isArray(base)\n\tconst state: ProxyState = {\n\t\ttype_: isArray ? ProxyType.ProxyArray : (ProxyType.ProxyObject as any),\n\t\t// Track which produce call this is associated with.\n\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t// True for both shallow and deep changes.\n\t\tmodified_: false,\n\t\t// Used during finalization.\n\t\tfinalized_: false,\n\t\t// Track which properties have been assigned (true) or deleted (false).\n\t\tassigned_: {},\n\t\t// The parent draft state.\n\t\tparent_: parent,\n\t\t// The base state.\n\t\tbase_: base,\n\t\t// The base proxy.\n\t\tdraft_: null as any, // set below\n\t\t// The base copy with any updated values.\n\t\tcopy_: null,\n\t\t// Called by the `produce` function.\n\t\trevoke_: null as any,\n\t\tisManual_: false\n\t}\n\n\t// the traps must target something, a bit like the 'real' base.\n\t// but also, we need to be able to determine from the target what the relevant state is\n\t// (to avoid creating traps per instance to capture the state in closure,\n\t// and to avoid creating weird hidden properties as well)\n\t// So the trick is to use 'state' as the actual 'target'! (and make sure we intercept everything)\n\t// Note that in the case of an array, we put the state in an array to have better Reflect defaults ootb\n\tlet target: T = state as any\n\tlet traps: ProxyHandler<object | Array<any>> = objectTraps\n\tif (isArray) {\n\t\ttarget = [state] as any\n\t\ttraps = arrayTraps\n\t}\n\n\tconst {revoke, proxy} = Proxy.revocable(target, traps)\n\tstate.draft_ = proxy as any\n\tstate.revoke_ = revoke\n\treturn proxy as any\n}\n\n/**\n * Object drafts\n */\nexport const objectTraps: ProxyHandler<ProxyState> = {\n\tget(state, prop) {\n\t\tif (prop === DRAFT_STATE) return state\n\n\t\tconst source = latest(state)\n\t\tif (!has(source, prop)) {\n\t\t\t// non-existing or non-own property...\n\t\t\treturn readPropFromProto(state, source, prop)\n\t\t}\n\t\tconst value = source[prop]\n\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\treturn value\n\t\t}\n\t\t// Check for existing draft in modified state.\n\t\t// Assigned values are never drafted. This catches any drafts we created, too.\n\t\tif (value === peek(state.base_, prop)) {\n\t\t\tprepareCopy(state)\n\t\t\treturn (state.copy_![prop as any] = createProxy(\n\t\t\t\tstate.scope_.immer_,\n\t\t\t\tvalue,\n\t\t\t\tstate\n\t\t\t))\n\t\t}\n\t\treturn value\n\t},\n\thas(state, prop) {\n\t\treturn prop in latest(state)\n\t},\n\townKeys(state) {\n\t\treturn Reflect.ownKeys(latest(state))\n\t},\n\tset(\n\t\tstate: ProxyObjectState,\n\t\tprop: string /* strictly not, but helps TS */,\n\t\tvalue\n\t) {\n\t\tconst desc = getDescriptorFromProto(latest(state), prop)\n\t\tif (desc?.set) {\n\t\t\t// special case: if this write is captured by a setter, we have\n\t\t\t// to trigger it with the correct context\n\t\t\tdesc.set.call(state.draft_, value)\n\t\t\treturn true\n\t\t}\n\t\tif (!state.modified_) {\n\t\t\t// the last check is because we need to be able to distinguish setting a non-existing to undefined (which is a change)\n\t\t\t// from setting an existing property with value undefined to undefined (which is not a change)\n\t\t\tconst current = peek(latest(state), prop)\n\t\t\t// special case, if we assigning the original value to a draft, we can ignore the assignment\n\t\t\tconst currentState: ProxyObjectState = current?.[DRAFT_STATE]\n\t\t\tif (currentState && currentState.base_ === value) {\n\t\t\t\tstate.copy_![prop] = value\n\t\t\t\tstate.assigned_[prop] = false\n\t\t\t\treturn true\n\t\t\t}\n\t\t\tif (is(value, current) && (value !== undefined || has(state.base_, prop)))\n\t\t\t\treturn true\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t}\n\n\t\tif (\n\t\t\tstate.copy_![prop] === value &&\n\t\t\t// special case: NaN\n\t\t\ttypeof value !== \"number\" &&\n\t\t\t// special case: handle new props with value 'undefined'\n\t\t\t(value !== undefined || prop in state.copy_)\n\t\t)\n\t\t\treturn true\n\n\t\t// @ts-ignore\n\t\tstate.copy_![prop] = value\n\t\tstate.assigned_[prop] = true\n\t\treturn true\n\t},\n\tdeleteProperty(state, prop: string) {\n\t\t// The `undefined` check is a fast path for pre-existing keys.\n\t\tif (peek(state.base_, prop) !== undefined || prop in state.base_) {\n\t\t\tstate.assigned_[prop] = false\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t} else {\n\t\t\t// if an originally not assigned property was deleted\n\t\t\tdelete state.assigned_[prop]\n\t\t}\n\t\t// @ts-ignore\n\t\tif (state.copy_) delete state.copy_[prop]\n\t\treturn true\n\t},\n\t// Note: We never coerce `desc.value` into an Immer draft, because we can't make\n\t// the same guarantee in ES5 mode.\n\tgetOwnPropertyDescriptor(state, prop) {\n\t\tconst owner = latest(state)\n\t\tconst desc = Reflect.getOwnPropertyDescriptor(owner, prop)\n\t\tif (!desc) return desc\n\t\treturn {\n\t\t\twritable: true,\n\t\t\tconfigurable: state.type_ !== ProxyType.ProxyArray || prop !== \"length\",\n\t\t\tenumerable: desc.enumerable,\n\t\t\tvalue: owner[prop]\n\t\t}\n\t},\n\tdefineProperty() {\n\t\tdie(11)\n\t},\n\tgetPrototypeOf(state) {\n\t\treturn Object.getPrototypeOf(state.base_)\n\t},\n\tsetPrototypeOf() {\n\t\tdie(12)\n\t}\n}\n\n/**\n * Array drafts\n */\n\nconst arrayTraps: ProxyHandler<[ProxyArrayState]> = {}\neach(objectTraps, (key, fn) => {\n\t// @ts-ignore\n\tarrayTraps[key] = function() {\n\t\targuments[0] = arguments[0][0]\n\t\treturn fn.apply(this, arguments)\n\t}\n})\narrayTraps.deleteProperty = function(state, prop) {\n\tif (__DEV__ && isNaN(parseInt(prop as any))) die(13)\n\treturn objectTraps.deleteProperty!.call(this, state[0], prop)\n}\narrayTraps.set = function(state, prop, value) {\n\tif (__DEV__ && prop !== \"length\" && isNaN(parseInt(prop as any))) die(14)\n\treturn objectTraps.set!.call(this, state[0], prop, value, state[0])\n}\n\n// Access a property without creating an Immer draft.\nfunction peek(draft: Drafted, prop: PropertyKey) {\n\tconst state = draft[DRAFT_STATE]\n\tconst source = state ? latest(state) : draft\n\treturn source[prop]\n}\n\nfunction readPropFromProto(state: ImmerState, source: any, prop: PropertyKey) {\n\tconst desc = getDescriptorFromProto(source, prop)\n\treturn desc\n\t\t? `value` in desc\n\t\t\t? desc.value\n\t\t\t: // This is a very special case, if the prop is a getter defined by the\n\t\t\t  // prototype, we should invoke it with the draft as context!\n\t\t\t  desc.get?.call(state.draft_)\n\t\t: undefined\n}\n\nfunction getDescriptorFromProto(\n\tsource: any,\n\tprop: PropertyKey\n): PropertyDescriptor | undefined {\n\t// 'in' checks proto!\n\tif (!(prop in source)) return undefined\n\tlet proto = Object.getPrototypeOf(source)\n\twhile (proto) {\n\t\tconst desc = Object.getOwnPropertyDescriptor(proto, prop)\n\t\tif (desc) return desc\n\t\tproto = Object.getPrototypeOf(proto)\n\t}\n\treturn undefined\n}\n\nexport function markChanged(state: ImmerState) {\n\tif (!state.modified_) {\n\t\tstate.modified_ = true\n\t\tif (state.parent_) {\n\t\t\tmarkChanged(state.parent_)\n\t\t}\n\t}\n}\n\nexport function prepareCopy(state: {base_: any; copy_: any}) {\n\tif (!state.copy_) {\n\t\tstate.copy_ = shallowCopy(state.base_)\n\t}\n}\n","import {\n\tIProduceWithPatches,\n\tIProduce,\n\tImmerState,\n\tDrafted,\n\tisDraftable,\n\tprocessResult,\n\tPatch,\n\tObjectish,\n\tDRAFT_STATE,\n\tDraft,\n\tPatchListener,\n\tisDraft,\n\tisMap,\n\tisSet,\n\tcreateProxyProxy,\n\tgetPlugin,\n\tdie,\n\thasProxies,\n\tenterScope,\n\trevokeScope,\n\tleaveScope,\n\tusePatchesInScope,\n\tgetCurrentScope,\n\tNOTHING,\n\tfreeze,\n\tcurrent\n} from \"../internal\"\n\ninterface ProducersFns {\n\tproduce: IProduce\n\tproduceWithPatches: IProduceWithPatches\n}\n\nexport class Immer implements ProducersFns {\n\tuseProxies_: boolean = hasProxies\n\n\tautoFreeze_: boolean = true\n\n\tconstructor(config?: {useProxies?: boolean; autoFreeze?: boolean}) {\n\t\tif (typeof config?.useProxies === \"boolean\")\n\t\t\tthis.setUseProxies(config!.useProxies)\n\t\tif (typeof config?.autoFreeze === \"boolean\")\n\t\t\tthis.setAutoFreeze(config!.autoFreeze)\n\t}\n\n\t/**\n\t * The `produce` function takes a value and a \"recipe function\" (whose\n\t * return value often depends on the base state). The recipe function is\n\t * free to mutate its first argument however it wants. All mutations are\n\t * only ever applied to a __copy__ of the base state.\n\t *\n\t * Pass only a function to create a \"curried producer\" which relieves you\n\t * from passing the recipe function every time.\n\t *\n\t * Only plain objects and arrays are made mutable. All other objects are\n\t * considered uncopyable.\n\t *\n\t * Note: This function is __bound__ to its `Immer` instance.\n\t *\n\t * @param {any} base - the initial state\n\t * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n\t * @param {Function} patchListener - optional function that will be called with all the patches produced here\n\t * @returns {any} a new state, or the initial state if nothing was modified\n\t */\n\tproduce: IProduce = (base: any, recipe?: any, patchListener?: any) => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\" && typeof recipe !== \"function\") {\n\t\t\tconst defaultBase = recipe\n\t\t\trecipe = base\n\n\t\t\tconst self = this\n\t\t\treturn function curriedProduce(\n\t\t\t\tthis: any,\n\t\t\t\tbase = defaultBase,\n\t\t\t\t...args: any[]\n\t\t\t) {\n\t\t\t\treturn self.produce(base, (draft: Drafted) => recipe.call(this, draft, ...args)) // prettier-ignore\n\t\t\t}\n\t\t}\n\n\t\tif (typeof recipe !== \"function\") die(6)\n\t\tif (patchListener !== undefined && typeof patchListener !== \"function\")\n\t\t\tdie(7)\n\n\t\tlet result\n\n\t\t// Only plain objects, arrays, and \"immerable classes\" are drafted.\n\t\tif (isDraftable(base)) {\n\t\t\tconst scope = enterScope(this)\n\t\t\tconst proxy = createProxy(this, base, undefined)\n\t\t\tlet hasError = true\n\t\t\ttry {\n\t\t\t\tresult = recipe(proxy)\n\t\t\t\thasError = false\n\t\t\t} finally {\n\t\t\t\t// finally instead of catch + rethrow better preserves original stack\n\t\t\t\tif (hasError) revokeScope(scope)\n\t\t\t\telse leaveScope(scope)\n\t\t\t}\n\t\t\tif (typeof Promise !== \"undefined\" && result instanceof Promise) {\n\t\t\t\treturn result.then(\n\t\t\t\t\tresult => {\n\t\t\t\t\t\tusePatchesInScope(scope, patchListener)\n\t\t\t\t\t\treturn processResult(result, scope)\n\t\t\t\t\t},\n\t\t\t\t\terror => {\n\t\t\t\t\t\trevokeScope(scope)\n\t\t\t\t\t\tthrow error\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\tusePatchesInScope(scope, patchListener)\n\t\t\treturn processResult(result, scope)\n\t\t} else if (!base || typeof base !== \"object\") {\n\t\t\tresult = recipe(base)\n\t\t\tif (result === NOTHING) return undefined\n\t\t\tif (result === undefined) result = base\n\t\t\tif (this.autoFreeze_) freeze(result, true)\n\t\t\treturn result\n\t\t} else die(21, base)\n\t}\n\n\tproduceWithPatches: IProduceWithPatches = (\n\t\targ1: any,\n\t\targ2?: any,\n\t\targ3?: any\n\t): any => {\n\t\tif (typeof arg1 === \"function\") {\n\t\t\treturn (state: any, ...args: any[]) =>\n\t\t\t\tthis.produceWithPatches(state, (draft: any) => arg1(draft, ...args))\n\t\t}\n\n\t\tlet patches: Patch[], inversePatches: Patch[]\n\t\tconst nextState = this.produce(arg1, arg2, (p: Patch[], ip: Patch[]) => {\n\t\t\tpatches = p\n\t\t\tinversePatches = ip\n\t\t})\n\t\treturn [nextState, patches!, inversePatches!]\n\t}\n\n\tcreateDraft<T extends Objectish>(base: T): Draft<T> {\n\t\tif (!isDraftable(base)) die(8)\n\t\tif (isDraft(base)) base = current(base)\n\t\tconst scope = enterScope(this)\n\t\tconst proxy = createProxy(this, base, undefined)\n\t\tproxy[DRAFT_STATE].isManual_ = true\n\t\tleaveScope(scope)\n\t\treturn proxy as any\n\t}\n\n\tfinishDraft<D extends Draft<any>>(\n\t\tdraft: D,\n\t\tpatchListener?: PatchListener\n\t): D extends Draft<infer T> ? T : never {\n\t\tconst state: ImmerState = draft && (draft as any)[DRAFT_STATE]\n\t\tif (__DEV__) {\n\t\t\tif (!state || !state.isManual_) die(9)\n\t\t\tif (state.finalized_) die(10)\n\t\t}\n\t\tconst {scope_: scope} = state\n\t\tusePatchesInScope(scope, patchListener)\n\t\treturn processResult(undefined, scope)\n\t}\n\n\t/**\n\t * Pass true to automatically freeze all copies created by Immer.\n\t *\n\t * By default, auto-freezing is enabled.\n\t */\n\tsetAutoFreeze(value: boolean) {\n\t\tthis.autoFreeze_ = value\n\t}\n\n\t/**\n\t * Pass true to use the ES2015 `Proxy` class when creating drafts, which is\n\t * always faster than using ES5 proxies.\n\t *\n\t * By default, feature detection is used, so calling this is rarely necessary.\n\t */\n\tsetUseProxies(value: boolean) {\n\t\tif (value && !hasProxies) {\n\t\t\tdie(20)\n\t\t}\n\t\tthis.useProxies_ = value\n\t}\n\n\tapplyPatches<T extends Objectish>(base: T, patches: Patch[]): T {\n\t\t// If a patch replaces the entire state, take that replacement as base\n\t\t// before applying patches\n\t\tlet i: number\n\t\tfor (i = patches.length - 1; i >= 0; i--) {\n\t\t\tconst patch = patches[i]\n\t\t\tif (patch.path.length === 0 && patch.op === \"replace\") {\n\t\t\t\tbase = patch.value\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tconst applyPatchesImpl = getPlugin(\"Patches\").applyPatches_\n\t\tif (isDraft(base)) {\n\t\t\t// N.B: never hits if some patch a replacement, patches are never drafts\n\t\t\treturn applyPatchesImpl(base, patches) as any\n\t\t}\n\t\t// Otherwise, produce a copy of the base state.\n\t\treturn this.produce(base, (draft: Drafted) =>\n\t\t\tapplyPatchesImpl(draft, patches.slice(i + 1))\n\t\t) as any\n\t}\n}\n\nexport function createProxy<T extends Objectish>(\n\timmer: Immer,\n\tvalue: T,\n\tparent?: ImmerState\n): Drafted<T, ImmerState> {\n\t// precondition: createProxy should be guarded by isDraftable, so we know we can safely draft\n\tconst draft: Drafted = isMap(value)\n\t\t? getPlugin(\"MapSet\").proxyMap_(value, parent)\n\t\t: isSet(value)\n\t\t? getPlugin(\"MapSet\").proxySet_(value, parent)\n\t\t: immer.useProxies_\n\t\t? createProxyProxy(value, parent)\n\t\t: getPlugin(\"ES5\").createES5Proxy_(value, parent)\n\n\tconst scope = parent ? parent.scope_ : getCurrentScope()\n\tscope.drafts_.push(draft)\n\treturn draft\n}\n","import {\n\tdie,\n\tisDraft,\n\tshallowCopy,\n\teach,\n\tDRAFT_STATE,\n\tget,\n\tset,\n\tImmerState,\n\tisDraftable,\n\tArchtype,\n\tgetArchtype,\n\tgetPlugin\n} from \"../internal\"\n\n/** Takes a snapshot of the current state of a draft and finalizes it (but without freezing). This is a great utility to print the current state during debugging (no Proxies in the way). The output of current can also be safely leaked outside the producer. */\nexport function current<T>(value: T): T\nexport function current(value: any): any {\n\tif (!isDraft(value)) die(22, value)\n\treturn currentImpl(value)\n}\n\nfunction currentImpl(value: any): any {\n\tif (!isDraftable(value)) return value\n\tconst state: ImmerState | undefined = value[DRAFT_STATE]\n\tlet copy: any\n\tconst archType = getArchtype(value)\n\tif (state) {\n\t\tif (\n\t\t\t!state.modified_ &&\n\t\t\t(state.type_ < 4 || !getPlugin(\"ES5\").hasChanges_(state as any))\n\t\t)\n\t\t\treturn state.base_\n\t\t// Optimization: avoid generating new drafts during copying\n\t\tstate.finalized_ = true\n\t\tcopy = copyHelper(value, archType)\n\t\tstate.finalized_ = false\n\t} else {\n\t\tcopy = copyHelper(value, archType)\n\t}\n\n\teach(copy, (key, childValue) => {\n\t\tif (state && get(state.base_, key) === childValue) return // no need to copy or search in something that didn't change\n\t\tset(copy, key, currentImpl(childValue))\n\t})\n\t// In the future, we might consider freezing here, based on the current settings\n\treturn archType === Archtype.Set ? new Set(copy) : copy\n}\n\nfunction copyHelper(value: any, archType: number): any {\n\t// creates a shallow copy, even if it is a map or set\n\tswitch (archType) {\n\t\tcase Archtype.Map:\n\t\t\treturn new Map(value)\n\t\tcase Archtype.Set:\n\t\t\t// Set will be cloned as array temporarily, so that we can replace individual items\n\t\t\treturn Array.from(value)\n\t}\n\treturn shallowCopy(value)\n}\n","// Should be no imports here!\n\n// Some things that should be evaluated before all else...\n\n// We only want to know if non-polyfilled symbols are available\nconst hasSymbol =\n\ttypeof Symbol !== \"undefined\" && typeof Symbol(\"x\") === \"symbol\"\nexport const hasMap = typeof Map !== \"undefined\"\nexport const hasSet = typeof Set !== \"undefined\"\nexport const hasProxies =\n\ttypeof Proxy !== \"undefined\" &&\n\ttypeof Proxy.revocable !== \"undefined\" &&\n\ttypeof Reflect !== \"undefined\"\n\n/**\n * The sentinel value returned by producers to replace the draft with undefined.\n */\nexport const NOTHING: Nothing = hasSymbol\n\t? Symbol.for(\"immer-nothing\")\n\t: ({[\"immer-nothing\"]: true} as any)\n\n/**\n * To let Immer treat your class instances as plain immutable objects\n * (albeit with a custom prototype), you must define either an instance property\n * or a static property on each of your custom classes.\n *\n * Otherwise, your class instance will never be drafted, which means it won't be\n * safe to mutate in a produce callback.\n */\nexport const DRAFTABLE: unique symbol = hasSymbol\n\t? Symbol.for(\"immer-draftable\")\n\t: (\"__$immer_draftable\" as any)\n\nexport const DRAFT_STATE: unique symbol = hasSymbol\n\t? Symbol.for(\"immer-state\")\n\t: (\"__$immer_state\" as any)\n\n// Even a polyfilled Symbol might provide Symbol.iterator\nexport const iteratorSymbol: typeof Symbol.iterator =\n\t(typeof Symbol != \"undefined\" && Symbol.iterator) || (\"@@iterator\" as any)\n\n/** Use a class type for `nothing` so its type is unique */\nexport class Nothing {\n\t// This lets us do `Exclude<T, Nothing>`\n\t// @ts-ignore\n\tprivate _!: unique symbol\n}\n","const globals = {\n  currentProjectStateDefinitionVersion: '0.4.0',\n}\n\nexport default globals\n","import type {Studio} from '@theatre/studio/Studio'\nimport delay from '@theatre/shared/utils/delay'\nimport {original} from 'immer'\nimport type Project from './Project'\nimport type {OnDiskState} from './store/storeTypes'\nimport globals from '@theatre/shared/globals'\n\n/**\n * @remarks\n * TODO this could be turned into a simple derivation, like:\n * `editor.isReady: IDerivation<{isReady: true} | {isReady: false, reason: 'conflictBetweenDiskStateAndBrowserState'}>`\n */\nexport default async function initialiseProjectState(\n  studio: Studio,\n  project: Project,\n  onDiskState: OnDiskState | undefined,\n) {\n  /*\n   * If in the future we move to IndexedDB to store the state, we'll have\n   * to deal with it being async (as opposed to localStorage that is synchronous.)\n   * so here we're artifically delaying the loading of the state to make sure users\n   * don't count on the state always being already loaded synchronously\n   */\n  await delay(0)\n\n  studio.transaction(({drafts}) => {\n    const projectId = project.address.projectId\n\n    drafts.ephemeral.coreByProject[projectId] = {\n      lastExportedObject: null,\n      loadingState: {type: 'loading'},\n    }\n\n    drafts.ahistoric.coreByProject[projectId] = {\n      ahistoricStuff: '',\n    }\n\n    function useInitialState() {\n      drafts.ephemeral.coreByProject[projectId].loadingState = {\n        type: 'loaded',\n      }\n\n      drafts.historic.coreByProject[projectId] = {\n        sheetsById: {},\n        definitionVersion: globals.currentProjectStateDefinitionVersion,\n        revisionHistory: [],\n      }\n    }\n\n    function useOnDiskState(state: OnDiskState) {\n      drafts.ephemeral.coreByProject[projectId].loadingState = {\n        type: 'loaded',\n      }\n\n      drafts.historic.coreByProject[projectId] = state\n    }\n\n    function useBrowserState() {\n      drafts.ephemeral.coreByProject[projectId].loadingState = {\n        type: 'loaded',\n      }\n    }\n\n    function browserStateIsNotBasedOnDiskState(onDiskState: OnDiskState) {\n      drafts.ephemeral.coreByProject[projectId].loadingState = {\n        type: 'browserStateIsNotBasedOnDiskState',\n        onDiskState,\n      }\n    }\n\n    const browserState = original(drafts.historic)?.coreByProject[\n      project.address.projectId\n    ]\n\n    if (!browserState) {\n      if (!onDiskState) {\n        useInitialState()\n      } else {\n        useOnDiskState(onDiskState)\n      }\n    } else {\n      if (!onDiskState) {\n        useBrowserState()\n      } else {\n        if (\n          browserState.revisionHistory.indexOf(\n            onDiskState.revisionHistory[0],\n          ) == -1\n        ) {\n          browserStateIsNotBasedOnDiskState(onDiskState)\n        } else {\n          useBrowserState()\n        }\n      }\n    }\n  })\n}\n","import userReadableTypeOfValue from '@theatre/shared/utils/userReadableTypeOfValue'\nimport {InvalidArgumentError} from '@theatre/shared/utils/errors'\n\nconst _validateSym = (\n  val: string,\n  thingy: string,\n  range: [min: number, max: number],\n): void | string => {\n  if (typeof val !== 'string') {\n    return `${thingy} must be a string. ${userReadableTypeOfValue(val)} given.`\n  } else if (val.trim().length !== val.length) {\n    return `${thingy} must not have leading or trailing spaces. '${val}' given.`\n  } else if (val.length < range[0] || val.length > range[1]) {\n    return `${thingy} must have between ${range[0]} and ${range[1]} characters. '${val}' given.`\n  }\n}\n\nexport const validateName = (\n  name: string,\n  thingy: string,\n  shouldThrow: boolean = false,\n) => {\n  const result = _validateSym(name, thingy, [3, 32])\n  if (typeof result === 'string' && shouldThrow) {\n    throw new InvalidArgumentError(result)\n  } else {\n    return result\n  }\n}\n\nexport const validateInstanceId = (\n  name: string,\n  thingy: string,\n  shouldThrow: boolean = false,\n) => {\n  const result = _validateSym(name, thingy, [1, 32])\n  if (typeof result === 'string' && shouldThrow) {\n    throw new InvalidArgumentError(result)\n  } else {\n    return result\n  }\n}\n","import {privateAPI, setPrivateAPI} from '@theatre/core/privateAPIs'\nimport Project from '@theatre/core/projects/Project'\nimport type {ISheet} from '@theatre/core/sheets/TheatreSheet'\nimport type {ProjectAddress} from '@theatre/shared/utils/addresses'\nimport {validateInstanceId} from '@theatre/shared/utils/sanitizers'\nimport {validateAndSanitiseSlashedPathOrThrow} from '@theatre/shared/utils/slashedPaths'\nimport type {$IntentionalAny} from '@theatre/shared/utils/types'\n\n/**\n * A project's config object (currently the only point of configuration is the project's state)\n */\nexport type IProjectConfig = {\n  /**\n   * The state of the project, as [exported](https://docs.theatrejs.com/in-depth/#exporting) by the studio.\n   */\n  state?: $IntentionalAny\n}\n\n/**\n * A Theatre project\n */\nexport interface IProject {\n  readonly type: 'Theatre_Project_PublicAPI'\n  /**\n   * If `@theatre/studio` is used, this promise would resolve when studio has loaded\n   * the state of the project into memory.\n   *\n   * If `@theatre/studio` is not used, this promise is already resolved.\n   */\n  readonly ready: Promise<void>\n  /**\n   * Shows whether the project is ready to be used.\n   * Better to use {@link IProject.ready}, which is a promise that would\n   * resolve when the project is ready.\n   */\n  readonly isReady: boolean\n  /**\n   * The project's address\n   */\n  readonly address: ProjectAddress\n\n  /**\n   * Creates a Sheet under the project\n   * @param sheetId - Sheets are identified by their `sheetId`, which must be a string longer than 3 characters\n   * @param instanceId - Optionally provide an `instanceId` if you want to create multiple instances of the same Sheet\n   * @returns The newly created Sheet\n   *\n   * **Docs: https://docs.theatrejs.com/in-depth/#sheets**\n   */\n  sheet(sheetId: string, instanceId?: string): ISheet\n}\n\nexport default class TheatreProject implements IProject {\n  get type(): 'Theatre_Project_PublicAPI' {\n    return 'Theatre_Project_PublicAPI'\n  }\n  /**\n   * @internal\n   */\n  constructor(id: string, config: IProjectConfig = {}) {\n    setPrivateAPI(this, new Project(id, config, this))\n  }\n\n  get ready(): Promise<void> {\n    return privateAPI(this).ready\n  }\n\n  get isReady(): boolean {\n    return privateAPI(this).isReady()\n  }\n\n  get address(): ProjectAddress {\n    return {...privateAPI(this).address}\n  }\n\n  sheet(sheetId: string, instanceId: string = 'default'): ISheet {\n    const sanitizedPath = validateAndSanitiseSlashedPathOrThrow(\n      sheetId,\n      'project.sheet',\n    )\n\n    if (process.env.NODE_ENV !== 'production') {\n      validateInstanceId(\n        instanceId,\n        'instanceId in project.sheet(sheetId, instanceId)',\n        true,\n      )\n    }\n\n    return privateAPI(this).getOrCreateSheet(sanitizedPath, instanceId)\n      .publicApi\n  }\n}\n","/**\n * The names of the global variables that the core or studio bundle\n * use to store their references.\n */\nexport const studioBundle = '__TheatreJS_StudioBundle'\nexport const coreBundle = '__TheatreJS_CoreBundle'\n","import type {Studio} from '@theatre/studio/Studio'\nimport projectsSingleton from './projects/projectsSingleton'\nimport {privateAPI} from './privateAPIs'\nimport * as coreExports from './coreExports'\n\nexport type CoreBits = {\n  projectsP: typeof projectsSingleton.atom.pointer.projects\n  privateAPI: typeof privateAPI\n  coreExports: typeof coreExports\n}\n\nexport default class CoreBundle {\n  private _studio: Studio | undefined = undefined\n  constructor() {}\n\n  get type(): 'Theatre_CoreBundle' {\n    return 'Theatre_CoreBundle'\n  }\n\n  get version() {\n    return process.env.version\n  }\n\n  getBitsForStudio(studio: Studio, callback: (bits: CoreBits) => void) {\n    if (this._studio) {\n      throw new Error(`@theatre/core is already attached to @theatre/studio`)\n    }\n    this._studio = studio\n    const bits: CoreBits = {\n      projectsP: projectsSingleton.atom.pointer.projects,\n      privateAPI: privateAPI,\n      coreExports,\n    }\n\n    callback(bits)\n  }\n}\n","module.exports={sheetsById:{Table:{staticOverrides:{byObject:{Box:{position:{x:173,y:318},y:300,stretch:-1.1599999999999997},Dust:{opacity:.37,scaleX:1}}},sequence:{subUnitsPerUnit:30,length:2,type:\"PositionalSequence\",tracksByObject:{Box:{trackData:{AQMTK8I7k5:{type:\"BasicKeyframedTrack\",keyframes:[{id:\"LuGZxLq7Kq\",position:0,connectedRight:!0,handles:[.5,1,.5,0],value:165},{id:\"DpG125PqB-\",position:.967,connectedRight:!0,handles:[.5,1,.5,0],value:294},{id:\"MzGodVuJJa\",position:1.633,connectedRight:!0,handles:[.5,1,.5,0],value:440},{id:\"rWLbo9k0Gs\",position:3.1,connectedRight:!0,handles:[.5,1,.5,0],value:581},{id:\"OGx6K1XMzu\",position:3.933,connectedRight:!0,handles:[.5,1,.5,0],value:722}]},FOzP0WOnXm:{type:\"BasicKeyframedTrack\",keyframes:[{id:\"wQ9mTc9Sc_\",position:0,connectedRight:!0,handles:[.5,1,.5387096774193548,.020833333333333332],value:300},{id:\"ZGEeMifIsv\",position:1,connectedRight:!0,handles:[.9935483870967741,.849013157894737,.014516129032258063,.3466660800664213],value:3.9942751806827346},{id:\"iRdOL3pp4b\",position:2,connectedRight:!0,handles:[.5,1,.5,0],value:300}]},yGILQGy9bj:{type:\"BasicKeyframedTrack\",keyframes:[{id:\"LMCpLu5Bz8\",position:0,connectedRight:!0,handles:[.5,1,.5,0],value:-.9999999999999997},{id:\"VrNcbQxqqq\",position:.933,connectedRight:!0,handles:[.5,1,.5,0],value:-1.1999999999999997},{id:\"Xx1PP7x46C\",position:1,connectedRight:!0,handles:[.5,1,.5,0],value:-.842150721897905},{id:\"pgieCbqqa_\",position:1.2,connectedRight:!0,handles:[.5,1,.5,0],value:-1.2399999999999998},{id:\"cpuVjg2xQ4\",position:2,connectedRight:!0,handles:[.5,1,.5,0],value:-.9999999999999998}]}},trackIdByPropPath:{'[\"position\",\"x\"]':\"AQMTK8I7k5\",'[\"y\"]':\"FOzP0WOnXm\",'[\"stretch\"]':\"yGILQGy9bj\"}},Dust:{trackData:{WxZaWloxoF:{type:\"BasicKeyframedTrack\",keyframes:[{id:\"CpOM5Af3x3\",position:.5,connectedRight:!0,handles:[.5,1,.4096774193548388,-.036441992517923905],value:0},{id:\"BHBonRNit3\",position:1,connectedRight:!0,handles:[.8774193548387096,.5544493374033643,.12096774193548399,.847682119205298],value:.88},{id:\"Va-vc6Jz3a\",position:1.6,connectedRight:!0,handles:[.5,1,.5,0],value:-.07999999999999996}]},ieuKKuzweY:{type:\"BasicKeyframedTrack\",keyframes:[{id:\"N9iD7i22Cu\",position:.5,connectedRight:!0,handles:[.5,1,.5,0],value:.09999999999999998},{id:\"VXRSWBjhn5\",position:1,connectedRight:!0,handles:[.5,1,.5,0],value:1},{id:\"pCtBt3qRYk\",position:1.6,connectedRight:!0,handles:[.5,1,.5,0],value:0}]}},trackIdByPropPath:{'[\"opacity\"]':\"WxZaWloxoF\",'[\"scaleX\"]':\"ieuKKuzweY\"}}}}}},definitionVersion:\"0.4.0\",revisionHistory:[\"OV-DCDqvtVsUtrF5\",\"qITdBtbuYJsVRrUN\"]};","import { getProject, types as t } from '@theatre/core';\n// import studio from '@theatre/studio';\nimport state from './state.json';\n\n// studio.initialize();\nconst project = getProject('Jumping Balls', { state });\nfunction makeBouncingBox(i) {\n  const boxContainer = document.createElement('div');\n  boxContainer.className = 'boxContainer';\n  document.getElementById('space').appendChild(boxContainer);\n\n  const sheet = project.sheet('Table', 'Instance ' + i);\n  const boxObj = sheet.object('Box', {\n    y: 0,\n    stretch: t.number(1, { nudgeMultiplier: 0.01 }),\n  });\n\n  const boxDiv = document.createElement('div');\n  boxDiv.className = `box `;\n  boxContainer.appendChild(boxDiv);\n  boxDiv.addEventListener('click', () => {\n    sheet.sequence.play({ iterationCount: Infinity });\n  });\n\n  boxObj.onValuesChange(({ y, stretch }) => {\n    boxDiv.style.transform = `translateY(${-y}px) scale(${1 / stretch}, ${stretch})`;\n  });\n\n  const dustDiv = document.createElement('div');\n  dustDiv.className = `dust`;\n  boxContainer.appendChild(dustDiv);\n\n  const dustObj = sheet.object('Dust', {\n    opacity: t.number(1, { nudgeMultiplier: 0.01 }),\n    scaleX: t.number(1, { nudgeMultiplier: 0.01 }),\n  });\n  dustObj.onValuesChange(({ opacity, scaleX }) => {\n    dustDiv.style.opacity = String(opacity);\n    dustDiv.style.transform = `scaleX(${scaleX})`;\n  });\n}\n\nmakeBouncingBox(1);\nmakeBouncingBox(2);\nmakeBouncingBox(3);\n"]}